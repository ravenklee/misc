diff --git a/NxWidgets/libnxwidgets/src/cnxserver.cxx b/NxWidgets/libnxwidgets/src/cnxserver.cxx
index 8dd448b..e87c0fd 100644
--- a/NxWidgets/libnxwidgets/src/cnxserver.cxx
+++ b/NxWidgets/libnxwidgets/src/cnxserver.cxx
@@ -217,7 +217,7 @@ bool CNxServer::connect(void)
   // Start the server task
 
   gvdbg("CNxServer::connect: Starting server task\n");
-  pid_t serverId = TASK_CREATE("NX Server", CONFIG_NXWIDGETS_SERVERPRIO,
+  pid_t serverId = task_create("NX Server", CONFIG_NXWIDGETS_SERVERPRIO,
                                CONFIG_NXWIDGETS_SERVERSTACK, server,
                                (FAR char * const *)0);
   if (serverId < 0)
diff --git a/NxWidgets/nxwm/src/cnxconsole.cxx b/NxWidgets/nxwm/src/cnxconsole.cxx
index b8577b6..be0718a 100644
--- a/NxWidgets/nxwm/src/cnxconsole.cxx
+++ b/NxWidgets/nxwm/src/cnxconsole.cxx
@@ -250,7 +250,7 @@ bool CNxConsole::run(void)
   g_nxconvars.nxcon   = 0;
 
   sched_lock();
-  m_pid = TASK_CREATE("NxConsole", CONFIG_NXWM_NXCONSOLE_PRIO,
+  m_pid = task_create("NxConsole", CONFIG_NXWM_NXCONSOLE_PRIO,
                       CONFIG_NXWM_NXCONSOLE_STACKSIZE, nxconsole,
                       (FAR char * const *)0);
 
diff --git a/apps/examples/cc3000/telnetd_daemon.c b/apps/examples/cc3000/telnetd_daemon.c
index 2adadc6..2237741 100644
--- a/apps/examples/cc3000/telnetd_daemon.c
+++ b/apps/examples/cc3000/telnetd_daemon.c
@@ -239,7 +239,7 @@ static int telnetd_daemon(int argc, char *argv[])
        */
 
       nllvdbg("Starting the telnet session\n");
-      pid = TASK_CREATE("Telnet session", daemon->priority, daemon->stacksize,
+      pid = task_create("Telnet session", daemon->priority, daemon->stacksize,
                          daemon->entry, NULL);
       if (pid < 0)
         {
@@ -319,7 +319,7 @@ int telnetd_start(FAR struct telnetd_config_s *config)
   /* Then start the new daemon */
 
   g_telnetdcommon.daemon = daemon;
-  pid = TASK_CREATE("Telnet daemon", config->d_priority, config->d_stacksize,
+  pid = task_create("Telnet daemon", config->d_priority, config->d_stacksize,
                     telnetd_daemon, NULL);
   if (pid < 0)
     {
diff --git a/apps/examples/ftpd/ftpd_main.c b/apps/examples/ftpd/ftpd_main.c
index 507d90e..8054c32 100644
--- a/apps/examples/ftpd/ftpd_main.c
+++ b/apps/examples/ftpd/ftpd_main.c
@@ -256,7 +256,7 @@ int ftpd_main(int s_argc, char **s_argv)
   if (!g_ftpdglob.running)
     {
       printf("Starting the FTP daemon\n");
-      g_ftpdglob.pid = TASK_CREATE("FTP daemon", CONFIG_EXAMPLES_FTPD_PRIO,
+      g_ftpdglob.pid = task_create("FTP daemon", CONFIG_EXAMPLES_FTPD_PRIO,
                                    CONFIG_EXAMPLES_FTPD_STACKSIZE,
                                    ftpd_daemon, NULL);
       if (g_ftpdglob.pid < 0)
diff --git a/apps/examples/hidkbd/hidkbd_main.c b/apps/examples/hidkbd/hidkbd_main.c
index 67778f6..f188574 100644
--- a/apps/examples/hidkbd/hidkbd_main.c
+++ b/apps/examples/hidkbd/hidkbd_main.c
@@ -306,14 +306,9 @@ int hidkbd_main(int argc, char *argv[])
 
       printf("hidkbd_main: Start hidkbd_waiter\n");
 
-#ifndef CONFIG_CUSTOM_STACK
       pid = task_create("usbhost", CONFIG_EXAMPLES_HIDKBD_DEFPRIO,
                         CONFIG_EXAMPLES_HIDKBD_STACKSIZE,
                         (main_t)hidkbd_waiter, (FAR char * const *)NULL);
-#else
-      pid = task_create("usbhost", CONFIG_EXAMPLES_HIDKBD_DEFPRIO,
-                        (main_t)hidkbd_waiter, (FAR char * const *)NULL);
-#endif
       UNUSED(pid);
 
       /* Now just sleep.  Eventually logic here will open the kbd device and
diff --git a/apps/examples/nxconsole/nxcon_main.c b/apps/examples/nxconsole/nxcon_main.c
index 45223dc..550ce49 100644
--- a/apps/examples/nxconsole/nxcon_main.c
+++ b/apps/examples/nxconsole/nxcon_main.c
@@ -389,7 +389,7 @@ int nxcon_main(int argc, char **argv)
     * from this task.
     */
 
-   g_nxcon_vars.pid = TASK_CREATE("NxConsole", CONFIG_EXAMPLES_NXCONSOLE_PRIO,
+   g_nxcon_vars.pid = task_create("NxConsole", CONFIG_EXAMPLES_NXCONSOLE_PRIO,
                                   CONFIG_EXAMPLES_NXCONSOLE_STACKSIZE,
                                   nxcon_task, NULL);
    ASSERT(g_nxcon_vars.pid > 0);
diff --git a/apps/examples/ostest/fpu.c b/apps/examples/ostest/fpu.c
index 2729348..47b6685 100644
--- a/apps/examples/ostest/fpu.c
+++ b/apps/examples/ostest/fpu.c
@@ -308,7 +308,7 @@ void fpu_test(void)
 
   g_fpuno = 0;
   printf("Starting task FPU#1\n");
-  task1 = TASK_CREATE("FPU#1", CONFIG_EXAMPLES_OSTEST_FPUPRIORITY, CONFIG_EXAMPLES_OSTEST_FPUSTACKSIZE, fpu_task, NULL);
+  task1 = task_create("FPU#1", CONFIG_EXAMPLES_OSTEST_FPUPRIORITY, CONFIG_EXAMPLES_OSTEST_FPUSTACKSIZE, fpu_task, NULL);
   if (task1 < 0)
     {
       printf("fpu_test: ERROR Failed to start task FPU#1\n");
@@ -321,7 +321,7 @@ void fpu_test(void)
   usleep(250);
 
   printf("Starting task FPU#2\n");
-  task2 = TASK_CREATE("FPU#2", CONFIG_EXAMPLES_OSTEST_FPUPRIORITY, CONFIG_EXAMPLES_OSTEST_FPUSTACKSIZE, fpu_task, NULL);
+  task2 = task_create("FPU#2", CONFIG_EXAMPLES_OSTEST_FPUPRIORITY, CONFIG_EXAMPLES_OSTEST_FPUSTACKSIZE, fpu_task, NULL);
   if (task2 < 0)
     {
       printf("fpu_test: ERROR Failed to start task FPU#1\n");
diff --git a/apps/examples/ostest/ostest_main.c b/apps/examples/ostest/ostest_main.c
index f7879ed..8e78e5d 100644
--- a/apps/examples/ostest/ostest_main.c
+++ b/apps/examples/ostest/ostest_main.c
@@ -552,13 +552,8 @@ int ostest_main(int argc, FAR char *argv[])
 
   /* Verify that we can spawn a new task */
 
-#ifndef CONFIG_CUSTOM_STACK
   result = task_create("ostest", PRIORITY, STACKSIZE, user_main,
                        (FAR char * const *)g_argv);
-#else
-  result = task_create("ostest", PRIORITY, user_main,
-                       (FAR char * const *)g_argv);
-#endif
   if (result == ERROR)
     {
       printf("ostest_main: ERROR Failed to start user_main\n");
diff --git a/apps/examples/ostest/restart.c b/apps/examples/ostest/restart.c
index 0d0f90d..703dbd9 100644
--- a/apps/examples/ostest/restart.c
+++ b/apps/examples/ostest/restart.c
@@ -166,7 +166,7 @@ void restart_test(void)
 
   /* Start the task */
 
-  ret = TASK_CREATE("ostest", PRIORITY, STACKSIZE, restart_main, g_argv);
+  ret = task_create("ostest", PRIORITY, STACKSIZE, restart_main, g_argv);
   if (ret < 0)
     {
       printf("restart_main: ERROR Failed to start restart_main\n");
diff --git a/apps/examples/ostest/waitpid.c b/apps/examples/ostest/waitpid.c
index 0649748..6b6de79 100644
--- a/apps/examples/ostest/waitpid.c
+++ b/apps/examples/ostest/waitpid.c
@@ -84,7 +84,7 @@ static void waitpid_start_children(void)
 
   for (i = 0; i < NCHILDREN; i++)
     {
-      ret = TASK_CREATE("waitpid", PRIORITY, STACKSIZE, waitpid_main, NULL);
+      ret = task_create("waitpid", PRIORITY, STACKSIZE, waitpid_main, NULL);
       if (ret < 0)
         {
           printf("waitpid_start_child: ERROR Failed to start waitpid_main\n");
diff --git a/apps/netutils/discover/discover.c b/apps/netutils/discover/discover.c
index dcd008a..41e7ecd 100644
--- a/apps/netutils/discover/discover.c
+++ b/apps/netutils/discover/discover.c
@@ -452,7 +452,7 @@ int discover_start(struct discover_info_s *info)
 
   /* Then start the new daemon */
 
-  pid = TASK_CREATE("Discover daemon", CONFIG_DISCOVER_PRIORITY,
+  pid = task_create("Discover daemon", CONFIG_DISCOVER_PRIORITY,
                     CONFIG_DISCOVER_STACK_SIZE, discover_daemon, NULL);
   if (pid < 0)
     {
diff --git a/apps/netutils/ntpclient/ntpclient.c b/apps/netutils/ntpclient/ntpclient.c
index ea01606..a0d8d19 100644
--- a/apps/netutils/ntpclient/ntpclient.c
+++ b/apps/netutils/ntpclient/ntpclient.c
@@ -491,7 +491,7 @@ int ntpc_start(void)
 
       g_ntpc_daemon.state = NTP_STARTED;
       g_ntpc_daemon.pid =
-        TASK_CREATE("NTP daemon", CONFIG_NETUTILS_NTPCLIENT_SERVERPRIO,
+        task_create("NTP daemon", CONFIG_NETUTILS_NTPCLIENT_SERVERPRIO,
                     CONFIG_NETUTILS_NTPCLIENT_STACKSIZE, ntpc_daemon,
                     NULL);
 
diff --git a/apps/netutils/telnetd/telnetd_daemon.c b/apps/netutils/telnetd/telnetd_daemon.c
index 94b3402..e08d23d 100644
--- a/apps/netutils/telnetd/telnetd_daemon.c
+++ b/apps/netutils/telnetd/telnetd_daemon.c
@@ -239,7 +239,7 @@ static int telnetd_daemon(int argc, char *argv[])
        */
 
       nllvdbg("Starting the telnet session\n");
-      pid = TASK_CREATE("Telnet session", daemon->priority, daemon->stacksize,
+      pid = task_create("Telnet session", daemon->priority, daemon->stacksize,
                          daemon->entry, NULL);
       if (pid < 0)
         {
@@ -319,7 +319,7 @@ int telnetd_start(FAR struct telnetd_config_s *config)
   /* Then start the new daemon */
 
   g_telnetdcommon.daemon = daemon;
-  pid = TASK_CREATE("Telnet daemon", config->d_priority, config->d_stacksize,
+  pid = task_create("Telnet daemon", config->d_priority, config->d_stacksize,
                     telnetd_daemon, NULL);
   if (pid < 0)
     {
diff --git a/apps/netutils/thttpd/libhttpd.c b/apps/netutils/thttpd/libhttpd.c
index 2b4b976..4abf947 100644
--- a/apps/netutils/thttpd/libhttpd.c
+++ b/apps/netutils/thttpd/libhttpd.c
@@ -1865,14 +1865,9 @@ static int ls(httpd_conn *hc)
       snprintf(arg, 16, "%p", hc); /* task_create doesn't handle binary arguments. */
       argv[0] = arg;
 
-#ifndef CONFIG_CUSTOM_STACK
       child = task_create("CGI child", CONFIG_THTTPD_CGI_PRIORITY,
                           CONFIG_THTTPD_CGI_STACKSIZE,
                           (main_t)ls_child, (FAR char * const *)argv);
-#else
-      child = task_create("CGI child", CONFIG_THTTPD_CGI_PRIORITY,
-                          (main_t)ls_child, (FAR char * const *)argv);
-#endif
       if (child < 0)
         {
           ndbg("task_create: %d\n", errno);
diff --git a/apps/netutils/thttpd/thttpd_cgi.c b/apps/netutils/thttpd/thttpd_cgi.c
index 1c931bb..27eb470 100644
--- a/apps/netutils/thttpd/thttpd_cgi.c
+++ b/apps/netutils/thttpd/thttpd_cgi.c
@@ -1021,14 +1021,9 @@ int cgi(httpd_conn *hc)
       argv[0] = arg;
       argv[1] = NULL;
 
-#ifndef CONFIG_CUSTOM_STACK
       child = task_create("CGI child", CONFIG_THTTPD_CGI_PRIORITY,
                           CONFIG_THTTPD_CGI_STACKSIZE,
                           (main_t)cgi_child, (FAR char * const *)argv);
-#else
-      child = task_create("CGI child", CONFIG_THTTPD_CGI_PRIORITY,
-                          (main_t)cgi_child, (FAR char * const *)argv);
-#endif
       if (child < 0)
         {
           ndbg("task_create: %d\n", errno);
diff --git a/apps/system/stackmonitor/stackmonitor.c b/apps/system/stackmonitor/stackmonitor.c
index 2c912fc..8587fda 100644
--- a/apps/system/stackmonitor/stackmonitor.c
+++ b/apps/system/stackmonitor/stackmonitor.c
@@ -152,7 +152,7 @@ int stackmonitor_start(int argc, char **argv)
       g_stackmonitor.started = true;
       g_stackmonitor.stop    = false;
 
-      ret = TASK_CREATE("Stack Monitor", CONFIG_SYSTEM_STACKMONITOR_PRIORITY,
+      ret = task_create("Stack Monitor", CONFIG_SYSTEM_STACKMONITOR_PRIORITY,
                         CONFIG_SYSTEM_STACKMONITOR_STACKSIZE,
                         (main_t)stackmonitor_daemon, (FAR char * const *)NULL);
       if (ret < 0)
diff --git a/apps/system/usbmonitor/usbmonitor.c b/apps/system/usbmonitor/usbmonitor.c
index 252a589..25bc681 100644
--- a/apps/system/usbmonitor/usbmonitor.c
+++ b/apps/system/usbmonitor/usbmonitor.c
@@ -197,7 +197,7 @@ int usbmonitor_start(int argc, char **argv)
       g_usbmonitor.started = true;
       g_usbmonitor.stop    = false;
 
-      ret = TASK_CREATE("USB Monitor", CONFIG_SYSTEM_USBMONITOR_PRIORITY,
+      ret = task_create("USB Monitor", CONFIG_SYSTEM_USBMONITOR_PRIORITY,
                         CONFIG_SYSTEM_USBMONITOR_STACKSIZE,
                         (main_t)usbmonitor_daemon, (FAR char * const *)NULL);
       if (ret < 0)
diff --git a/nuttx/Documentation/NuttX.html b/nuttx/Documentation/NuttX.html
index 049d429..276ae22 100644
--- a/nuttx/Documentation/NuttX.html
+++ b/nuttx/Documentation/NuttX.html
@@ -8,7 +8,7 @@
   <tr align="center" bgcolor="#e4e4e4">
     <td>
       <h1><big><font color="#3c34ec"><i>NuttX RTOS</i></font></big></h1>
-      <p>Last Updated: August 15, 2014</p>
+      <p>Last Updated: September 1, 2014</p>
     </td>
   </tr>
 </table>
@@ -1254,7 +1254,7 @@
   </li>
   <li>Intel
     <ul>
-      <li><a href="#80x52">Intel 80x52 Microcontroller</a> (1)</li>
+      <li><a href="#80x52">Intel 80x52 Microcontroller</a> (1) (<i>obsoleted</i>)</li>
       <li><a href="#80x86">Intel 80x86</a> (2)</li>
     </ul>
   </li>
@@ -1330,7 +1330,7 @@
   </li>
   <li>Intel
     <ul>
-      <li><a href="#80x52">Intel 80x52</a></li>
+      <li><a href="#80x52">Intel 80x52</a> (<i>obsoleted</i>)</li>
       <li><a href="#80x86">Intel 80x86</a></li>
     </ul>
   </li>
@@ -3622,8 +3622,7 @@ Mem:         29232       5920      23312      23312
   <td>
     <p>
       <b>PJRC 87C52 Development Board</b>.
-      This port uses the <a href="http://www.pjrc.com/">PJRC</a> 87C52 development system
-      and the <a href="http://sdcc.sourceforge.net/">SDCC</a> toolchain under Linux or Cygwin.
+      This port uses the <a href="http://www.pjrc.com/">PJRC</a> 87C52 development system and the <a href="http://sdcc.sourceforge.net/">SDCC</a> toolchain under Linux or Cygwin.
     </p>
     <ul>
       <p>
@@ -3633,7 +3632,13 @@ Mem:         29232       5920      23312      23312
         address space during interrupt handling.
         This architecture has not been built in some time will likely have some compilation
         problems because of SDCC compiler differences.
-        Refer to the NuttX board <a href="http://sourceforge.net/p/nuttx/git/ci/master/tree/nuttx/configs/pjrc-8051/README.txt">README</a> file for further information.
+        Refer to the NuttX board <a href="http://sourceforge.net/p/nuttx/git/ci/master/tree/misc/Obsoleted/configs/pjrc-8051/README.txt">README</a> file for further information.
+      </p>
+      <p>
+        <b>Obsoleted</b>.
+        This architecture has been obsoleted.
+        The code has been moved out of the source tree an can now be found in <a href="http://sourceforge.net/p/nuttx/git/ci/master/tree/misc/Obsoleted/">Obsoleted</a> directory.
+        This support was obsoleted because (1) the architecture limitations of the 8051 family make ongoing support too difficult, and (2) although the basic port was marginally functional, it has never really been demonstrated convincingly in any application.
       </p>
     </ul>
   </td>
diff --git a/nuttx/Documentation/NuttxPortingGuide.html b/nuttx/Documentation/NuttxPortingGuide.html
index 7bbadfa..07996d5 100644
--- a/nuttx/Documentation/NuttxPortingGuide.html
+++ b/nuttx/Documentation/NuttxPortingGuide.html
@@ -607,10 +607,6 @@
     This is a work in progress.
   </li>
 
-  <li><code>arch/8051</code>:
-    8051 Microcontroller.  This port is not quite ready for prime time.
-  </li>
-
   <li><code>arch/z16f</code>:
     Zilog z16f Microcontroller.
     This port uses the Zilog z16f2800100zcog Development Kit.
@@ -950,12 +946,6 @@
     (PICkit 2 does not work with the PIC32).
   </li>
 
-  <li><code>configs/pjrc-8051</code>:
-    8051 Microcontroller.  This port uses the PJRC 87C52 development system
-    and the <a href="http://sdcc.sourceforge.net/">SDCC</a> toolchain under Linux or Cygwin.
-    This port is not quite ready for prime time.
-  </li>
-
   <li><code>configs/qemu-i486</code>:
     Port of NuttX to QEMU in i486 mode.  This port will also run on real i486
     hardware (Google the Bifferboard).
@@ -1806,9 +1796,6 @@ The system can be re-made subsequently by just typing <code>make</code>.
   <li><code>adj_stack_ptr</code>: Adjusted <code>stack_alloc_ptr</code> for HW.  The
     initial value of the stack pointer.
 </ul>
-<p>
-  This API is <i>NOT</i> required if <code>CONFIG_CUSTOM_STACK</code> is defined.
-</p>
 
 <p><b>Input Parameters</b>:</p>
 <ul>
@@ -1861,9 +1848,6 @@ The system can be re-made subsequently by just typing <code>make</code>.
   <li><code>adj_stack_ptr</code>: Adjusted <code>stack_alloc_ptr</code> for HW.  The
     initial value of the stack pointer.
 </ul>
-<p>
-  This API is <i>NOT</i> required if <code>CONFIG_CUSTOM_STACK</code> is defined.
-</p>
 
 <p><b>Input Parameters:</b></p>
 <ul>
@@ -1906,7 +1890,7 @@ The system can be re-made subsequently by just typing <code>make</code>.
   </li>
 </ul>
 <p>
-  This API is <i>NOT</i> required if <code>CONFIG_BUILD_PROTECTED</code> and <code>CONFIG_BUILD_KERNEL</code> are undefined or if <code>CONFIG_CUSTOM_STACK</code> is defined.
+  This API is <i>NOT</i> required if <code>CONFIG_BUILD_PROTECTED</code> and <code>CONFIG_BUILD_KERNEL</code> are undefined.
 </p>
 <p><b>Input Parameters:</b></p>
 <ul>
@@ -1937,9 +1921,6 @@ The system can be re-made subsequently by just typing <code>make</code>.
   A task has been stopped.
   Free all stack related resources retained int the defunct TCB.
 </p>
-<p>
-  This API is <i>NOT</i> required if <code>CONFIG_CUSTOM_STACK</code> is defined.
-</p>
 <p><b>Input Parameters:</b></p>
 <ul>
   <li>
diff --git a/nuttx/Documentation/README.html b/nuttx/Documentation/README.html
index b2a8775..50304cf 100644
--- a/nuttx/Documentation/README.html
+++ b/nuttx/Documentation/README.html
@@ -164,8 +164,6 @@
  |   |   |   `- <a href="http://sourceforge.net/p/nuttx/git/ci/master/tree/nuttx/configs/pic32mx7mmb/README.txt"><b><i>README.txt</i></b></a>
  |   |   |- pirelli_dpl10/
  |   |   |   `- <a href="http://sourceforge.net/p/nuttx/git/ci/master/tree/nuttx/configs/pirelli_dpl10/README.txt"><b><i>README.txt</i></b></a>
- |   |   |- pjrc-8051/
- |   |   |   `- <a href="http://sourceforge.net/p/nuttx/git/ci/master/tree/nuttx/configs/pjrc-8051/README.txt"><b><i>README.txt</i></b></a>
  |   |   |- qemu-i486/
  |   |   |   `- <a href="http://sourceforge.net/p/nuttx/git/ci/master/tree/nuttx/configs/qemu-i486/README.txt"><b><i>README.txt</i></b></a>
  |   |   |- rgmp/
diff --git a/nuttx/README.txt b/nuttx/README.txt
index b868b81..fcd7e3e 100644
--- a/nuttx/README.txt
+++ b/nuttx/README.txt
@@ -1030,8 +1030,6 @@ nuttx
  |   |   `- README.txt
  |   |- pirelli_dpl10/
  |   |   `- README.txt
- |   |- pjrc-8051/
- |   |   `- README.txt
  |   |- qemu-i486/
  |   |   `- README.txt
  |   |- rgmp/
diff --git a/nuttx/TODO b/nuttx/TODO
index 2877646..a425384 100644
--- a/nuttx/TODO
+++ b/nuttx/TODO
@@ -38,7 +38,6 @@ nuttx/
   (5)  ARM/STM32 (arch/arm/src/stm32/)
   (3)  AVR (arch/avr)
   (0)  Intel x86 (arch/x86)
-  (5)  8051 / MCS51 (arch/8051/)
   (3)  MIPS/PIC32 (arch/mips)
   (1)  Hitachi/Renesas SH-1 (arch/sh/src/sh1)
   (4)  Renesas M16C/26 (arch/sh/src/m16c)
@@ -1839,58 +1838,6 @@ o AVR (arch/avr)
 o Intel x86 (arch/x86)
   ^^^^^^^^^^^^^^^^^^^^
 
-o 8051 / MCS51 (arch/8051/)
-  ^^^^^^^^^^^^^^^^^^^^^^^^^
-
-  Title:       STACK OVERFLOWS DURING INTERRUPT HANDLING
-  Description: Current status:
-               - Basic OS task management seems OK
-               - Fails when interrupts enabled.  The stack pointer is around
-                 0x6e before the failure occurs.  It looks like some issue
-                 when the stack pointer moves from the directly to indirectly
-                 addressable region (0x80 boundary).
-               - Work on the 8052 is temporarily on hold
-  Status:      Open
-  Priority:    Low, 8051 is a tough platform because of the tiny stack.
-
-  Title:       TIMER 0 AS SYSTEM TIMER
-  Description: Use timer 0 as system timer.  Timer 2 is needed for second UART.
-               Logic is implemented, but there needs to be a system
-               configuration to change the ticks-per-second value to match the
-               timer interrupt rate
-  Status:      Open
-  Priority:    Low
-
-  Title:       OVERFLOWS DURING BUILD
-  Description: During build, there are several integer overflows reported:
-               sched/gmtime_r.c aroud lines 184 and 185
-               sched/clock_initialize.c at line 107
-               sched/pthread_create.c at 330
-               apps/examples/ostest/barrier.c around lines 53 and 74
-               apps/examples/ostest/sighand.c at 225 and 244
-               driver/serial.c in usleep calls around 347 and 354
-  Status:      Open.  Update:  These were reviewed during the hcs12 port.  The
-               hcs12 also has 16-bit integer types (if -mshort is in the CFLAGS).
-               I believe that the warnings in most of the above have been fixed
-               but this has not been verified on this platform).
-  Priority:    Medium
-
-  Title:       DATA INITIALIZATION
-  Description  Global data is not being initialized.  Logic like that of SDCCs
-               crt0*.s needs to be incorporated into the system boot logic
-  Status:      Open
-  Priority:    Low -- only because there as so many other issues with 8051
-
-  Title:       8051 BUILD BROKEN
-  Description: The last time I tried to build the pjrc-8051 configuration using
-               the SDCC 3.2.1 toolchain (for Windows).  I got compilation
-               errors in sched/os_bringup.c.  It complained about type
-               mis-matches.  What I gather from Googling, this is a problem
-               with the --stack-auto option.  At any rate, this problem will
-               need to be fixed if you want to resurrect the 8051 NuttX port.
- Status:       Open
- Priority:     Low -- I don't think anyone uses the 8051 port.
-
 o MIPS/PIC32(arch/mips)
   ^^^^^^^^^^^^^^^^^^^^^
 
@@ -2032,11 +1979,11 @@ o z80/z8/ez80/z180 (arch/z80)
 
   Title:       SDCC INTEGER OVERFLOWS
   Description: The SDCC version the same problems with integer overflow during
-               compilation as described for pjrc-8051.  At typical cause is code like
+               compilation for certain 8-bit platform.  At typical cause is code like
                usleep(500*1000) which exceeds the range of a 16-bit integer.
-  Status:      See pjrc-8051.  These have probably been fixed but have not yet
-               been verified on these platforms.
-  Priority:    See pjrc-8051
+  Status:      These have probably been fixed but have not yet been verified on thes
+               affected platforms.
+  Priority:    Low for now
 
   Title:       Z80 SIMULATED CONSOLE
   Description: The simulated Z80 serial console (configs/z80sim/src/z80_serial.c +
diff --git a/nuttx/arch/Kconfig b/nuttx/arch/Kconfig
index 41b28fa..11954a5 100644
--- a/nuttx/arch/Kconfig
+++ b/nuttx/arch/Kconfig
@@ -7,12 +7,6 @@ choice
 	prompt "CPU Architecture"
 	default ARCH_ARM
 
-config ARCH_8051
-	bool "8051"
-	select CUSTOM_STACK
-	---help---
-		Intel 8051 architectures and derivatives
-
 config ARCH_ARM
 	bool "ARM"
 	select ARCH_HAVE_INTERRUPTSTACK
@@ -84,7 +78,6 @@ endchoice
 
 config ARCH
 	string
-	default "8051"	if ARCH_8051
 	default "arm"	if ARCH_ARM
 	default "avr"	if ARCH_AVR
 	default "hc"	if ARCH_HC
@@ -96,7 +89,6 @@ config ARCH
 	default "z16"	if ARCH_Z16
 	default "z80"	if ARCH_Z80
 
-source arch/8051/Kconfig
 source arch/arm/Kconfig
 source arch/avr/Kconfig
 source arch/hc/Kconfig
@@ -134,10 +126,6 @@ config ARCH_HAVE_COHERENT_DCACHE
 	bool
 	default n
 
-config CUSTOM_STACK
-	bool
-	default n
-
 config ARCH_HAVE_ADDRENV
 	bool
 	default n
diff --git a/nuttx/arch/README.txt b/nuttx/arch/README.txt
index e7ef76d..e074d69 100644
--- a/nuttx/arch/README.txt
+++ b/nuttx/arch/README.txt
@@ -287,9 +287,6 @@ arch/sh - SuperH and related Hitachi/Renesas microcontrollers
     arch/sh/include/shs and arch/sh/src/sh1
         Support for the SH-1 processor.
 
-arch/8051 - 8051/52 microcontrollers
-    8051 Microcontroller.  This port is not quite ready for prime time.
-
 arch/x86 - Intel x86 architectures
     This directory holds related, 32- and 64-bit architectures from Intel.
     At present, this includes the following subdirectories:
diff --git a/nuttx/binfmt/binfmt_execmodule.c b/nuttx/binfmt/binfmt_execmodule.c
index 414c172..dccd225 100644
--- a/nuttx/binfmt/binfmt_execmodule.c
+++ b/nuttx/binfmt/binfmt_execmodule.c
@@ -135,9 +135,7 @@ static void exec_ctors(FAR void *arg)
 int exec_module(FAR const struct binary_s *binp)
 {
   FAR struct task_tcb_s *tcb;
-#ifndef CONFIG_CUSTOM_STACK
   FAR uint32_t *stack;
-#endif
   pid_t pid;
   int err;
   int ret;
@@ -163,7 +161,6 @@ int exec_module(FAR const struct binary_s *binp)
       goto errout;
     }
 
-#ifndef CONFIG_CUSTOM_STACK
   /* Allocate the stack for the new task (always from the user heap) */
 
   stack = (FAR uint32_t*)kumm_malloc(binp->stacksize);
@@ -177,12 +174,6 @@ int exec_module(FAR const struct binary_s *binp)
 
   ret = task_init((FAR struct tcb_s *)tcb, binp->filename, binp->priority,
                   stack, binp->stacksize, binp->entrypt, binp->argv);
-#else
-  /* Initialize the task */
-
-  ret = task_init((FAR struct tcb_s *)tcb, binp->filename, binp->priority,
-                  stack, binp->entrypt, binp->argv);
-#endif
   if (ret < 0)
     {
       err = get_errno();
@@ -247,13 +238,9 @@ int exec_module(FAR const struct binary_s *binp)
   return (int)pid;
 
 errout_with_stack:
-#ifndef CONFIG_CUSTOM_STACK
   tcb->cmn.stack_alloc_ptr = NULL;
   sched_releasetcb(&tcb->cmn, TCB_FLAG_TTYPE_TASK);
   kumm_free(stack);
-#else
-  sched_releasetcb(&tcb->cmn, TCB_FLAG_TTYPE_TASK);
-#endif
   goto errout;
 
 errout_with_tcb:
diff --git a/nuttx/configs/16z/nsh/defconfig b/nuttx/configs/16z/nsh/defconfig
index a667f23..71b33d9 100644
--- a/nuttx/configs/16z/nsh/defconfig
+++ b/nuttx/configs/16z/nsh/defconfig
@@ -75,7 +75,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -120,7 +119,6 @@ CONFIG_Z16F_UART0=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 # CONFIG_ARCH_HAVE_VFORK is not set
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/Kconfig b/nuttx/configs/Kconfig
index 2484013..94b4dab 100644
--- a/nuttx/configs/Kconfig
+++ b/nuttx/configs/Kconfig
@@ -509,14 +509,6 @@ config ARCH_BOARD_PIRELLI_DPL10
 		This directory contains the board support for Pirelli dpl10 phones.  The
 		additions were made by Craig Comstock (with help form Alan Carvalho de Assis).
 
-config ARCH_BOARD_PJRC_87C52
-	bool "PJRC 87C52 development system"
-	depends on ARCH_CHIP_8052
-	select ARCH_HAVE_LEDS
-	---help---
-		8051 Microcontroller.  This port uses the PJRC 87C52 development system
-		and the SDCC toolchain.   This port is not quite ready for prime time.
-
 config ARCH_BOARD_PX4FMU_V2
 	bool "PX4FMU v2"
 	depends on ARCH_CHIP_STM32F427V
@@ -1015,7 +1007,6 @@ config ARCH_BOARD
 	default "pic32-starterkit"    if ARCH_BOARD_PIC32_STARTERKIT
 	default "pic32mx7mmb"         if ARCH_BOARD_PIC32MX7MMB
 	default "pirelli_dpl10"       if ARCH_BOARD_PIRELLI_DPL10
-	default "pjrc-8051"           if ARCH_BOARD_PJRC_87C52
 	default "px4fmu-v2_upstream"  if ARCH_BOARD_PX4FMU_V2
 	default "nucleo-f401re"       if ARCH_BOARD_NUCLEO_F401RE
 	default "qemu-i486"           if ARCH_BOARD_QEMU_I486
@@ -1263,9 +1254,6 @@ endif
 if ARCH_BOARD_PIRELLI_DPL10
 source "configs/pirelli_dpl10/Kconfig"
 endif
-if ARCH_BOARD_PJRC_87C52
-source "configs/pjrc-8051/Kconfig"
-endif
 if ARCH_BOARD_NUCLEO_F401RE
 source "configs/nucleo-f401re/Kconfig"
 endif
diff --git a/nuttx/configs/README.txt b/nuttx/configs/README.txt
index 8ed0060..18e24a0 100644
--- a/nuttx/configs/README.txt
+++ b/nuttx/configs/README.txt
@@ -436,10 +436,6 @@ configs/pirelli_dpl10
   It is a variant of the compal_e88 config with the small changes for the
   differences in the board.
 
-configs/pjrc-8051
-  8051 Microcontroller.  This port uses the PJRC 87C52 development system
-  and the SDCC toolchain.   This port is not quite ready for prime time.
-
 config/px4fmu-v2_upstream
   This is a minimal configuration that supports low-level test of the
   PX4FMU v2 in the NuttX source tree.  If you are using PX4, you probably
diff --git a/nuttx/configs/amber/hello/defconfig b/nuttx/configs/amber/hello/defconfig
index f5a81f8..05dfdeb 100644
--- a/nuttx/configs/amber/hello/defconfig
+++ b/nuttx/configs/amber/hello/defconfig
@@ -54,7 +54,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 CONFIG_ARCH_AVR=y
 # CONFIG_ARCH_HC is not set
@@ -96,7 +95,6 @@ CONFIG_ARCH_NOINTC=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 # CONFIG_ARCH_HAVE_VFORK is not set
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/arduino-due/nsh/defconfig b/nuttx/configs/arduino-due/nsh/defconfig
index 493ccee..c94a8b2 100644
--- a/nuttx/configs/arduino-due/nsh/defconfig
+++ b/nuttx/configs/arduino-due/nsh/defconfig
@@ -43,7 +43,6 @@ CONFIG_RAW_BINARY=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -198,7 +197,6 @@ CONFIG_ARCH_HAVE_EXTSRAM1=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 CONFIG_ARCH_STACKDUMP=y
diff --git a/nuttx/configs/avr32dev1/nsh/defconfig b/nuttx/configs/avr32dev1/nsh/defconfig
index 3a6b352..9ed47a7 100644
--- a/nuttx/configs/avr32dev1/nsh/defconfig
+++ b/nuttx/configs/avr32dev1/nsh/defconfig
@@ -54,7 +54,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 CONFIG_ARCH_AVR=y
 # CONFIG_ARCH_HC is not set
@@ -119,7 +118,6 @@ CONFIG_ARCH_NOINTC=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 # CONFIG_ARCH_HAVE_VFORK is not set
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/avr32dev1/ostest/defconfig b/nuttx/configs/avr32dev1/ostest/defconfig
index 87c5921..76786df 100644
--- a/nuttx/configs/avr32dev1/ostest/defconfig
+++ b/nuttx/configs/avr32dev1/ostest/defconfig
@@ -54,7 +54,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 CONFIG_ARCH_AVR=y
 # CONFIG_ARCH_HC is not set
@@ -119,7 +118,6 @@ CONFIG_ARCH_NOINTC=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 # CONFIG_ARCH_HAVE_VFORK is not set
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/c5471evm/httpd/defconfig b/nuttx/configs/c5471evm/httpd/defconfig
index 9915cc3..7495f76 100644
--- a/nuttx/configs/c5471evm/httpd/defconfig
+++ b/nuttx/configs/c5471evm/httpd/defconfig
@@ -50,7 +50,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -147,7 +146,6 @@ CONFIG_C5471_AUTONEGOTIATION=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/c5471evm/nettest/defconfig b/nuttx/configs/c5471evm/nettest/defconfig
index 33b0d15..677a4ac 100644
--- a/nuttx/configs/c5471evm/nettest/defconfig
+++ b/nuttx/configs/c5471evm/nettest/defconfig
@@ -50,7 +50,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -147,7 +146,6 @@ CONFIG_C5471_AUTONEGOTIATION=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/c5471evm/nsh/defconfig b/nuttx/configs/c5471evm/nsh/defconfig
index c1e31da..7b60a26 100644
--- a/nuttx/configs/c5471evm/nsh/defconfig
+++ b/nuttx/configs/c5471evm/nsh/defconfig
@@ -50,7 +50,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -147,7 +146,6 @@ CONFIG_C5471_AUTONEGOTIATION=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/cc3200-launchpad/nsh/defconfig b/nuttx/configs/cc3200-launchpad/nsh/defconfig
index d136ee7..0556873 100644
--- a/nuttx/configs/cc3200-launchpad/nsh/defconfig
+++ b/nuttx/configs/cc3200-launchpad/nsh/defconfig
@@ -56,7 +56,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -165,7 +164,6 @@ CONFIG_TIVA_DISABLE_GPIOJ_IRQS=y
 CONFIG_ARCH_HAVE_IRQPRIO=y
 # CONFIG_ARCH_L2CACHE is not set
 # CONFIG_ARCH_HAVE_COHERENT_DCACHE is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_HAVE_ADDRENV is not set
 # CONFIG_ARCH_NEED_ADDRENV_MAPPING is not set
 CONFIG_ARCH_HAVE_VFORK=y
diff --git a/nuttx/configs/cloudctrl/nsh/defconfig b/nuttx/configs/cloudctrl/nsh/defconfig
index 811fbdb..9c144fc 100644
--- a/nuttx/configs/cloudctrl/nsh/defconfig
+++ b/nuttx/configs/cloudctrl/nsh/defconfig
@@ -39,7 +39,6 @@ CONFIG_INTELHEX_BINARY=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -304,7 +303,6 @@ CONFIG_PREALLOC_TIMERS=4
 #
 # Stack and heap information
 #
-# CONFIG_CUSTOM_STACK is not set
 CONFIG_IDLETHREAD_STACKSIZE=1024
 CONFIG_USERMAIN_STACKSIZE=2048
 CONFIG_PTHREAD_STACK_MIN=256
diff --git a/nuttx/configs/cloudctrl/src/up_usb.c b/nuttx/configs/cloudctrl/src/up_usb.c
index 4442f91..77b79db 100644
--- a/nuttx/configs/cloudctrl/src/up_usb.c
+++ b/nuttx/configs/cloudctrl/src/up_usb.c
@@ -194,7 +194,7 @@ int stm32_usbhost_initialize(void)
 
       uvdbg("Start usbhost_waiter\n");
 
-      pid = TASK_CREATE("usbhost", CONFIG_USBHOST_DEFPRIO,
+      pid = task_create("usbhost", CONFIG_USBHOST_DEFPRIO,
                         CONFIG_USBHOST_STACKSIZE,
                         (main_t)usbhost_waiter, (FAR char * const *)NULL);
       return pid < 0 ? -ENOEXEC : OK;
diff --git a/nuttx/configs/compal_e86/nsh_highram/defconfig b/nuttx/configs/compal_e86/nsh_highram/defconfig
index 9523d66..539e8e2 100644
--- a/nuttx/configs/compal_e86/nsh_highram/defconfig
+++ b/nuttx/configs/compal_e86/nsh_highram/defconfig
@@ -44,7 +44,6 @@ CONFIG_ARCH_HAVE_STACKCHECK=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -137,7 +136,6 @@ CONFIG_SERCOMM_CONSOLE=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 CONFIG_ARCH_STACKDUMP=y
diff --git a/nuttx/configs/compal_e88/nsh_highram/defconfig b/nuttx/configs/compal_e88/nsh_highram/defconfig
index f6ba797..467b277 100644
--- a/nuttx/configs/compal_e88/nsh_highram/defconfig
+++ b/nuttx/configs/compal_e88/nsh_highram/defconfig
@@ -49,7 +49,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -144,7 +143,6 @@ CONFIG_SERIAL_CONSOLE_NONE=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/compal_e99/nsh_compalram/defconfig b/nuttx/configs/compal_e99/nsh_compalram/defconfig
index 30bc476..8d31eb4 100644
--- a/nuttx/configs/compal_e99/nsh_compalram/defconfig
+++ b/nuttx/configs/compal_e99/nsh_compalram/defconfig
@@ -50,7 +50,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -146,7 +145,6 @@ CONFIG_SERIAL_CONSOLE_NONE=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/compal_e99/nsh_highram/defconfig b/nuttx/configs/compal_e99/nsh_highram/defconfig
index 4c07ac1..1a5c44c 100644
--- a/nuttx/configs/compal_e99/nsh_highram/defconfig
+++ b/nuttx/configs/compal_e99/nsh_highram/defconfig
@@ -50,7 +50,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -145,7 +144,6 @@ CONFIG_SERIAL_CONSOLE_NONE=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/demo9s12ne64/ostest/defconfig b/nuttx/configs/demo9s12ne64/ostest/defconfig
index dcf4490..095d3c4 100644
--- a/nuttx/configs/demo9s12ne64/ostest/defconfig
+++ b/nuttx/configs/demo9s12ne64/ostest/defconfig
@@ -49,7 +49,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 # CONFIG_ARCH_AVR is not set
 CONFIG_ARCH_HC=y
@@ -100,7 +99,6 @@ CONFIG_ARCH_NOINTC=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 # CONFIG_ARCH_HAVE_VFORK is not set
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/ea3131/nsh/defconfig b/nuttx/configs/ea3131/nsh/defconfig
index a7fe7ab..7482ab9 100644
--- a/nuttx/configs/ea3131/nsh/defconfig
+++ b/nuttx/configs/ea3131/nsh/defconfig
@@ -57,7 +57,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -164,7 +163,6 @@ CONFIG_ARCH_HAVE_EXTSRAM1=y
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
 # CONFIG_ARCH_L2CACHE is not set
 # CONFIG_ARCH_HAVE_COHERENT_DCACHE is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_HAVE_ADDRENV is not set
 # CONFIG_ARCH_NEED_ADDRENV_MAPPING is not set
 CONFIG_ARCH_HAVE_VFORK=y
diff --git a/nuttx/configs/ea3131/pgnsh/defconfig b/nuttx/configs/ea3131/pgnsh/defconfig
index 3f7b75b..0d2c3f8 100644
--- a/nuttx/configs/ea3131/pgnsh/defconfig
+++ b/nuttx/configs/ea3131/pgnsh/defconfig
@@ -60,7 +60,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -167,7 +166,6 @@ CONFIG_ARCH_HAVE_EXTSRAM1=y
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
 # CONFIG_ARCH_L2CACHE is not set
 # CONFIG_ARCH_HAVE_COHERENT_DCACHE is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_HAVE_ADDRENV is not set
 # CONFIG_ARCH_NEED_ADDRENV_MAPPING is not set
 CONFIG_ARCH_HAVE_VFORK=y
diff --git a/nuttx/configs/ea3131/src/up_usbhost.c b/nuttx/configs/ea3131/src/up_usbhost.c
index 8b6f459..5e3b845 100644
--- a/nuttx/configs/ea3131/src/up_usbhost.c
+++ b/nuttx/configs/ea3131/src/up_usbhost.c
@@ -221,7 +221,7 @@ int lpc31_usbhost_initialize(void)
 
   /* Start a thread to handle device connection. */
 
-  pid = TASK_CREATE("EHCI Monitor", CONFIG_USBHOST_DEFPRIO,  CONFIG_USBHOST_STACKSIZE,
+  pid = task_create("EHCI Monitor", CONFIG_USBHOST_DEFPRIO,  CONFIG_USBHOST_STACKSIZE,
                     (main_t)ehci_waiter, (FAR char * const *)NULL);
   if (pid < 0)
     {
diff --git a/nuttx/configs/ea3131/usbserial/defconfig b/nuttx/configs/ea3131/usbserial/defconfig
index e83f76b..9860413 100644
--- a/nuttx/configs/ea3131/usbserial/defconfig
+++ b/nuttx/configs/ea3131/usbserial/defconfig
@@ -57,7 +57,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -171,7 +170,6 @@ CONFIG_LPC31_USBDEV_EP0_MAXSIZE=64
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
 # CONFIG_ARCH_L2CACHE is not set
 # CONFIG_ARCH_HAVE_COHERENT_DCACHE is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_HAVE_ADDRENV is not set
 # CONFIG_ARCH_NEED_ADDRENV_MAPPING is not set
 CONFIG_ARCH_HAVE_VFORK=y
diff --git a/nuttx/configs/ea3152/ostest/defconfig b/nuttx/configs/ea3152/ostest/defconfig
index 55d0449..915055e 100644
--- a/nuttx/configs/ea3152/ostest/defconfig
+++ b/nuttx/configs/ea3152/ostest/defconfig
@@ -57,7 +57,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -165,7 +164,6 @@ CONFIG_ARCH_HAVE_EXTSRAM1=y
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
 # CONFIG_ARCH_L2CACHE is not set
 # CONFIG_ARCH_HAVE_COHERENT_DCACHE is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_HAVE_ADDRENV is not set
 # CONFIG_ARCH_NEED_ADDRENV_MAPPING is not set
 CONFIG_ARCH_HAVE_VFORK=y
diff --git a/nuttx/configs/eagle100/httpd/defconfig b/nuttx/configs/eagle100/httpd/defconfig
index a577741..b9102c6 100644
--- a/nuttx/configs/eagle100/httpd/defconfig
+++ b/nuttx/configs/eagle100/httpd/defconfig
@@ -54,7 +54,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -182,7 +181,6 @@ CONFIG_SSI_TXLIMIT=4
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/eagle100/nettest/defconfig b/nuttx/configs/eagle100/nettest/defconfig
index 09ac741..56f7847 100644
--- a/nuttx/configs/eagle100/nettest/defconfig
+++ b/nuttx/configs/eagle100/nettest/defconfig
@@ -77,7 +77,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -208,7 +207,6 @@ CONFIG_SSI_TXLIMIT=4
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/eagle100/nsh/defconfig b/nuttx/configs/eagle100/nsh/defconfig
index 804e2d1..5f322d1 100644
--- a/nuttx/configs/eagle100/nsh/defconfig
+++ b/nuttx/configs/eagle100/nsh/defconfig
@@ -55,7 +55,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -185,7 +184,6 @@ CONFIG_SSI_TXLIMIT=4
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/eagle100/nxflat/defconfig b/nuttx/configs/eagle100/nxflat/defconfig
index aa5c56b..91123ac 100644
--- a/nuttx/configs/eagle100/nxflat/defconfig
+++ b/nuttx/configs/eagle100/nxflat/defconfig
@@ -55,7 +55,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -170,7 +169,6 @@ CONFIG_SSI_TXLIMIT=4
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/eagle100/thttpd/defconfig b/nuttx/configs/eagle100/thttpd/defconfig
index 869e0a7..1e87a89 100644
--- a/nuttx/configs/eagle100/thttpd/defconfig
+++ b/nuttx/configs/eagle100/thttpd/defconfig
@@ -50,7 +50,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -175,7 +174,6 @@ CONFIG_SSI_TXLIMIT=4
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/ekk-lm3s9b96/nsh/defconfig b/nuttx/configs/ekk-lm3s9b96/nsh/defconfig
index fc2f98f..f49fd7a 100644
--- a/nuttx/configs/ekk-lm3s9b96/nsh/defconfig
+++ b/nuttx/configs/ekk-lm3s9b96/nsh/defconfig
@@ -51,7 +51,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -171,7 +170,6 @@ CONFIG_TIVA_DISABLE_GPIOJ_IRQS=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/ez80f910200kitg/ostest/defconfig b/nuttx/configs/ez80f910200kitg/ostest/defconfig
index 5e5f743..4bdeac4 100644
--- a/nuttx/configs/ez80f910200kitg/ostest/defconfig
+++ b/nuttx/configs/ez80f910200kitg/ostest/defconfig
@@ -69,7 +69,6 @@ CONFIG_DEBUG=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -156,7 +155,6 @@ CONFIG_EZ80_TOOLCHAIN_ZDSII=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 # CONFIG_ARCH_HAVE_VFORK is not set
 # CONFIG_ARCH_STACKDUMP is not set
diff --git a/nuttx/configs/ez80f910200zco/dhcpd/defconfig b/nuttx/configs/ez80f910200zco/dhcpd/defconfig
index 037a69f..95fda43 100644
--- a/nuttx/configs/ez80f910200zco/dhcpd/defconfig
+++ b/nuttx/configs/ez80f910200zco/dhcpd/defconfig
@@ -74,7 +74,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -171,7 +170,6 @@ CONFIG_ARCH_TIMERHOOK=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 # CONFIG_ARCH_HAVE_VFORK is not set
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/ez80f910200zco/httpd/defconfig b/nuttx/configs/ez80f910200zco/httpd/defconfig
index 92aabe6..ab74b68 100644
--- a/nuttx/configs/ez80f910200zco/httpd/defconfig
+++ b/nuttx/configs/ez80f910200zco/httpd/defconfig
@@ -74,7 +74,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -171,7 +170,6 @@ CONFIG_ARCH_TIMERHOOK=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 # CONFIG_ARCH_HAVE_VFORK is not set
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/ez80f910200zco/nettest/defconfig b/nuttx/configs/ez80f910200zco/nettest/defconfig
index c4e3aaf..d527056 100644
--- a/nuttx/configs/ez80f910200zco/nettest/defconfig
+++ b/nuttx/configs/ez80f910200zco/nettest/defconfig
@@ -74,7 +74,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -171,7 +170,6 @@ CONFIG_ARCH_TIMERHOOK=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 # CONFIG_ARCH_HAVE_VFORK is not set
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/ez80f910200zco/nsh/defconfig b/nuttx/configs/ez80f910200zco/nsh/defconfig
index eb410e6..88ba822 100644
--- a/nuttx/configs/ez80f910200zco/nsh/defconfig
+++ b/nuttx/configs/ez80f910200zco/nsh/defconfig
@@ -74,7 +74,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -171,7 +170,6 @@ CONFIG_ARCH_TIMERHOOK=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 # CONFIG_ARCH_HAVE_VFORK is not set
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/ez80f910200zco/poll/defconfig b/nuttx/configs/ez80f910200zco/poll/defconfig
index da41147..a815b21 100644
--- a/nuttx/configs/ez80f910200zco/poll/defconfig
+++ b/nuttx/configs/ez80f910200zco/poll/defconfig
@@ -74,7 +74,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -171,7 +170,6 @@ CONFIG_ARCH_TIMERHOOK=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 # CONFIG_ARCH_HAVE_VFORK is not set
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/fire-stm32v2/nsh/defconfig b/nuttx/configs/fire-stm32v2/nsh/defconfig
index 762b9d4..a4bd1cf 100644
--- a/nuttx/configs/fire-stm32v2/nsh/defconfig
+++ b/nuttx/configs/fire-stm32v2/nsh/defconfig
@@ -38,7 +38,6 @@ CONFIG_INTELHEX_BINARY=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -298,7 +297,6 @@ CONFIG_PREALLOC_TIMERS=8
 #
 # Stack and heap information
 #
-# CONFIG_CUSTOM_STACK is not set
 CONFIG_IDLETHREAD_STACKSIZE=1024
 CONFIG_USERMAIN_STACKSIZE=2048
 CONFIG_PTHREAD_STACK_MIN=256
diff --git a/nuttx/configs/freedom-kl25z/minnsh/defconfig b/nuttx/configs/freedom-kl25z/minnsh/defconfig
index 2ae2838..f8e6ffd 100644
--- a/nuttx/configs/freedom-kl25z/minnsh/defconfig
+++ b/nuttx/configs/freedom-kl25z/minnsh/defconfig
@@ -43,7 +43,6 @@ CONFIG_RAW_BINARY=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -158,7 +157,6 @@ CONFIG_KL_SYSTICK_CORECLK=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 CONFIG_ARCH_STACKDUMP=y
diff --git a/nuttx/configs/freedom-kl25z/nsh/defconfig b/nuttx/configs/freedom-kl25z/nsh/defconfig
index fbbcbb0..a69fc50 100644
--- a/nuttx/configs/freedom-kl25z/nsh/defconfig
+++ b/nuttx/configs/freedom-kl25z/nsh/defconfig
@@ -45,7 +45,6 @@ CONFIG_ARCH_HAVE_STACKCHECK=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -162,7 +161,6 @@ CONFIG_KL_SYSTICK_CORECLK=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 CONFIG_ARCH_STACKDUMP=y
diff --git a/nuttx/configs/hymini-stm32v/buttons/defconfig b/nuttx/configs/hymini-stm32v/buttons/defconfig
index 1aec7f4..a987dce 100644
--- a/nuttx/configs/hymini-stm32v/buttons/defconfig
+++ b/nuttx/configs/hymini-stm32v/buttons/defconfig
@@ -43,7 +43,6 @@ CONFIG_RAW_BINARY=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -217,7 +216,6 @@ CONFIG_STM32_USART=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 CONFIG_ARCH_STACKDUMP=y
diff --git a/nuttx/configs/hymini-stm32v/nsh/defconfig b/nuttx/configs/hymini-stm32v/nsh/defconfig
index c125f7c..61d7893 100644
--- a/nuttx/configs/hymini-stm32v/nsh/defconfig
+++ b/nuttx/configs/hymini-stm32v/nsh/defconfig
@@ -43,7 +43,6 @@ CONFIG_RAW_BINARY=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -226,7 +225,6 @@ CONFIG_SDIO_PRI=128
 # CONFIG_ARCH_VECNOTIRQ is not set
 CONFIG_ARCH_DMA=y
 # CONFIG_ARCH_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 CONFIG_ARCH_STACKDUMP=y
diff --git a/nuttx/configs/hymini-stm32v/nsh2/defconfig b/nuttx/configs/hymini-stm32v/nsh2/defconfig
index 18057ea..ca7deb2 100644
--- a/nuttx/configs/hymini-stm32v/nsh2/defconfig
+++ b/nuttx/configs/hymini-stm32v/nsh2/defconfig
@@ -43,7 +43,6 @@ CONFIG_RAW_BINARY=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -239,7 +238,6 @@ CONFIG_SDIO_PRI=128
 # CONFIG_ARCH_VECNOTIRQ is not set
 CONFIG_ARCH_DMA=y
 # CONFIG_ARCH_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 CONFIG_ARCH_STACKDUMP=y
diff --git a/nuttx/configs/hymini-stm32v/usbmsc/defconfig b/nuttx/configs/hymini-stm32v/usbmsc/defconfig
index 144e518..421f436 100644
--- a/nuttx/configs/hymini-stm32v/usbmsc/defconfig
+++ b/nuttx/configs/hymini-stm32v/usbmsc/defconfig
@@ -50,7 +50,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -291,7 +290,6 @@ CONFIG_SDIO_PRI=128
 # CONFIG_ARCH_VECNOTIRQ is not set
 CONFIG_ARCH_DMA=y
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/hymini-stm32v/usbnsh/defconfig b/nuttx/configs/hymini-stm32v/usbnsh/defconfig
index 989224f..44e9c54 100644
--- a/nuttx/configs/hymini-stm32v/usbnsh/defconfig
+++ b/nuttx/configs/hymini-stm32v/usbnsh/defconfig
@@ -43,7 +43,6 @@ CONFIG_RAW_BINARY=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -217,7 +216,6 @@ CONFIG_STM32_USART=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 CONFIG_ARCH_STACKDUMP=y
diff --git a/nuttx/configs/hymini-stm32v/usbserial/defconfig b/nuttx/configs/hymini-stm32v/usbserial/defconfig
index 2426bbf..0588e2b 100644
--- a/nuttx/configs/hymini-stm32v/usbserial/defconfig
+++ b/nuttx/configs/hymini-stm32v/usbserial/defconfig
@@ -50,7 +50,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -281,7 +280,6 @@ CONFIG_STM32_USART=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/kwikstik-k40/ostest/defconfig b/nuttx/configs/kwikstik-k40/ostest/defconfig
index 5627765..13ddc63 100644
--- a/nuttx/configs/kwikstik-k40/ostest/defconfig
+++ b/nuttx/configs/kwikstik-k40/ostest/defconfig
@@ -43,7 +43,6 @@ CONFIG_INTELHEX_BINARY=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -173,7 +172,6 @@ CONFIG_KINETIS_UART5=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 CONFIG_ARCH_STACKDUMP=y
diff --git a/nuttx/configs/lincoln60/nsh/defconfig b/nuttx/configs/lincoln60/nsh/defconfig
index 280e8c4..38564a6 100644
--- a/nuttx/configs/lincoln60/nsh/defconfig
+++ b/nuttx/configs/lincoln60/nsh/defconfig
@@ -50,7 +50,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -191,7 +190,6 @@ CONFIG_LPC17_SSP0=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/lm3s6432-s2e/nsh/defconfig b/nuttx/configs/lm3s6432-s2e/nsh/defconfig
index 87a549d..66d1683 100644
--- a/nuttx/configs/lm3s6432-s2e/nsh/defconfig
+++ b/nuttx/configs/lm3s6432-s2e/nsh/defconfig
@@ -51,7 +51,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -170,7 +169,6 @@ CONFIG_TIVA_BOARDMAC=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/lm3s6965-ek/discover/defconfig b/nuttx/configs/lm3s6965-ek/discover/defconfig
index 94cf499..162a759 100644
--- a/nuttx/configs/lm3s6965-ek/discover/defconfig
+++ b/nuttx/configs/lm3s6965-ek/discover/defconfig
@@ -51,7 +51,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -177,7 +176,6 @@ CONFIG_SSI_TXLIMIT=4
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/lm3s6965-ek/nsh/defconfig b/nuttx/configs/lm3s6965-ek/nsh/defconfig
index 94cf499..162a759 100644
--- a/nuttx/configs/lm3s6965-ek/nsh/defconfig
+++ b/nuttx/configs/lm3s6965-ek/nsh/defconfig
@@ -51,7 +51,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -177,7 +176,6 @@ CONFIG_SSI_TXLIMIT=4
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/lm3s6965-ek/nx/defconfig b/nuttx/configs/lm3s6965-ek/nx/defconfig
index fa77c16..9b8ffb0 100644
--- a/nuttx/configs/lm3s6965-ek/nx/defconfig
+++ b/nuttx/configs/lm3s6965-ek/nx/defconfig
@@ -51,7 +51,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -162,7 +161,6 @@ CONFIG_SSI_TXLIMIT=4
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/lm3s6965-ek/tcpecho/defconfig b/nuttx/configs/lm3s6965-ek/tcpecho/defconfig
index 03d6b1d..819ea87 100644
--- a/nuttx/configs/lm3s6965-ek/tcpecho/defconfig
+++ b/nuttx/configs/lm3s6965-ek/tcpecho/defconfig
@@ -73,7 +73,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -199,7 +198,6 @@ CONFIG_SSI_TXLIMIT=4
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/lm3s8962-ek/nsh/defconfig b/nuttx/configs/lm3s8962-ek/nsh/defconfig
index 488c428..6c0b19b 100644
--- a/nuttx/configs/lm3s8962-ek/nsh/defconfig
+++ b/nuttx/configs/lm3s8962-ek/nsh/defconfig
@@ -55,7 +55,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -185,7 +184,6 @@ CONFIG_SSI_TXLIMIT=4
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/lm3s8962-ek/nx/defconfig b/nuttx/configs/lm3s8962-ek/nx/defconfig
index 56c7bb1..416de16 100644
--- a/nuttx/configs/lm3s8962-ek/nx/defconfig
+++ b/nuttx/configs/lm3s8962-ek/nx/defconfig
@@ -55,7 +55,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -170,7 +169,6 @@ CONFIG_SSI_TXLIMIT=4
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/lm4f120-launchpad/nsh/defconfig b/nuttx/configs/lm4f120-launchpad/nsh/defconfig
index 4f31c7f..c49a434 100644
--- a/nuttx/configs/lm4f120-launchpad/nsh/defconfig
+++ b/nuttx/configs/lm4f120-launchpad/nsh/defconfig
@@ -51,7 +51,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -168,7 +167,6 @@ CONFIG_SSI_TXLIMIT=4
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/lpc4330-xplorer/nsh/defconfig b/nuttx/configs/lpc4330-xplorer/nsh/defconfig
index a7c4a0a..d8fd283 100644
--- a/nuttx/configs/lpc4330-xplorer/nsh/defconfig
+++ b/nuttx/configs/lpc4330-xplorer/nsh/defconfig
@@ -54,7 +54,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -197,7 +196,6 @@ CONFIG_LPC43_USART0=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/lpcxpresso-lpc1768/dhcpd/defconfig b/nuttx/configs/lpcxpresso-lpc1768/dhcpd/defconfig
index ed0edde..c203ade 100644
--- a/nuttx/configs/lpcxpresso-lpc1768/dhcpd/defconfig
+++ b/nuttx/configs/lpcxpresso-lpc1768/dhcpd/defconfig
@@ -52,7 +52,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -205,7 +204,6 @@ CONFIG_NET_NRXDESC=18
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/lpcxpresso-lpc1768/nsh/defconfig b/nuttx/configs/lpcxpresso-lpc1768/nsh/defconfig
index 1a4edc6..695f8eb 100644
--- a/nuttx/configs/lpcxpresso-lpc1768/nsh/defconfig
+++ b/nuttx/configs/lpcxpresso-lpc1768/nsh/defconfig
@@ -52,7 +52,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -205,7 +204,6 @@ CONFIG_NET_NRXDESC=7
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/lpcxpresso-lpc1768/nx/defconfig b/nuttx/configs/lpcxpresso-lpc1768/nx/defconfig
index 58c2a64..dbc2995 100644
--- a/nuttx/configs/lpcxpresso-lpc1768/nx/defconfig
+++ b/nuttx/configs/lpcxpresso-lpc1768/nx/defconfig
@@ -52,7 +52,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -194,7 +193,6 @@ CONFIG_LPC17_SSP1=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/lpcxpresso-lpc1768/thttpd/defconfig b/nuttx/configs/lpcxpresso-lpc1768/thttpd/defconfig
index 027cf87..ae6bb74 100644
--- a/nuttx/configs/lpcxpresso-lpc1768/thttpd/defconfig
+++ b/nuttx/configs/lpcxpresso-lpc1768/thttpd/defconfig
@@ -52,7 +52,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -205,7 +204,6 @@ CONFIG_NET_NRXDESC=18
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/lpcxpresso-lpc1768/usbmsc/defconfig b/nuttx/configs/lpcxpresso-lpc1768/usbmsc/defconfig
index 9e4a99d..eae3ff6 100644
--- a/nuttx/configs/lpcxpresso-lpc1768/usbmsc/defconfig
+++ b/nuttx/configs/lpcxpresso-lpc1768/usbmsc/defconfig
@@ -52,7 +52,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -205,7 +204,6 @@ CONFIG_LPC17_USBDEV_NOLED=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/maple/nsh/defconfig b/nuttx/configs/maple/nsh/defconfig
index b567df9..f31ae45 100644
--- a/nuttx/configs/maple/nsh/defconfig
+++ b/nuttx/configs/maple/nsh/defconfig
@@ -47,7 +47,6 @@ CONFIG_ARCH_HAVE_HEAPCHECK=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -271,7 +270,6 @@ CONFIG_STM32_USART=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_IRQPRIO is not set
diff --git a/nuttx/configs/maple/nx/defconfig b/nuttx/configs/maple/nx/defconfig
index c9acf7a..97a78de 100644
--- a/nuttx/configs/maple/nx/defconfig
+++ b/nuttx/configs/maple/nx/defconfig
@@ -47,7 +47,6 @@ CONFIG_ARCH_HAVE_HEAPCHECK=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -295,7 +294,6 @@ CONFIG_STM32_I2CTIMEOTICKS=500
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_IRQPRIO is not set
diff --git a/nuttx/configs/maple/usbnsh/defconfig b/nuttx/configs/maple/usbnsh/defconfig
index 9b592cf..ef78d12 100644
--- a/nuttx/configs/maple/usbnsh/defconfig
+++ b/nuttx/configs/maple/usbnsh/defconfig
@@ -47,7 +47,6 @@ CONFIG_ARCH_HAVE_HEAPCHECK=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -271,7 +270,6 @@ CONFIG_STM32_USART=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_IRQPRIO is not set
diff --git a/nuttx/configs/mbed/hidkbd/defconfig b/nuttx/configs/mbed/hidkbd/defconfig
index 44045f7..f67cf8b 100644
--- a/nuttx/configs/mbed/hidkbd/defconfig
+++ b/nuttx/configs/mbed/hidkbd/defconfig
@@ -49,7 +49,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -204,7 +203,6 @@ CONFIG_USBHOST_ISOC_DISABLE=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/mbed/nsh/defconfig b/nuttx/configs/mbed/nsh/defconfig
index 6e792f4..c141e10 100644
--- a/nuttx/configs/mbed/nsh/defconfig
+++ b/nuttx/configs/mbed/nsh/defconfig
@@ -49,7 +49,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -191,7 +190,6 @@ CONFIG_LPC17_SSP0=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/mcu123-lpc214x/composite/defconfig b/nuttx/configs/mcu123-lpc214x/composite/defconfig
index 652e29d..de231f9 100644
--- a/nuttx/configs/mcu123-lpc214x/composite/defconfig
+++ b/nuttx/configs/mcu123-lpc214x/composite/defconfig
@@ -50,7 +50,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -154,7 +153,6 @@ CONFIG_LPC214X_USBDEV=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/mcu123-lpc214x/nsh/defconfig b/nuttx/configs/mcu123-lpc214x/nsh/defconfig
index 74f8405..b5749b4 100644
--- a/nuttx/configs/mcu123-lpc214x/nsh/defconfig
+++ b/nuttx/configs/mcu123-lpc214x/nsh/defconfig
@@ -43,7 +43,6 @@ CONFIG_RAW_BINARY=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -128,7 +127,6 @@ CONFIG_LPC214X_UART1=y
 # CONFIG_ARCH_NOINTC is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_STACKDUMP=y
 # CONFIG_ENDIAN_BIG is not set
diff --git a/nuttx/configs/mcu123-lpc214x/usbmsc/defconfig b/nuttx/configs/mcu123-lpc214x/usbmsc/defconfig
index 9df87f4..0e22b27 100644
--- a/nuttx/configs/mcu123-lpc214x/usbmsc/defconfig
+++ b/nuttx/configs/mcu123-lpc214x/usbmsc/defconfig
@@ -50,7 +50,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -154,7 +153,6 @@ CONFIG_LPC214X_USBDEV=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/mcu123-lpc214x/usbserial/defconfig b/nuttx/configs/mcu123-lpc214x/usbserial/defconfig
index cd33829..5094d8e 100644
--- a/nuttx/configs/mcu123-lpc214x/usbserial/defconfig
+++ b/nuttx/configs/mcu123-lpc214x/usbserial/defconfig
@@ -50,7 +50,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -154,7 +153,6 @@ CONFIG_LPC214X_USBDEV=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/micropendous3/hello/defconfig b/nuttx/configs/micropendous3/hello/defconfig
index ae1ca03..a14c54e 100644
--- a/nuttx/configs/micropendous3/hello/defconfig
+++ b/nuttx/configs/micropendous3/hello/defconfig
@@ -54,7 +54,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 CONFIG_ARCH_AVR=y
 # CONFIG_ARCH_HC is not set
@@ -104,7 +103,6 @@ CONFIG_ARCH_NOINTC=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 # CONFIG_ARCH_HAVE_VFORK is not set
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/mikroe-stm32f4/fulldemo/defconfig b/nuttx/configs/mikroe-stm32f4/fulldemo/defconfig
index 0d41d1b..6239b78 100644
--- a/nuttx/configs/mikroe-stm32f4/fulldemo/defconfig
+++ b/nuttx/configs/mikroe-stm32f4/fulldemo/defconfig
@@ -78,7 +78,6 @@ CONFIG_DEBUG_NOOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -339,7 +338,6 @@ CONFIG_STM32_SPI_DMA=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 CONFIG_ARCH_DMA=y
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/mikroe-stm32f4/kostest/defconfig b/nuttx/configs/mikroe-stm32f4/kostest/defconfig
index a2e9808..0e40cba 100644
--- a/nuttx/configs/mikroe-stm32f4/kostest/defconfig
+++ b/nuttx/configs/mikroe-stm32f4/kostest/defconfig
@@ -58,7 +58,6 @@ CONFIG_DEBUG_NOOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -358,7 +357,6 @@ CONFIG_STM32_USART=y
 CONFIG_ARCH_HAVE_IRQPRIO=y
 # CONFIG_ARCH_L2CACHE is not set
 # CONFIG_ARCH_HAVE_COHERENT_DCACHE is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_HAVE_ADDRENV is not set
 # CONFIG_ARCH_NEED_ADDRENV_MAPPING is not set
 CONFIG_ARCH_HAVE_VFORK=y
diff --git a/nuttx/configs/mikroe-stm32f4/nsh/defconfig b/nuttx/configs/mikroe-stm32f4/nsh/defconfig
index b8bc74f..63d87a3 100644
--- a/nuttx/configs/mikroe-stm32f4/nsh/defconfig
+++ b/nuttx/configs/mikroe-stm32f4/nsh/defconfig
@@ -51,7 +51,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -306,7 +305,6 @@ CONFIG_STM32_USART=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/mikroe-stm32f4/nx/defconfig b/nuttx/configs/mikroe-stm32f4/nx/defconfig
index aac9ab6..87607c1 100644
--- a/nuttx/configs/mikroe-stm32f4/nx/defconfig
+++ b/nuttx/configs/mikroe-stm32f4/nx/defconfig
@@ -51,7 +51,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -290,7 +289,6 @@ CONFIG_ARCH_BOARD_STM32_CUSTOM_CLOCKCONFIG=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/mikroe-stm32f4/nxlines/defconfig b/nuttx/configs/mikroe-stm32f4/nxlines/defconfig
index 300414f..fbf88a1 100644
--- a/nuttx/configs/mikroe-stm32f4/nxlines/defconfig
+++ b/nuttx/configs/mikroe-stm32f4/nxlines/defconfig
@@ -51,7 +51,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -290,7 +289,6 @@ CONFIG_ARCH_BOARD_STM32_CUSTOM_CLOCKCONFIG=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/mikroe-stm32f4/nxtext/defconfig b/nuttx/configs/mikroe-stm32f4/nxtext/defconfig
index 62f6282..d383cb4 100644
--- a/nuttx/configs/mikroe-stm32f4/nxtext/defconfig
+++ b/nuttx/configs/mikroe-stm32f4/nxtext/defconfig
@@ -51,7 +51,6 @@ CONFIG_DEBUG_NOOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -290,7 +289,6 @@ CONFIG_ARCH_BOARD_STM32_CUSTOM_CLOCKCONFIG=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/mikroe-stm32f4/src/up_usb.c b/nuttx/configs/mikroe-stm32f4/src/up_usb.c
index b95413b..31d0c6e 100644
--- a/nuttx/configs/mikroe-stm32f4/src/up_usb.c
+++ b/nuttx/configs/mikroe-stm32f4/src/up_usb.c
@@ -193,7 +193,7 @@ int stm32_usbhost_initialize(void)
 
       uvdbg("Start usbhost_waiter\n");
 
-      pid = TASK_CREATE("usbhost", CONFIG_USBHOST_DEFPRIO,
+      pid = task_create("usbhost", CONFIG_USBHOST_DEFPRIO,
                         CONFIG_USBHOST_STACKSIZE,
                         (main_t)usbhost_waiter, (FAR char * const *)NULL);
       return pid < 0 ? -ENOEXEC : OK;
diff --git a/nuttx/configs/mikroe-stm32f4/usbnsh/defconfig b/nuttx/configs/mikroe-stm32f4/usbnsh/defconfig
index cae9a05..ef9e43c 100644
--- a/nuttx/configs/mikroe-stm32f4/usbnsh/defconfig
+++ b/nuttx/configs/mikroe-stm32f4/usbnsh/defconfig
@@ -51,7 +51,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -306,7 +305,6 @@ CONFIG_STM32_USART=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/mirtoo/nsh/defconfig b/nuttx/configs/mirtoo/nsh/defconfig
index 72fcc4c..bff77ec 100644
--- a/nuttx/configs/mirtoo/nsh/defconfig
+++ b/nuttx/configs/mirtoo/nsh/defconfig
@@ -54,7 +54,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -255,7 +254,6 @@ CONFIG_PIC32MX_FMIIEN=1
 CONFIG_ARCH_VECNOTIRQ=y
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/mirtoo/nxffs/defconfig b/nuttx/configs/mirtoo/nxffs/defconfig
index 7890a54..9776aca 100644
--- a/nuttx/configs/mirtoo/nxffs/defconfig
+++ b/nuttx/configs/mirtoo/nxffs/defconfig
@@ -54,7 +54,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -256,7 +255,6 @@ CONFIG_PIC32MX_FMIIEN=1
 CONFIG_ARCH_VECNOTIRQ=y
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/mx1ads/ostest/defconfig b/nuttx/configs/mx1ads/ostest/defconfig
index 8bfaf53..abde642 100644
--- a/nuttx/configs/mx1ads/ostest/defconfig
+++ b/nuttx/configs/mx1ads/ostest/defconfig
@@ -53,7 +53,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -124,7 +123,6 @@ CONFIG_RAM_NUTTXENTRY=0x01004000
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
 # CONFIG_ARCH_L2CACHE is not set
 # CONFIG_ARCH_HAVE_COHERENT_DCACHE is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_HAVE_ADDRENV is not set
 # CONFIG_ARCH_NEED_ADDRENV_MAPPING is not set
 CONFIG_ARCH_HAVE_VFORK=y
diff --git a/nuttx/configs/ne64badge/ostest/defconfig b/nuttx/configs/ne64badge/ostest/defconfig
index ab72db8..c8eb354 100644
--- a/nuttx/configs/ne64badge/ostest/defconfig
+++ b/nuttx/configs/ne64badge/ostest/defconfig
@@ -49,7 +49,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 # CONFIG_ARCH_AVR is not set
 CONFIG_ARCH_HC=y
@@ -100,7 +99,6 @@ CONFIG_ARCH_NOINTC=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 # CONFIG_ARCH_HAVE_VFORK is not set
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/ntosd-dm320/nettest/defconfig b/nuttx/configs/ntosd-dm320/nettest/defconfig
index 606b6bb..b840dee 100644
--- a/nuttx/configs/ntosd-dm320/nettest/defconfig
+++ b/nuttx/configs/ntosd-dm320/nettest/defconfig
@@ -53,7 +53,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -132,7 +131,6 @@ CONFIG_DM320_UART1=y
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
 # CONFIG_ARCH_L2CACHE is not set
 # CONFIG_ARCH_HAVE_COHERENT_DCACHE is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_HAVE_ADDRENV is not set
 # CONFIG_ARCH_NEED_ADDRENV_MAPPING is not set
 CONFIG_ARCH_HAVE_VFORK=y
diff --git a/nuttx/configs/ntosd-dm320/nsh/defconfig b/nuttx/configs/ntosd-dm320/nsh/defconfig
index 1de9cdf..16dba42 100644
--- a/nuttx/configs/ntosd-dm320/nsh/defconfig
+++ b/nuttx/configs/ntosd-dm320/nsh/defconfig
@@ -53,7 +53,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -132,7 +131,6 @@ CONFIG_DM320_UART1=y
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
 # CONFIG_ARCH_L2CACHE is not set
 # CONFIG_ARCH_HAVE_COHERENT_DCACHE is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_HAVE_ADDRENV is not set
 # CONFIG_ARCH_NEED_ADDRENV_MAPPING is not set
 CONFIG_ARCH_HAVE_VFORK=y
diff --git a/nuttx/configs/ntosd-dm320/poll/defconfig b/nuttx/configs/ntosd-dm320/poll/defconfig
index 3bd803d..35507ba 100644
--- a/nuttx/configs/ntosd-dm320/poll/defconfig
+++ b/nuttx/configs/ntosd-dm320/poll/defconfig
@@ -53,7 +53,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -132,7 +131,6 @@ CONFIG_DM320_UART1=y
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
 # CONFIG_ARCH_L2CACHE is not set
 # CONFIG_ARCH_HAVE_COHERENT_DCACHE is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_HAVE_ADDRENV is not set
 # CONFIG_ARCH_NEED_ADDRENV_MAPPING is not set
 CONFIG_ARCH_HAVE_VFORK=y
diff --git a/nuttx/configs/ntosd-dm320/thttpd/defconfig b/nuttx/configs/ntosd-dm320/thttpd/defconfig
index 7677d21..a3325b1 100644
--- a/nuttx/configs/ntosd-dm320/thttpd/defconfig
+++ b/nuttx/configs/ntosd-dm320/thttpd/defconfig
@@ -53,7 +53,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -132,7 +131,6 @@ CONFIG_DM320_UART1=y
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
 # CONFIG_ARCH_L2CACHE is not set
 # CONFIG_ARCH_HAVE_COHERENT_DCACHE is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_HAVE_ADDRENV is not set
 # CONFIG_ARCH_NEED_ADDRENV_MAPPING is not set
 CONFIG_ARCH_HAVE_VFORK=y
diff --git a/nuttx/configs/ntosd-dm320/udp/defconfig b/nuttx/configs/ntosd-dm320/udp/defconfig
index 97b8776..066c201 100644
--- a/nuttx/configs/ntosd-dm320/udp/defconfig
+++ b/nuttx/configs/ntosd-dm320/udp/defconfig
@@ -53,7 +53,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -132,7 +131,6 @@ CONFIG_DM320_UART1=y
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
 # CONFIG_ARCH_L2CACHE is not set
 # CONFIG_ARCH_HAVE_COHERENT_DCACHE is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_HAVE_ADDRENV is not set
 # CONFIG_ARCH_NEED_ADDRENV_MAPPING is not set
 CONFIG_ARCH_HAVE_VFORK=y
diff --git a/nuttx/configs/ntosd-dm320/webserver/defconfig b/nuttx/configs/ntosd-dm320/webserver/defconfig
index 990fd4e..5bc5fc0 100644
--- a/nuttx/configs/ntosd-dm320/webserver/defconfig
+++ b/nuttx/configs/ntosd-dm320/webserver/defconfig
@@ -53,7 +53,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -132,7 +131,6 @@ CONFIG_DM320_UART1=y
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
 # CONFIG_ARCH_L2CACHE is not set
 # CONFIG_ARCH_HAVE_COHERENT_DCACHE is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_HAVE_ADDRENV is not set
 # CONFIG_ARCH_NEED_ADDRENV_MAPPING is not set
 CONFIG_ARCH_HAVE_VFORK=y
diff --git a/nuttx/configs/nucleo-f401re/nsh/defconfig b/nuttx/configs/nucleo-f401re/nsh/defconfig
index f7f41dd..42c5c83 100644
--- a/nuttx/configs/nucleo-f401re/nsh/defconfig
+++ b/nuttx/configs/nucleo-f401re/nsh/defconfig
@@ -52,7 +52,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -319,7 +318,6 @@ CONFIG_STM32_USART=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/nucleus2g/nsh/defconfig b/nuttx/configs/nucleus2g/nsh/defconfig
index c5bc964..972bf70 100644
--- a/nuttx/configs/nucleus2g/nsh/defconfig
+++ b/nuttx/configs/nucleus2g/nsh/defconfig
@@ -54,7 +54,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -200,7 +199,6 @@ CONFIG_LPC17_SSP0=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/nucleus2g/usbmsc/defconfig b/nuttx/configs/nucleus2g/usbmsc/defconfig
index 02e4488..054253d 100644
--- a/nuttx/configs/nucleus2g/usbmsc/defconfig
+++ b/nuttx/configs/nucleus2g/usbmsc/defconfig
@@ -50,7 +50,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -191,7 +190,6 @@ CONFIG_LPC17_SSP0=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/nucleus2g/usbserial/defconfig b/nuttx/configs/nucleus2g/usbserial/defconfig
index 25c3d69..76b3342 100644
--- a/nuttx/configs/nucleus2g/usbserial/defconfig
+++ b/nuttx/configs/nucleus2g/usbserial/defconfig
@@ -43,7 +43,6 @@ CONFIG_INTELHEX_BINARY=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -185,7 +184,6 @@ CONFIG_LPC17_USBDEV_NDMADESCRIPTORS=0
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 CONFIG_ARCH_STACKDUMP=y
diff --git a/nuttx/configs/nutiny-nuc120/nsh/defconfig b/nuttx/configs/nutiny-nuc120/nsh/defconfig
index 2f7f371..f7671f9 100644
--- a/nuttx/configs/nutiny-nuc120/nsh/defconfig
+++ b/nuttx/configs/nutiny-nuc120/nsh/defconfig
@@ -48,7 +48,6 @@ CONFIG_RAW_BINARY=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -183,7 +182,6 @@ CONFIG_NUC_UARTCLK_INTHI=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 CONFIG_ARCH_STACKDUMP=y
diff --git a/nuttx/configs/olimex-lpc-h3131/nsh/defconfig b/nuttx/configs/olimex-lpc-h3131/nsh/defconfig
index 94e6770..046d985 100644
--- a/nuttx/configs/olimex-lpc-h3131/nsh/defconfig
+++ b/nuttx/configs/olimex-lpc-h3131/nsh/defconfig
@@ -57,7 +57,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -164,7 +163,6 @@ CONFIG_ARCH_HAVE_EXTSRAM1=y
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
 # CONFIG_ARCH_L2CACHE is not set
 # CONFIG_ARCH_HAVE_COHERENT_DCACHE is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_HAVE_ADDRENV is not set
 # CONFIG_ARCH_NEED_ADDRENV_MAPPING is not set
 CONFIG_ARCH_HAVE_VFORK=y
diff --git a/nuttx/configs/olimex-lpc-h3131/src/lpc31_usbhost.c b/nuttx/configs/olimex-lpc-h3131/src/lpc31_usbhost.c
index f321123..1433cce 100644
--- a/nuttx/configs/olimex-lpc-h3131/src/lpc31_usbhost.c
+++ b/nuttx/configs/olimex-lpc-h3131/src/lpc31_usbhost.c
@@ -216,7 +216,7 @@ int lpc31_usbhost_initialize(void)
 
   /* Start a thread to handle device connection. */
 
-  pid = TASK_CREATE("EHCI Monitor", CONFIG_USBHOST_DEFPRIO,  CONFIG_USBHOST_STACKSIZE,
+  pid = task_create("EHCI Monitor", CONFIG_USBHOST_DEFPRIO,  CONFIG_USBHOST_STACKSIZE,
                     (main_t)ehci_waiter, (FAR char * const *)NULL);
   if (pid < 0)
     {
diff --git a/nuttx/configs/olimex-lpc1766stk/ftpc/defconfig b/nuttx/configs/olimex-lpc1766stk/ftpc/defconfig
index c54c446..bb34464 100644
--- a/nuttx/configs/olimex-lpc1766stk/ftpc/defconfig
+++ b/nuttx/configs/olimex-lpc1766stk/ftpc/defconfig
@@ -52,7 +52,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -205,7 +204,6 @@ CONFIG_NET_NRXDESC=7
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/olimex-lpc1766stk/hidkbd/defconfig b/nuttx/configs/olimex-lpc1766stk/hidkbd/defconfig
index 3f91c32..41ad8a7 100644
--- a/nuttx/configs/olimex-lpc1766stk/hidkbd/defconfig
+++ b/nuttx/configs/olimex-lpc1766stk/hidkbd/defconfig
@@ -56,7 +56,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -215,7 +214,6 @@ CONFIG_USBHOST_ISOC_DISABLE=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/olimex-lpc1766stk/hidmouse/defconfig b/nuttx/configs/olimex-lpc1766stk/hidmouse/defconfig
index 4fe9972..d78b27d 100644
--- a/nuttx/configs/olimex-lpc1766stk/hidmouse/defconfig
+++ b/nuttx/configs/olimex-lpc1766stk/hidmouse/defconfig
@@ -56,7 +56,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -216,7 +215,6 @@ CONFIG_USBHOST_ISOC_DISABLE=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/olimex-lpc1766stk/nettest/defconfig b/nuttx/configs/olimex-lpc1766stk/nettest/defconfig
index ae10e46..eefa3df 100644
--- a/nuttx/configs/olimex-lpc1766stk/nettest/defconfig
+++ b/nuttx/configs/olimex-lpc1766stk/nettest/defconfig
@@ -52,7 +52,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -206,7 +205,6 @@ CONFIG_NET_NRXDESC=9
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/olimex-lpc1766stk/nsh/defconfig b/nuttx/configs/olimex-lpc1766stk/nsh/defconfig
index 509307b..ca9bbd7 100644
--- a/nuttx/configs/olimex-lpc1766stk/nsh/defconfig
+++ b/nuttx/configs/olimex-lpc1766stk/nsh/defconfig
@@ -52,7 +52,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -206,7 +205,6 @@ CONFIG_NET_NRXDESC=7
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/olimex-lpc1766stk/nx/defconfig b/nuttx/configs/olimex-lpc1766stk/nx/defconfig
index d5a6cd6..46a004f 100644
--- a/nuttx/configs/olimex-lpc1766stk/nx/defconfig
+++ b/nuttx/configs/olimex-lpc1766stk/nx/defconfig
@@ -56,7 +56,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -203,7 +202,6 @@ CONFIG_LPC17_SSP0=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/olimex-lpc1766stk/slip-httpd/defconfig b/nuttx/configs/olimex-lpc1766stk/slip-httpd/defconfig
index 2f23158..2fc5639 100644
--- a/nuttx/configs/olimex-lpc1766stk/slip-httpd/defconfig
+++ b/nuttx/configs/olimex-lpc1766stk/slip-httpd/defconfig
@@ -52,7 +52,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -197,7 +196,6 @@ CONFIG_LPC17_UART1=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/olimex-lpc1766stk/src/lpc17_nsh.c b/nuttx/configs/olimex-lpc1766stk/src/lpc17_nsh.c
index c281077..204ac7f 100644
--- a/nuttx/configs/olimex-lpc1766stk/src/lpc17_nsh.c
+++ b/nuttx/configs/olimex-lpc1766stk/src/lpc17_nsh.c
@@ -279,14 +279,9 @@ static int nsh_usbhostinitialize(void)
 
       message("nsh_usbhostinitialize: Start nsh_waiter\n");
 
-#ifndef CONFIG_CUSTOM_STACK
       pid = task_create("usbhost", CONFIG_USBHOST_DEFPRIO,
                         CONFIG_USBHOST_STACKSIZE,
                         (main_t)nsh_waiter, (FAR char * const *)NULL);
-#else
-      pid = task_create("usbhost", CONFIG_USBHOST_DEFPRIO,
-                        (main_t)nsh_waiter, (FAR char * const *)NULL);
-#endif
       return pid < 0 ? -ENOEXEC : OK;
     }
   return -ENODEV;
diff --git a/nuttx/configs/olimex-lpc1766stk/thttpd/defconfig b/nuttx/configs/olimex-lpc1766stk/thttpd/defconfig
index c90d1f8..9ad871a 100644
--- a/nuttx/configs/olimex-lpc1766stk/thttpd/defconfig
+++ b/nuttx/configs/olimex-lpc1766stk/thttpd/defconfig
@@ -52,7 +52,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -206,7 +205,6 @@ CONFIG_NET_NRXDESC=18
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/olimex-lpc1766stk/usbmsc/defconfig b/nuttx/configs/olimex-lpc1766stk/usbmsc/defconfig
index ac5ff57..03c6cb4 100644
--- a/nuttx/configs/olimex-lpc1766stk/usbmsc/defconfig
+++ b/nuttx/configs/olimex-lpc1766stk/usbmsc/defconfig
@@ -52,7 +52,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -206,7 +205,6 @@ CONFIG_LPC17_USBDEV_NDMADESCRIPTORS=0
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/olimex-lpc1766stk/usbserial/defconfig b/nuttx/configs/olimex-lpc1766stk/usbserial/defconfig
index ed2f400..42ebac0 100644
--- a/nuttx/configs/olimex-lpc1766stk/usbserial/defconfig
+++ b/nuttx/configs/olimex-lpc1766stk/usbserial/defconfig
@@ -52,7 +52,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -206,7 +205,6 @@ CONFIG_LPC17_USBDEV_NDMADESCRIPTORS=0
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/olimex-lpc1766stk/zmodem/defconfig b/nuttx/configs/olimex-lpc1766stk/zmodem/defconfig
index 89775da..d2c382f 100644
--- a/nuttx/configs/olimex-lpc1766stk/zmodem/defconfig
+++ b/nuttx/configs/olimex-lpc1766stk/zmodem/defconfig
@@ -52,7 +52,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -207,7 +206,6 @@ CONFIG_NET_NRXDESC=7
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/olimex-lpc2378/nsh/defconfig b/nuttx/configs/olimex-lpc2378/nsh/defconfig
index a76584f..df04ea1 100644
--- a/nuttx/configs/olimex-lpc2378/nsh/defconfig
+++ b/nuttx/configs/olimex-lpc2378/nsh/defconfig
@@ -51,7 +51,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -137,7 +136,6 @@ CONFIG_LPC2378_UART2=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/olimex-stm32-h405/nshusb/defconfig b/nuttx/configs/olimex-stm32-h405/nshusb/defconfig
index 94c5f6c..1bd759b 100644
--- a/nuttx/configs/olimex-stm32-h405/nshusb/defconfig
+++ b/nuttx/configs/olimex-stm32-h405/nshusb/defconfig
@@ -52,7 +52,6 @@ CONFIG_DEBUG_NOOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -320,7 +319,6 @@ CONFIG_STM32_USART=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/olimex-stm32-p107/nsh/defconfig b/nuttx/configs/olimex-stm32-p107/nsh/defconfig
index 09f7e0f..5bdcdbd 100644
--- a/nuttx/configs/olimex-stm32-p107/nsh/defconfig
+++ b/nuttx/configs/olimex-stm32-p107/nsh/defconfig
@@ -43,7 +43,6 @@ CONFIG_INTELHEX_BINARY=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -275,7 +274,6 @@ CONFIG_STM32_RMII_MCO=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 CONFIG_ARCH_STACKDUMP=y
diff --git a/nuttx/configs/olimex-stm32-p207/nsh/defconfig b/nuttx/configs/olimex-stm32-p207/nsh/defconfig
index 4acf410..20952a5 100644
--- a/nuttx/configs/olimex-stm32-p207/nsh/defconfig
+++ b/nuttx/configs/olimex-stm32-p207/nsh/defconfig
@@ -43,7 +43,6 @@ CONFIG_DEBUG_SYMBOLS=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -323,7 +322,6 @@ CONFIG_STM32_OTGFS_DESCSIZE=128
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 CONFIG_ARCH_STACKDUMP=y
diff --git a/nuttx/configs/olimex-stm32-p207/src/up_usb.c b/nuttx/configs/olimex-stm32-p207/src/up_usb.c
index 15711b3..025575d 100644
--- a/nuttx/configs/olimex-stm32-p207/src/up_usb.c
+++ b/nuttx/configs/olimex-stm32-p207/src/up_usb.c
@@ -190,7 +190,7 @@ int stm32_usbhost_initialize(void)
 
       uvdbg("Start usbhost_waiter\n");
 
-      pid = TASK_CREATE("usbhost", CONFIG_USBHOST_DEFPRIO,
+      pid = task_create("usbhost", CONFIG_USBHOST_DEFPRIO,
                         CONFIG_USBHOST_STACKSIZE,
                         (main_t)usbhost_waiter, (FAR char * const *)NULL);
       return pid < 0 ? -ENOEXEC : OK;
diff --git a/nuttx/configs/olimex-strp711/nettest/defconfig b/nuttx/configs/olimex-strp711/nettest/defconfig
index 73fdd1e..2192bd0 100644
--- a/nuttx/configs/olimex-strp711/nettest/defconfig
+++ b/nuttx/configs/olimex-strp711/nettest/defconfig
@@ -50,7 +50,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -156,7 +155,6 @@ CONFIG_STR71X_XTI=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/olimex-strp711/nsh/defconfig b/nuttx/configs/olimex-strp711/nsh/defconfig
index 4dc3d2a..7c9f772 100644
--- a/nuttx/configs/olimex-strp711/nsh/defconfig
+++ b/nuttx/configs/olimex-strp711/nsh/defconfig
@@ -50,7 +50,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -155,7 +154,6 @@ CONFIG_STR71X_UART1=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/open1788/knsh/defconfig b/nuttx/configs/open1788/knsh/defconfig
index 5380be0..8200ce4 100644
--- a/nuttx/configs/open1788/knsh/defconfig
+++ b/nuttx/configs/open1788/knsh/defconfig
@@ -58,7 +58,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -215,7 +214,6 @@ CONFIG_ARCH_DMA=y
 CONFIG_ARCH_HAVE_IRQPRIO=y
 # CONFIG_ARCH_L2CACHE is not set
 # CONFIG_ARCH_HAVE_COHERENT_DCACHE is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_HAVE_ADDRENV is not set
 # CONFIG_ARCH_NEED_ADDRENV_MAPPING is not set
 CONFIG_ARCH_HAVE_VFORK=y
diff --git a/nuttx/configs/open1788/nsh/defconfig b/nuttx/configs/open1788/nsh/defconfig
index f0b2ca3..e1408fa 100644
--- a/nuttx/configs/open1788/nsh/defconfig
+++ b/nuttx/configs/open1788/nsh/defconfig
@@ -43,7 +43,6 @@ CONFIG_INTELHEX_BINARY=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -187,7 +186,6 @@ CONFIG_SDIO_DMAPRIO=0x0
 # CONFIG_ARCH_VECNOTIRQ is not set
 CONFIG_ARCH_DMA=y
 # CONFIG_ARCH_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 CONFIG_ARCH_STACKDUMP=y
diff --git a/nuttx/configs/open1788/nxlines/defconfig b/nuttx/configs/open1788/nxlines/defconfig
index 37bfb55..7911d1c 100644
--- a/nuttx/configs/open1788/nxlines/defconfig
+++ b/nuttx/configs/open1788/nxlines/defconfig
@@ -43,7 +43,6 @@ CONFIG_INTELHEX_BINARY=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -222,7 +221,6 @@ CONFIG_LPC17_EXTDRAMHEAP=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 CONFIG_ARCH_STACKDUMP=y
diff --git a/nuttx/configs/open1788/src/lpc17_nsh.c b/nuttx/configs/open1788/src/lpc17_nsh.c
index 18ec046..56f01ce 100644
--- a/nuttx/configs/open1788/src/lpc17_nsh.c
+++ b/nuttx/configs/open1788/src/lpc17_nsh.c
@@ -343,14 +343,9 @@ static int nsh_usbhostinitialize(void)
 
       message("nsh_usbhostinitialize: Start nsh_waiter\n");
 
-#ifndef CONFIG_CUSTOM_STACK
       pid = task_create("usbhost", CONFIG_USBHOST_DEFPRIO,
                         CONFIG_USBHOST_STACKSIZE,
                         (main_t)nsh_waiter, (FAR char * const *)NULL);
-#else
-      pid = task_create("usbhost", CONFIG_USBHOST_DEFPRIO,
-                        (main_t)nsh_waiter, (FAR char * const *)NULL);
-#endif
       return pid < 0 ? -ENOEXEC : OK;
     }
   return -ENODEV;
diff --git a/nuttx/configs/p112/ostest/defconfig b/nuttx/configs/p112/ostest/defconfig
index 52c09ac..763d39f 100644
--- a/nuttx/configs/p112/ostest/defconfig
+++ b/nuttx/configs/p112/ostest/defconfig
@@ -49,7 +49,6 @@ CONFIG_WINDOWS_NATIVE=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -162,7 +161,6 @@ CONFIG_Z180_ESCCA_2STOP=0
 CONFIG_ARCH_NOINTC=y
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 CONFIG_ARCH_ADDRENV=y
 # CONFIG_ARCH_STACKDUMP is not set
 # CONFIG_ENDIAN_BIG is not set
diff --git a/nuttx/configs/pcblogic-pic32mx/nsh/defconfig b/nuttx/configs/pcblogic-pic32mx/nsh/defconfig
index 30ef6a9..53da51d 100644
--- a/nuttx/configs/pcblogic-pic32mx/nsh/defconfig
+++ b/nuttx/configs/pcblogic-pic32mx/nsh/defconfig
@@ -47,7 +47,6 @@ CONFIG_INTELHEX_BINARY=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -245,7 +244,6 @@ CONFIG_PIC32MX_FMIIEN=1
 CONFIG_ARCH_VECNOTIRQ=y
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 CONFIG_ARCH_STACKDUMP=y
diff --git a/nuttx/configs/pcduino-a10/nsh/defconfig b/nuttx/configs/pcduino-a10/nsh/defconfig
index 8da8b0f..2d4e100 100644
--- a/nuttx/configs/pcduino-a10/nsh/defconfig
+++ b/nuttx/configs/pcduino-a10/nsh/defconfig
@@ -57,7 +57,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -217,7 +216,6 @@ CONFIG_A1X_DDR_MAPSIZE=1073741824
 CONFIG_ARCH_HAVE_IRQPRIO=y
 # CONFIG_ARCH_L2CACHE is not set
 # CONFIG_ARCH_HAVE_COHERENT_DCACHE is not set
-# CONFIG_CUSTOM_STACK is not set
 CONFIG_ARCH_HAVE_ADDRENV=y
 CONFIG_ARCH_NEED_ADDRENV_MAPPING=y
 CONFIG_ARCH_HAVE_VFORK=y
diff --git a/nuttx/configs/pic32-starterkit/nsh/defconfig b/nuttx/configs/pic32-starterkit/nsh/defconfig
index 94a9b8f..72e204c 100644
--- a/nuttx/configs/pic32-starterkit/nsh/defconfig
+++ b/nuttx/configs/pic32-starterkit/nsh/defconfig
@@ -55,7 +55,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -255,7 +254,6 @@ CONFIG_PIC32MX_FMIIEN=0
 CONFIG_ARCH_VECNOTIRQ=y
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/pic32-starterkit/nsh2/defconfig b/nuttx/configs/pic32-starterkit/nsh2/defconfig
index 110487e..dec632a 100644
--- a/nuttx/configs/pic32-starterkit/nsh2/defconfig
+++ b/nuttx/configs/pic32-starterkit/nsh2/defconfig
@@ -55,7 +55,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -264,7 +263,6 @@ CONFIG_PIC32MX_FMIIEN=0
 CONFIG_ARCH_VECNOTIRQ=y
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/pic32-starterkit/src/up_nsh.c b/nuttx/configs/pic32-starterkit/src/up_nsh.c
index 4eda69b..6500e0a 100644
--- a/nuttx/configs/pic32-starterkit/src/up_nsh.c
+++ b/nuttx/configs/pic32-starterkit/src/up_nsh.c
@@ -307,14 +307,9 @@ static int nsh_usbhostinitialize(void)
 
       message("nsh_usbhostinitialize: Start nsh_waiter\n");
 
-#ifndef CONFIG_CUSTOM_STACK
       pid = task_create("usbhost", CONFIG_USBHOST_DEFPRIO,
                         CONFIG_USBHOST_STACKSIZE,
                         (main_t)nsh_waiter, (FAR char * const *)NULL);
-#else
-      pid = task_create("usbhost", CONFIG_USBHOST_DEFPRIO,
-                        (main_t)nsh_waiter, (FAR char * const *)NULL);
-#endif
       return pid < 0 ? -ENOEXEC : OK;
     }
   return -ENODEV;
diff --git a/nuttx/configs/pic32mx7mmb/nsh/defconfig b/nuttx/configs/pic32mx7mmb/nsh/defconfig
index ce7cb62..903e2a8 100644
--- a/nuttx/configs/pic32mx7mmb/nsh/defconfig
+++ b/nuttx/configs/pic32mx7mmb/nsh/defconfig
@@ -55,7 +55,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -269,7 +268,6 @@ CONFIG_PIC32MX_FMIIEN=0
 CONFIG_ARCH_VECNOTIRQ=y
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/pic32mx7mmb/src/up_nsh.c b/nuttx/configs/pic32mx7mmb/src/up_nsh.c
index e70ba56..77bfeda 100644
--- a/nuttx/configs/pic32mx7mmb/src/up_nsh.c
+++ b/nuttx/configs/pic32mx7mmb/src/up_nsh.c
@@ -315,14 +315,9 @@ static int nsh_usbhostinitialize(void)
 
       message("nsh_usbhostinitialize: Start nsh_waiter\n");
 
-#ifndef CONFIG_CUSTOM_STACK
       pid = task_create("usbhost", CONFIG_USBHOST_DEFPRIO,
                         CONFIG_USBHOST_STACKSIZE,
                         (main_t)nsh_waiter, (FAR char * const *)NULL);
-#else
-      pid = task_create("usbhost", CONFIG_USBHOST_DEFPRIO,
-                        (main_t)nsh_waiter, (FAR char * const *)NULL);
-#endif
       return pid < 0 ? -ENOEXEC : OK;
     }
   return -ENODEV;
diff --git a/nuttx/configs/pirelli_dpl10/nsh_highram/defconfig b/nuttx/configs/pirelli_dpl10/nsh_highram/defconfig
index 4c68e47..b4136ac 100644
--- a/nuttx/configs/pirelli_dpl10/nsh_highram/defconfig
+++ b/nuttx/configs/pirelli_dpl10/nsh_highram/defconfig
@@ -43,7 +43,6 @@ CONFIG_RAW_BINARY=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -131,7 +130,6 @@ CONFIG_SERIAL_IRDA_CONSOLE=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 CONFIG_ARCH_STACKDUMP=y
diff --git a/nuttx/configs/px4fmu-v2_upstream/nsh/defconfig b/nuttx/configs/px4fmu-v2_upstream/nsh/defconfig
index e1ab653..1ffdac0 100644
--- a/nuttx/configs/px4fmu-v2_upstream/nsh/defconfig
+++ b/nuttx/configs/px4fmu-v2_upstream/nsh/defconfig
@@ -51,7 +51,6 @@ CONFIG_DEBUG_NOOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -354,7 +353,6 @@ CONFIG_SDIO_PRI=128
 # CONFIG_ARCH_VECNOTIRQ is not set
 CONFIG_ARCH_DMA=y
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/qemu-i486/nsh/defconfig b/nuttx/configs/qemu-i486/nsh/defconfig
index df6a7f9..d75754c 100644
--- a/nuttx/configs/qemu-i486/nsh/defconfig
+++ b/nuttx/configs/qemu-i486/nsh/defconfig
@@ -50,7 +50,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -93,7 +92,6 @@ CONFIG_ARCH_X86_HAVE_32BIT=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 # CONFIG_ARCH_HAVE_VFORK is not set
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/qemu-i486/ostest/defconfig b/nuttx/configs/qemu-i486/ostest/defconfig
index df124fc..10aa819 100644
--- a/nuttx/configs/qemu-i486/ostest/defconfig
+++ b/nuttx/configs/qemu-i486/ostest/defconfig
@@ -50,7 +50,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -93,7 +92,6 @@ CONFIG_ARCH_X86_HAVE_32BIT=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 # CONFIG_ARCH_HAVE_VFORK is not set
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/rgmp/arm/default/defconfig b/nuttx/configs/rgmp/arm/default/defconfig
index 4c89d04..ef96151 100644
--- a/nuttx/configs/rgmp/arm/default/defconfig
+++ b/nuttx/configs/rgmp/arm/default/defconfig
@@ -50,7 +50,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -78,7 +77,6 @@ CONFIG_RGMP_SUBARCH="arm"
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 # CONFIG_ARCH_HAVE_VFORK is not set
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/rgmp/arm/nsh/defconfig b/nuttx/configs/rgmp/arm/nsh/defconfig
index f80eadd..7324215 100644
--- a/nuttx/configs/rgmp/arm/nsh/defconfig
+++ b/nuttx/configs/rgmp/arm/nsh/defconfig
@@ -70,7 +70,6 @@ CONFIG_DEBUG_NOOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -98,7 +97,6 @@ CONFIG_RGMP_SUBARCH="arm"
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 # CONFIG_ARCH_HAVE_VFORK is not set
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/rgmp/x86/cxxtest/defconfig b/nuttx/configs/rgmp/x86/cxxtest/defconfig
index a19ac1c..dfa7b42 100644
--- a/nuttx/configs/rgmp/x86/cxxtest/defconfig
+++ b/nuttx/configs/rgmp/x86/cxxtest/defconfig
@@ -70,7 +70,6 @@ CONFIG_DEBUG_NOOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -106,7 +105,6 @@ CONFIG_COM2=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 # CONFIG_ARCH_HAVE_VFORK is not set
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/rgmp/x86/default/defconfig b/nuttx/configs/rgmp/x86/default/defconfig
index a415e2e..85eb007 100644
--- a/nuttx/configs/rgmp/x86/default/defconfig
+++ b/nuttx/configs/rgmp/x86/default/defconfig
@@ -50,7 +50,6 @@ CONFIG_DEBUG_NOOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -86,7 +85,6 @@ CONFIG_COM2=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 # CONFIG_ARCH_HAVE_VFORK is not set
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/rgmp/x86/helloxx/defconfig b/nuttx/configs/rgmp/x86/helloxx/defconfig
index 9fea420..ed20768 100644
--- a/nuttx/configs/rgmp/x86/helloxx/defconfig
+++ b/nuttx/configs/rgmp/x86/helloxx/defconfig
@@ -70,7 +70,6 @@ CONFIG_DEBUG_NOOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -106,7 +105,6 @@ CONFIG_COM2=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 # CONFIG_ARCH_HAVE_VFORK is not set
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/rgmp/x86/nsh/defconfig b/nuttx/configs/rgmp/x86/nsh/defconfig
index f0957ae..48ad804 100644
--- a/nuttx/configs/rgmp/x86/nsh/defconfig
+++ b/nuttx/configs/rgmp/x86/nsh/defconfig
@@ -70,7 +70,6 @@ CONFIG_DEBUG_NOOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -106,7 +105,6 @@ CONFIG_COM2=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 # CONFIG_ARCH_HAVE_VFORK is not set
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/sam3u-ek/knsh/defconfig b/nuttx/configs/sam3u-ek/knsh/defconfig
index f4886d0..f5866de 100644
--- a/nuttx/configs/sam3u-ek/knsh/defconfig
+++ b/nuttx/configs/sam3u-ek/knsh/defconfig
@@ -58,7 +58,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -225,7 +224,6 @@ CONFIG_SAM34_UART0=y
 CONFIG_ARCH_HAVE_IRQPRIO=y
 # CONFIG_ARCH_L2CACHE is not set
 # CONFIG_ARCH_HAVE_COHERENT_DCACHE is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_HAVE_ADDRENV is not set
 # CONFIG_ARCH_NEED_ADDRENV_MAPPING is not set
 CONFIG_ARCH_HAVE_VFORK=y
diff --git a/nuttx/configs/sam3u-ek/nsh/defconfig b/nuttx/configs/sam3u-ek/nsh/defconfig
index 15aa77b..5eebe1d 100644
--- a/nuttx/configs/sam3u-ek/nsh/defconfig
+++ b/nuttx/configs/sam3u-ek/nsh/defconfig
@@ -51,7 +51,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -212,7 +211,6 @@ CONFIG_SAM34_UART0=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/sam3u-ek/nx/defconfig b/nuttx/configs/sam3u-ek/nx/defconfig
index 0fd791b..c39c6da 100644
--- a/nuttx/configs/sam3u-ek/nx/defconfig
+++ b/nuttx/configs/sam3u-ek/nx/defconfig
@@ -51,7 +51,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -212,7 +211,6 @@ CONFIG_SAM34_UART0=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/sam3u-ek/nxwm/defconfig b/nuttx/configs/sam3u-ek/nxwm/defconfig
index 6f25a8a..d3ddaf7 100644
--- a/nuttx/configs/sam3u-ek/nxwm/defconfig
+++ b/nuttx/configs/sam3u-ek/nxwm/defconfig
@@ -51,7 +51,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -215,7 +214,6 @@ CONFIG_SAM34_GPIOA_IRQ=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/sam4e-ek/nsh/defconfig b/nuttx/configs/sam4e-ek/nsh/defconfig
index c81ef97..608bfb5 100644
--- a/nuttx/configs/sam4e-ek/nsh/defconfig
+++ b/nuttx/configs/sam4e-ek/nsh/defconfig
@@ -52,7 +52,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -259,7 +258,6 @@ CONFIG_SAM34_EMAC_ISETH0=y
 CONFIG_ARCH_DMA=y
 CONFIG_ARCH_HAVE_IRQPRIO=y
 # CONFIG_ARCH_L2CACHE is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/sam4e-ek/nxwm/defconfig b/nuttx/configs/sam4e-ek/nxwm/defconfig
index d9c00b3..2cefc71 100644
--- a/nuttx/configs/sam4e-ek/nxwm/defconfig
+++ b/nuttx/configs/sam4e-ek/nxwm/defconfig
@@ -52,7 +52,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -262,7 +261,6 @@ CONFIG_SAM34_EMAC_ISETH0=y
 CONFIG_ARCH_DMA=y
 CONFIG_ARCH_HAVE_IRQPRIO=y
 # CONFIG_ARCH_L2CACHE is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/sam4e-ek/usbnsh/defconfig b/nuttx/configs/sam4e-ek/usbnsh/defconfig
index 69ce638..e4c172a 100644
--- a/nuttx/configs/sam4e-ek/usbnsh/defconfig
+++ b/nuttx/configs/sam4e-ek/usbnsh/defconfig
@@ -52,7 +52,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -264,7 +263,6 @@ CONFIG_SAM34_EMAC_ISETH0=y
 CONFIG_ARCH_DMA=y
 CONFIG_ARCH_HAVE_IRQPRIO=y
 # CONFIG_ARCH_L2CACHE is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/sam4l-xplained/nsh/defconfig b/nuttx/configs/sam4l-xplained/nsh/defconfig
index 0c7492f..1c1df8b 100644
--- a/nuttx/configs/sam4l-xplained/nsh/defconfig
+++ b/nuttx/configs/sam4l-xplained/nsh/defconfig
@@ -51,7 +51,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -228,7 +227,6 @@ CONFIG_SAM34_USART0=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/sam4s-xplained-pro/nsh/defconfig b/nuttx/configs/sam4s-xplained-pro/nsh/defconfig
index e886761..0b393c6 100644
--- a/nuttx/configs/sam4s-xplained-pro/nsh/defconfig
+++ b/nuttx/configs/sam4s-xplained-pro/nsh/defconfig
@@ -54,7 +54,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -257,7 +256,6 @@ CONFIG_ARCH_DMA=y
 CONFIG_ARCH_HAVE_IRQPRIO=y
 # CONFIG_ARCH_L2CACHE is not set
 # CONFIG_ARCH_HAVE_COHERENT_DCACHE is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_HAVE_ADDRENV is not set
 # CONFIG_ARCH_NEED_ADDRENV_MAPPING is not set
 CONFIG_ARCH_HAVE_VFORK=y
diff --git a/nuttx/configs/sam4s-xplained-pro/src/sam_wdt.c b/nuttx/configs/sam4s-xplained-pro/src/sam_wdt.c
index d2b6257..4df566c 100644
--- a/nuttx/configs/sam4s-xplained-pro/src/sam_wdt.c
+++ b/nuttx/configs/sam4s-xplained-pro/src/sam_wdt.c
@@ -219,7 +219,7 @@ int up_wdginitialize(void)
 #if defined(CONFIG_WDT_THREAD)
   sched_lock();
 
-  int taskid = KERNEL_THREAD(CONFIG_WDT_THREAD_NAME,
+  int taskid = kernel_thread(CONFIG_WDT_THREAD_NAME,
                              CONFIG_WDT_THREAD_PRIORITY,
                              CONFIG_WDT_THREAD_STACKSIZE,
                              (main_t)wdog_daemon, (FAR char * const *)NULL);
diff --git a/nuttx/configs/sam4s-xplained/nsh/defconfig b/nuttx/configs/sam4s-xplained/nsh/defconfig
index 0b2af45..4a65baa 100644
--- a/nuttx/configs/sam4s-xplained/nsh/defconfig
+++ b/nuttx/configs/sam4s-xplained/nsh/defconfig
@@ -51,7 +51,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -214,7 +213,6 @@ CONFIG_SAM34_UART1=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/sama5d3-xplained/nsh/defconfig b/nuttx/configs/sama5d3-xplained/nsh/defconfig
index f4d19e4..f3e624c 100644
--- a/nuttx/configs/sama5d3-xplained/nsh/defconfig
+++ b/nuttx/configs/sama5d3-xplained/nsh/defconfig
@@ -57,7 +57,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -245,7 +244,6 @@ CONFIG_SAMA5_ISRAM_HEAP=y
 CONFIG_ARCH_HAVE_IRQPRIO=y
 # CONFIG_ARCH_L2CACHE is not set
 # CONFIG_ARCH_HAVE_COHERENT_DCACHE is not set
-# CONFIG_CUSTOM_STACK is not set
 CONFIG_ARCH_HAVE_ADDRENV=y
 CONFIG_ARCH_NEED_ADDRENV_MAPPING=y
 CONFIG_ARCH_HAVE_VFORK=y
diff --git a/nuttx/configs/sama5d3-xplained/src/sam_usb.c b/nuttx/configs/sama5d3-xplained/src/sam_usb.c
index 13deaea..1105d88 100644
--- a/nuttx/configs/sama5d3-xplained/src/sam_usb.c
+++ b/nuttx/configs/sama5d3-xplained/src/sam_usb.c
@@ -342,7 +342,7 @@ int sam_usbhost_initialize(void)
 
   /* Start a thread to handle device connection. */
 
-  pid = TASK_CREATE("OHCI Monitor", CONFIG_USBHOST_DEFPRIO,  CONFIG_USBHOST_STACKSIZE,
+  pid = task_create("OHCI Monitor", CONFIG_USBHOST_DEFPRIO,  CONFIG_USBHOST_STACKSIZE,
                     (main_t)ohci_waiter, (FAR char * const *)NULL);
   if (pid < 0)
     {
@@ -363,7 +363,7 @@ int sam_usbhost_initialize(void)
 
   /* Start a thread to handle device connection. */
 
-  pid = TASK_CREATE("EHCI Monitor", CONFIG_USBHOST_DEFPRIO,  CONFIG_USBHOST_STACKSIZE,
+  pid = task_create("EHCI Monitor", CONFIG_USBHOST_DEFPRIO,  CONFIG_USBHOST_STACKSIZE,
                     (main_t)ehci_waiter, (FAR char * const *)NULL);
   if (pid < 0)
     {
diff --git a/nuttx/configs/sama5d3x-ek/demo/defconfig b/nuttx/configs/sama5d3x-ek/demo/defconfig
index 9cd853e..3bbf76b 100644
--- a/nuttx/configs/sama5d3x-ek/demo/defconfig
+++ b/nuttx/configs/sama5d3x-ek/demo/defconfig
@@ -57,7 +57,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -290,7 +289,6 @@ CONFIG_ARCH_DMA=y
 CONFIG_ARCH_HAVE_IRQPRIO=y
 # CONFIG_ARCH_L2CACHE is not set
 # CONFIG_ARCH_HAVE_COHERENT_DCACHE is not set
-# CONFIG_CUSTOM_STACK is not set
 CONFIG_ARCH_HAVE_ADDRENV=y
 CONFIG_ARCH_NEED_ADDRENV_MAPPING=y
 CONFIG_ARCH_HAVE_VFORK=y
diff --git a/nuttx/configs/sama5d3x-ek/hello/defconfig b/nuttx/configs/sama5d3x-ek/hello/defconfig
index b125475..e7fb4eb 100644
--- a/nuttx/configs/sama5d3x-ek/hello/defconfig
+++ b/nuttx/configs/sama5d3x-ek/hello/defconfig
@@ -57,7 +57,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -224,7 +223,6 @@ CONFIG_SAMA5_BOOT_ISRAM=y
 CONFIG_ARCH_HAVE_IRQPRIO=y
 # CONFIG_ARCH_L2CACHE is not set
 # CONFIG_ARCH_HAVE_COHERENT_DCACHE is not set
-# CONFIG_CUSTOM_STACK is not set
 CONFIG_ARCH_HAVE_ADDRENV=y
 CONFIG_ARCH_NEED_ADDRENV_MAPPING=y
 CONFIG_ARCH_HAVE_VFORK=y
diff --git a/nuttx/configs/sama5d3x-ek/norboot/defconfig b/nuttx/configs/sama5d3x-ek/norboot/defconfig
index 626c338..716e2c4 100644
--- a/nuttx/configs/sama5d3x-ek/norboot/defconfig
+++ b/nuttx/configs/sama5d3x-ek/norboot/defconfig
@@ -57,7 +57,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -237,7 +236,6 @@ CONFIG_SAMA5_BOOT_ISRAM=y
 CONFIG_ARCH_HAVE_IRQPRIO=y
 # CONFIG_ARCH_L2CACHE is not set
 # CONFIG_ARCH_HAVE_COHERENT_DCACHE is not set
-# CONFIG_CUSTOM_STACK is not set
 CONFIG_ARCH_HAVE_ADDRENV=y
 CONFIG_ARCH_NEED_ADDRENV_MAPPING=y
 CONFIG_ARCH_HAVE_VFORK=y
diff --git a/nuttx/configs/sama5d3x-ek/nsh/defconfig b/nuttx/configs/sama5d3x-ek/nsh/defconfig
index 2f5241b..8b1a90c 100644
--- a/nuttx/configs/sama5d3x-ek/nsh/defconfig
+++ b/nuttx/configs/sama5d3x-ek/nsh/defconfig
@@ -57,7 +57,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -238,7 +237,6 @@ CONFIG_SAMA5_ISRAM_HEAP=y
 CONFIG_ARCH_HAVE_IRQPRIO=y
 # CONFIG_ARCH_L2CACHE is not set
 # CONFIG_ARCH_HAVE_COHERENT_DCACHE is not set
-# CONFIG_CUSTOM_STACK is not set
 CONFIG_ARCH_HAVE_ADDRENV=y
 CONFIG_ARCH_NEED_ADDRENV_MAPPING=y
 CONFIG_ARCH_HAVE_VFORK=y
diff --git a/nuttx/configs/sama5d3x-ek/nx/defconfig b/nuttx/configs/sama5d3x-ek/nx/defconfig
index 628cb5a..9e30c59 100644
--- a/nuttx/configs/sama5d3x-ek/nx/defconfig
+++ b/nuttx/configs/sama5d3x-ek/nx/defconfig
@@ -57,7 +57,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -277,7 +276,6 @@ CONFIG_SAMA5_DDRCS_HEAP_SIZE=262668288
 CONFIG_ARCH_HAVE_IRQPRIO=y
 # CONFIG_ARCH_L2CACHE is not set
 # CONFIG_ARCH_HAVE_COHERENT_DCACHE is not set
-# CONFIG_CUSTOM_STACK is not set
 CONFIG_ARCH_HAVE_ADDRENV=y
 CONFIG_ARCH_NEED_ADDRENV_MAPPING=y
 CONFIG_ARCH_HAVE_VFORK=y
diff --git a/nuttx/configs/sama5d3x-ek/nxplayer/defconfig b/nuttx/configs/sama5d3x-ek/nxplayer/defconfig
index b73d18a..8cf20fc 100644
--- a/nuttx/configs/sama5d3x-ek/nxplayer/defconfig
+++ b/nuttx/configs/sama5d3x-ek/nxplayer/defconfig
@@ -57,7 +57,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -290,7 +289,6 @@ CONFIG_ARCH_DMA=y
 CONFIG_ARCH_HAVE_IRQPRIO=y
 # CONFIG_ARCH_L2CACHE is not set
 # CONFIG_ARCH_HAVE_COHERENT_DCACHE is not set
-# CONFIG_CUSTOM_STACK is not set
 CONFIG_ARCH_HAVE_ADDRENV=y
 CONFIG_ARCH_NEED_ADDRENV_MAPPING=y
 CONFIG_ARCH_HAVE_VFORK=y
diff --git a/nuttx/configs/sama5d3x-ek/nxwm/defconfig b/nuttx/configs/sama5d3x-ek/nxwm/defconfig
index c55d0fa..817bea7 100644
--- a/nuttx/configs/sama5d3x-ek/nxwm/defconfig
+++ b/nuttx/configs/sama5d3x-ek/nxwm/defconfig
@@ -57,7 +57,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -306,7 +305,6 @@ CONFIG_SAMA5_DDRCS_HEAP_SIZE=262668288
 CONFIG_ARCH_HAVE_IRQPRIO=y
 # CONFIG_ARCH_L2CACHE is not set
 # CONFIG_ARCH_HAVE_COHERENT_DCACHE is not set
-# CONFIG_CUSTOM_STACK is not set
 CONFIG_ARCH_HAVE_ADDRENV=y
 CONFIG_ARCH_NEED_ADDRENV_MAPPING=y
 CONFIG_ARCH_HAVE_VFORK=y
diff --git a/nuttx/configs/sama5d3x-ek/ov2640/defconfig b/nuttx/configs/sama5d3x-ek/ov2640/defconfig
index d2f8f66..7c8c827 100644
--- a/nuttx/configs/sama5d3x-ek/ov2640/defconfig
+++ b/nuttx/configs/sama5d3x-ek/ov2640/defconfig
@@ -57,7 +57,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -282,7 +281,6 @@ CONFIG_SAMA5_DDRCS_HEAP_SIZE=268435456
 CONFIG_ARCH_HAVE_IRQPRIO=y
 # CONFIG_ARCH_L2CACHE is not set
 # CONFIG_ARCH_HAVE_COHERENT_DCACHE is not set
-# CONFIG_CUSTOM_STACK is not set
 CONFIG_ARCH_HAVE_ADDRENV=y
 CONFIG_ARCH_NEED_ADDRENV_MAPPING=y
 CONFIG_ARCH_HAVE_VFORK=y
diff --git a/nuttx/configs/sama5d3x-ek/src/sam_usb.c b/nuttx/configs/sama5d3x-ek/src/sam_usb.c
index 1c7a86e..7104253 100644
--- a/nuttx/configs/sama5d3x-ek/src/sam_usb.c
+++ b/nuttx/configs/sama5d3x-ek/src/sam_usb.c
@@ -342,7 +342,7 @@ int sam_usbhost_initialize(void)
 
   /* Start a thread to handle device connection. */
 
-  pid = TASK_CREATE("OHCI Monitor", CONFIG_USBHOST_DEFPRIO,  CONFIG_USBHOST_STACKSIZE,
+  pid = task_create("OHCI Monitor", CONFIG_USBHOST_DEFPRIO,  CONFIG_USBHOST_STACKSIZE,
                     (main_t)ohci_waiter, (FAR char * const *)NULL);
   if (pid < 0)
     {
@@ -363,7 +363,7 @@ int sam_usbhost_initialize(void)
 
   /* Start a thread to handle device connection. */
 
-  pid = TASK_CREATE("EHCI Monitor", CONFIG_USBHOST_DEFPRIO,  CONFIG_USBHOST_STACKSIZE,
+  pid = task_create("EHCI Monitor", CONFIG_USBHOST_DEFPRIO,  CONFIG_USBHOST_STACKSIZE,
                     (main_t)ehci_waiter, (FAR char * const *)NULL);
   if (pid < 0)
     {
diff --git a/nuttx/configs/sama5d4-ek/at25boot/defconfig b/nuttx/configs/sama5d4-ek/at25boot/defconfig
index 6ca7dc8..a83e3f9 100644
--- a/nuttx/configs/sama5d4-ek/at25boot/defconfig
+++ b/nuttx/configs/sama5d4-ek/at25boot/defconfig
@@ -57,7 +57,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -257,7 +256,6 @@ CONFIG_SAMA5_DDRCS_HEAP_SIZE=0
 CONFIG_ARCH_HAVE_IRQPRIO=y
 # CONFIG_ARCH_L2CACHE is not set
 # CONFIG_ARCH_HAVE_COHERENT_DCACHE is not set
-# CONFIG_CUSTOM_STACK is not set
 CONFIG_ARCH_HAVE_ADDRENV=y
 CONFIG_ARCH_NEED_ADDRENV_MAPPING=y
 CONFIG_ARCH_HAVE_VFORK=y
diff --git a/nuttx/configs/sama5d4-ek/dramboot/defconfig b/nuttx/configs/sama5d4-ek/dramboot/defconfig
index 9e453e9..afc2f88 100644
--- a/nuttx/configs/sama5d4-ek/dramboot/defconfig
+++ b/nuttx/configs/sama5d4-ek/dramboot/defconfig
@@ -57,7 +57,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -253,7 +252,6 @@ CONFIG_SAMA5_DDRCS_HEAP_SIZE=0
 CONFIG_ARCH_HAVE_IRQPRIO=y
 # CONFIG_ARCH_L2CACHE is not set
 # CONFIG_ARCH_HAVE_COHERENT_DCACHE is not set
-# CONFIG_CUSTOM_STACK is not set
 CONFIG_ARCH_HAVE_ADDRENV=y
 CONFIG_ARCH_NEED_ADDRENV_MAPPING=y
 CONFIG_ARCH_HAVE_VFORK=y
diff --git a/nuttx/configs/sama5d4-ek/elf/defconfig b/nuttx/configs/sama5d4-ek/elf/defconfig
index 7c454c7..d9aee6f 100644
--- a/nuttx/configs/sama5d4-ek/elf/defconfig
+++ b/nuttx/configs/sama5d4-ek/elf/defconfig
@@ -58,7 +58,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -255,7 +254,6 @@ CONFIG_SAMA5_DDRCS_PGHEAP_SIZE=134217728
 CONFIG_ARCH_HAVE_IRQPRIO=y
 # CONFIG_ARCH_L2CACHE is not set
 CONFIG_ARCH_HAVE_COHERENT_DCACHE=y
-# CONFIG_CUSTOM_STACK is not set
 CONFIG_ARCH_HAVE_ADDRENV=y
 CONFIG_ARCH_NEED_ADDRENV_MAPPING=y
 CONFIG_ARCH_HAVE_VFORK=y
diff --git a/nuttx/configs/sama5d4-ek/kernel/defconfig b/nuttx/configs/sama5d4-ek/kernel/defconfig
index cc569c5..c9a209a 100644
--- a/nuttx/configs/sama5d4-ek/kernel/defconfig
+++ b/nuttx/configs/sama5d4-ek/kernel/defconfig
@@ -57,7 +57,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -254,7 +253,6 @@ CONFIG_SAMA5_DDRCS_PGHEAP_SIZE=134217728
 CONFIG_ARCH_HAVE_IRQPRIO=y
 # CONFIG_ARCH_L2CACHE is not set
 CONFIG_ARCH_HAVE_COHERENT_DCACHE=y
-# CONFIG_CUSTOM_STACK is not set
 CONFIG_ARCH_HAVE_ADDRENV=y
 CONFIG_ARCH_NEED_ADDRENV_MAPPING=y
 CONFIG_ARCH_HAVE_VFORK=y
diff --git a/nuttx/configs/sama5d4-ek/nsh/defconfig b/nuttx/configs/sama5d4-ek/nsh/defconfig
index c10957f..407fe6f 100644
--- a/nuttx/configs/sama5d4-ek/nsh/defconfig
+++ b/nuttx/configs/sama5d4-ek/nsh/defconfig
@@ -57,7 +57,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -348,7 +347,6 @@ CONFIG_ARCH_DMA=y
 CONFIG_ARCH_HAVE_IRQPRIO=y
 # CONFIG_ARCH_L2CACHE is not set
 # CONFIG_ARCH_HAVE_COHERENT_DCACHE is not set
-# CONFIG_CUSTOM_STACK is not set
 CONFIG_ARCH_HAVE_ADDRENV=y
 CONFIG_ARCH_NEED_ADDRENV_MAPPING=y
 CONFIG_ARCH_HAVE_VFORK=y
diff --git a/nuttx/configs/sama5d4-ek/nxwm/defconfig b/nuttx/configs/sama5d4-ek/nxwm/defconfig
index ee3bd00..5ba9600 100644
--- a/nuttx/configs/sama5d4-ek/nxwm/defconfig
+++ b/nuttx/configs/sama5d4-ek/nxwm/defconfig
@@ -57,7 +57,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -348,7 +347,6 @@ CONFIG_ARCH_DMA=y
 CONFIG_ARCH_HAVE_IRQPRIO=y
 # CONFIG_ARCH_L2CACHE is not set
 # CONFIG_ARCH_HAVE_COHERENT_DCACHE is not set
-# CONFIG_CUSTOM_STACK is not set
 CONFIG_ARCH_HAVE_ADDRENV=y
 CONFIG_ARCH_NEED_ADDRENV_MAPPING=y
 CONFIG_ARCH_HAVE_VFORK=y
diff --git a/nuttx/configs/sama5d4-ek/ramtest/defconfig b/nuttx/configs/sama5d4-ek/ramtest/defconfig
index 037ddf9..03e0800 100644
--- a/nuttx/configs/sama5d4-ek/ramtest/defconfig
+++ b/nuttx/configs/sama5d4-ek/ramtest/defconfig
@@ -57,7 +57,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -253,7 +252,6 @@ CONFIG_SAMA5_DDRCS_HEAP_SIZE=0
 CONFIG_ARCH_HAVE_IRQPRIO=y
 # CONFIG_ARCH_L2CACHE is not set
 # CONFIG_ARCH_HAVE_COHERENT_DCACHE is not set
-# CONFIG_CUSTOM_STACK is not set
 CONFIG_ARCH_HAVE_ADDRENV=y
 CONFIG_ARCH_NEED_ADDRENV_MAPPING=y
 CONFIG_ARCH_HAVE_VFORK=y
diff --git a/nuttx/configs/sama5d4-ek/src/sam_usb.c b/nuttx/configs/sama5d4-ek/src/sam_usb.c
index eeb0908..f8d2da7 100644
--- a/nuttx/configs/sama5d4-ek/src/sam_usb.c
+++ b/nuttx/configs/sama5d4-ek/src/sam_usb.c
@@ -343,7 +343,7 @@ int sam_usbhost_initialize(void)
 
   /* Start a thread to handle device connection. */
 
-  pid = TASK_CREATE("OHCI Monitor", CONFIG_USBHOST_DEFPRIO,  CONFIG_USBHOST_STACKSIZE,
+  pid = task_create("OHCI Monitor", CONFIG_USBHOST_DEFPRIO,  CONFIG_USBHOST_STACKSIZE,
                     (main_t)ohci_waiter, (FAR char * const *)NULL);
   if (pid < 0)
     {
@@ -364,7 +364,7 @@ int sam_usbhost_initialize(void)
 
   /* Start a thread to handle device connection. */
 
-  pid = TASK_CREATE("EHCI Monitor", CONFIG_USBHOST_DEFPRIO,  CONFIG_USBHOST_STACKSIZE,
+  pid = task_create("EHCI Monitor", CONFIG_USBHOST_DEFPRIO,  CONFIG_USBHOST_STACKSIZE,
                     (main_t)ehci_waiter, (FAR char * const *)NULL);
   if (pid < 0)
     {
diff --git a/nuttx/configs/samd20-xplained/nsh/defconfig b/nuttx/configs/samd20-xplained/nsh/defconfig
index 3edc90f..1c2e985 100644
--- a/nuttx/configs/samd20-xplained/nsh/defconfig
+++ b/nuttx/configs/samd20-xplained/nsh/defconfig
@@ -55,7 +55,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -182,7 +181,6 @@ CONFIG_SAMD_SERCOM4_ISUSART=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/shenzhou/nsh/defconfig b/nuttx/configs/shenzhou/nsh/defconfig
index 759b02a..c0e30c2 100644
--- a/nuttx/configs/shenzhou/nsh/defconfig
+++ b/nuttx/configs/shenzhou/nsh/defconfig
@@ -39,7 +39,6 @@ CONFIG_INTELHEX_BINARY=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -304,7 +303,6 @@ CONFIG_PREALLOC_TIMERS=4
 #
 # Stack and heap information
 #
-# CONFIG_CUSTOM_STACK is not set
 CONFIG_IDLETHREAD_STACKSIZE=1024
 CONFIG_USERMAIN_STACKSIZE=2048
 CONFIG_PTHREAD_STACK_MIN=256
diff --git a/nuttx/configs/shenzhou/nxwm/defconfig b/nuttx/configs/shenzhou/nxwm/defconfig
index c310fa2..71d40ff 100644
--- a/nuttx/configs/shenzhou/nxwm/defconfig
+++ b/nuttx/configs/shenzhou/nxwm/defconfig
@@ -50,7 +50,6 @@ CONFIG_ARCH_HAVE_HEAPCHECK=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -310,7 +309,6 @@ CONFIG_STM32_RMII_MCO=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_IRQPRIO is not set
diff --git a/nuttx/configs/shenzhou/src/up_usb.c b/nuttx/configs/shenzhou/src/up_usb.c
index 948974c..c9ae8e4 100644
--- a/nuttx/configs/shenzhou/src/up_usb.c
+++ b/nuttx/configs/shenzhou/src/up_usb.c
@@ -193,7 +193,7 @@ int stm32_usbhost_initialize(void)
 
       uvdbg("Start usbhost_waiter\n");
 
-      pid = TASK_CREATE("usbhost", CONFIG_USBHOST_DEFPRIO,
+      pid = task_create("usbhost", CONFIG_USBHOST_DEFPRIO,
                         CONFIG_USBHOST_STACKSIZE,
                         (main_t)usbhost_waiter, (FAR char * const *)NULL);
       return pid < 0 ? -ENOEXEC : OK;
diff --git a/nuttx/configs/shenzhou/thttpd/defconfig b/nuttx/configs/shenzhou/thttpd/defconfig
index 9a0067d..1058ec0 100644
--- a/nuttx/configs/shenzhou/thttpd/defconfig
+++ b/nuttx/configs/shenzhou/thttpd/defconfig
@@ -38,7 +38,6 @@ CONFIG_INTELHEX_BINARY=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -291,7 +290,6 @@ CONFIG_PREALLOC_TIMERS=4
 #
 # Stack and heap information
 #
-# CONFIG_CUSTOM_STACK is not set
 CONFIG_IDLETHREAD_STACKSIZE=1024
 CONFIG_USERMAIN_STACKSIZE=2048
 CONFIG_PTHREAD_STACK_MIN=256
diff --git a/nuttx/configs/sim/configdata/defconfig b/nuttx/configs/sim/configdata/defconfig
index 30b0aec..7975a42 100644
--- a/nuttx/configs/sim/configdata/defconfig
+++ b/nuttx/configs/sim/configdata/defconfig
@@ -69,7 +69,6 @@ CONFIG_DEBUG_NOOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -95,7 +94,6 @@ CONFIG_ARCH="sim"
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 # CONFIG_ARCH_HAVE_VFORK is not set
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/sim/cxxtest/defconfig b/nuttx/configs/sim/cxxtest/defconfig
index 964ce53..8ae5c81 100644
--- a/nuttx/configs/sim/cxxtest/defconfig
+++ b/nuttx/configs/sim/cxxtest/defconfig
@@ -69,7 +69,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -95,7 +94,6 @@ CONFIG_ARCH="sim"
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 # CONFIG_ARCH_HAVE_VFORK is not set
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/sim/mount/defconfig b/nuttx/configs/sim/mount/defconfig
index 4a48a44..700e042 100644
--- a/nuttx/configs/sim/mount/defconfig
+++ b/nuttx/configs/sim/mount/defconfig
@@ -69,7 +69,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -95,7 +94,6 @@ CONFIG_ARCH="sim"
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 # CONFIG_ARCH_HAVE_VFORK is not set
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/sim/mtdpart/defconfig b/nuttx/configs/sim/mtdpart/defconfig
index 4aa7287..b3a49ed 100644
--- a/nuttx/configs/sim/mtdpart/defconfig
+++ b/nuttx/configs/sim/mtdpart/defconfig
@@ -69,7 +69,6 @@ CONFIG_DEBUG_NOOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -95,7 +94,6 @@ CONFIG_ARCH="sim"
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 # CONFIG_ARCH_HAVE_VFORK is not set
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/sim/nettest/defconfig b/nuttx/configs/sim/nettest/defconfig
index d3767b3..3a57786 100755
--- a/nuttx/configs/sim/nettest/defconfig
+++ b/nuttx/configs/sim/nettest/defconfig
@@ -51,7 +51,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -78,7 +77,6 @@ CONFIG_ARCH="sim"
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 # CONFIG_ARCH_HAVE_VFORK is not set
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/sim/nsh/defconfig b/nuttx/configs/sim/nsh/defconfig
index cfc677b..263a283 100644
--- a/nuttx/configs/sim/nsh/defconfig
+++ b/nuttx/configs/sim/nsh/defconfig
@@ -52,7 +52,6 @@ CONFIG_DEBUG_NOOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -82,7 +81,6 @@ CONFIG_HOST_X86_64=y
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
 # CONFIG_ARCH_L2CACHE is not set
 # CONFIG_ARCH_HAVE_COHERENT_DCACHE is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_HAVE_ADDRENV is not set
 # CONFIG_ARCH_NEED_ADDRENV_MAPPING is not set
 # CONFIG_ARCH_HAVE_VFORK is not set
diff --git a/nuttx/configs/sim/nsh2/defconfig b/nuttx/configs/sim/nsh2/defconfig
index 94748a9..cf1a0c8 100644
--- a/nuttx/configs/sim/nsh2/defconfig
+++ b/nuttx/configs/sim/nsh2/defconfig
@@ -49,7 +49,6 @@ CONFIG_DEBUG_NOOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -83,7 +82,6 @@ CONFIG_SIM_TOUCHSCREEN=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 # CONFIG_ARCH_HAVE_VFORK is not set
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/sim/nx/defconfig b/nuttx/configs/sim/nx/defconfig
index 201953d..ac13df5 100644
--- a/nuttx/configs/sim/nx/defconfig
+++ b/nuttx/configs/sim/nx/defconfig
@@ -69,7 +69,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -100,7 +99,6 @@ CONFIG_SIM_FBBPP=8
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 # CONFIG_ARCH_HAVE_VFORK is not set
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/sim/nx11/defconfig b/nuttx/configs/sim/nx11/defconfig
index b0b3616..13463a3 100644
--- a/nuttx/configs/sim/nx11/defconfig
+++ b/nuttx/configs/sim/nx11/defconfig
@@ -69,7 +69,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -101,7 +100,6 @@ CONFIG_SIM_FBBPP=32
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 # CONFIG_ARCH_HAVE_VFORK is not set
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/sim/nxffs/defconfig b/nuttx/configs/sim/nxffs/defconfig
index b0cfffc..e44fb97 100644
--- a/nuttx/configs/sim/nxffs/defconfig
+++ b/nuttx/configs/sim/nxffs/defconfig
@@ -50,7 +50,6 @@ CONFIG_DEBUG_NOOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -76,7 +75,6 @@ CONFIG_ARCH="sim"
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 # CONFIG_ARCH_HAVE_VFORK is not set
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/sim/nxlines/defconfig b/nuttx/configs/sim/nxlines/defconfig
index ab5b70c..46e09cd 100644
--- a/nuttx/configs/sim/nxlines/defconfig
+++ b/nuttx/configs/sim/nxlines/defconfig
@@ -54,7 +54,6 @@ CONFIG_DEBUG_NOOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -86,7 +85,6 @@ CONFIG_SIM_FBBPP=32
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 # CONFIG_ARCH_HAVE_VFORK is not set
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/sim/nxwm/defconfig b/nuttx/configs/sim/nxwm/defconfig
index 3f5ed03..02797c8 100644
--- a/nuttx/configs/sim/nxwm/defconfig
+++ b/nuttx/configs/sim/nxwm/defconfig
@@ -50,7 +50,6 @@ CONFIG_DEBUG_NOOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -82,7 +81,6 @@ CONFIG_SIM_FBBPP=32
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 # CONFIG_ARCH_HAVE_VFORK is not set
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/sim/ostest/defconfig b/nuttx/configs/sim/ostest/defconfig
index 02cfd19..836f0e1 100644
--- a/nuttx/configs/sim/ostest/defconfig
+++ b/nuttx/configs/sim/ostest/defconfig
@@ -74,7 +74,6 @@ CONFIG_DEBUG_NOOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -103,7 +102,6 @@ CONFIG_HOST_X86_64=y
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
 # CONFIG_ARCH_L2CACHE is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_HAVE_ADDRENV is not set
 # CONFIG_ARCH_NEED_ADDRENV_MAPPING is not set
 # CONFIG_ARCH_HAVE_VFORK is not set
diff --git a/nuttx/configs/sim/pashello/defconfig b/nuttx/configs/sim/pashello/defconfig
index 4892bd6..fa6ad60 100644
--- a/nuttx/configs/sim/pashello/defconfig
+++ b/nuttx/configs/sim/pashello/defconfig
@@ -51,7 +51,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -77,7 +76,6 @@ CONFIG_ARCH="sim"
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 # CONFIG_ARCH_HAVE_VFORK is not set
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/sim/touchscreen/defconfig b/nuttx/configs/sim/touchscreen/defconfig
index a2d0919..75d5b1a 100644
--- a/nuttx/configs/sim/touchscreen/defconfig
+++ b/nuttx/configs/sim/touchscreen/defconfig
@@ -70,7 +70,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -104,7 +103,6 @@ CONFIG_SIM_TOUCHSCREEN=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 # CONFIG_ARCH_HAVE_VFORK is not set
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/skp16c26/ostest/defconfig b/nuttx/configs/skp16c26/ostest/defconfig
index 2a707db..5ede073 100644
--- a/nuttx/configs/skp16c26/ostest/defconfig
+++ b/nuttx/configs/skp16c26/ostest/defconfig
@@ -49,7 +49,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -76,7 +75,6 @@ CONFIG_ARCH_NOINTC=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 # CONFIG_ARCH_HAVE_VFORK is not set
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/spark/composite/defconfig b/nuttx/configs/spark/composite/defconfig
index 67e8b00..047c953 100644
--- a/nuttx/configs/spark/composite/defconfig
+++ b/nuttx/configs/spark/composite/defconfig
@@ -51,7 +51,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -288,7 +287,6 @@ CONFIG_STM32_SPI_DMA=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 CONFIG_ARCH_DMA=y
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/spark/nsh/defconfig b/nuttx/configs/spark/nsh/defconfig
index 9f9843c..e7b2f85 100644
--- a/nuttx/configs/spark/nsh/defconfig
+++ b/nuttx/configs/spark/nsh/defconfig
@@ -51,7 +51,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -288,7 +287,6 @@ CONFIG_STM32_SPI_DMA=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 CONFIG_ARCH_DMA=y
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/spark/usbmsc/defconfig b/nuttx/configs/spark/usbmsc/defconfig
index 4ef7967..eba1160 100644
--- a/nuttx/configs/spark/usbmsc/defconfig
+++ b/nuttx/configs/spark/usbmsc/defconfig
@@ -51,7 +51,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -288,7 +287,6 @@ CONFIG_STM32_SPI_DMA=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 CONFIG_ARCH_DMA=y
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/spark/usbnsh/defconfig b/nuttx/configs/spark/usbnsh/defconfig
index 3d036cb..f9777f1 100644
--- a/nuttx/configs/spark/usbnsh/defconfig
+++ b/nuttx/configs/spark/usbnsh/defconfig
@@ -51,7 +51,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -288,7 +287,6 @@ CONFIG_STM32_USART=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 CONFIG_ARCH_DMA=y
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/spark/usbserial/defconfig b/nuttx/configs/spark/usbserial/defconfig
index 902e88f..3e2dac3 100644
--- a/nuttx/configs/spark/usbserial/defconfig
+++ b/nuttx/configs/spark/usbserial/defconfig
@@ -51,7 +51,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -288,7 +287,6 @@ CONFIG_STM32_SPI_DMA=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 CONFIG_ARCH_DMA=y
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/stm3210e-eval/buttons/defconfig b/nuttx/configs/stm3210e-eval/buttons/defconfig
index eada609..59b255d 100644
--- a/nuttx/configs/stm3210e-eval/buttons/defconfig
+++ b/nuttx/configs/stm3210e-eval/buttons/defconfig
@@ -55,7 +55,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -291,7 +290,6 @@ CONFIG_STM32_USART=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/stm3210e-eval/composite/defconfig b/nuttx/configs/stm3210e-eval/composite/defconfig
index 0204850..c8a4ce0 100644
--- a/nuttx/configs/stm3210e-eval/composite/defconfig
+++ b/nuttx/configs/stm3210e-eval/composite/defconfig
@@ -55,7 +55,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -300,7 +299,6 @@ CONFIG_SDIO_PRI=128
 # CONFIG_ARCH_VECNOTIRQ is not set
 CONFIG_ARCH_DMA=y
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/stm3210e-eval/nsh/defconfig b/nuttx/configs/stm3210e-eval/nsh/defconfig
index e0bbfc3..7adbb41 100644
--- a/nuttx/configs/stm3210e-eval/nsh/defconfig
+++ b/nuttx/configs/stm3210e-eval/nsh/defconfig
@@ -55,7 +55,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -301,7 +300,6 @@ CONFIG_SDIO_PRI=128
 # CONFIG_ARCH_VECNOTIRQ is not set
 CONFIG_ARCH_DMA=y
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/stm3210e-eval/nsh2/defconfig b/nuttx/configs/stm3210e-eval/nsh2/defconfig
index c26b50f..1bf9bbf 100644
--- a/nuttx/configs/stm3210e-eval/nsh2/defconfig
+++ b/nuttx/configs/stm3210e-eval/nsh2/defconfig
@@ -55,7 +55,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -311,7 +310,6 @@ CONFIG_SDIO_PRI=128
 # CONFIG_ARCH_VECNOTIRQ is not set
 CONFIG_ARCH_DMA=y
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/stm3210e-eval/nx/defconfig b/nuttx/configs/stm3210e-eval/nx/defconfig
index f4ba209..ebd4f29 100644
--- a/nuttx/configs/stm3210e-eval/nx/defconfig
+++ b/nuttx/configs/stm3210e-eval/nx/defconfig
@@ -55,7 +55,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -303,7 +302,6 @@ CONFIG_STM32_I2CTIMEOTICKS=500
 # CONFIG_ARCH_VECNOTIRQ is not set
 CONFIG_ARCH_DMA=y
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/stm3210e-eval/nxconsole/defconfig b/nuttx/configs/stm3210e-eval/nxconsole/defconfig
index 26005af..a932a2b 100644
--- a/nuttx/configs/stm3210e-eval/nxconsole/defconfig
+++ b/nuttx/configs/stm3210e-eval/nxconsole/defconfig
@@ -55,7 +55,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -292,7 +291,6 @@ CONFIG_STM32_USART=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 CONFIG_ARCH_DMA=y
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/stm3210e-eval/pm/defconfig b/nuttx/configs/stm3210e-eval/pm/defconfig
index 3057afc..c2765fa 100644
--- a/nuttx/configs/stm3210e-eval/pm/defconfig
+++ b/nuttx/configs/stm3210e-eval/pm/defconfig
@@ -55,7 +55,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -295,7 +294,6 @@ CONFIG_STM32_USART=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/stm3210e-eval/usbmsc/defconfig b/nuttx/configs/stm3210e-eval/usbmsc/defconfig
index de74faa..acaf1a4 100644
--- a/nuttx/configs/stm3210e-eval/usbmsc/defconfig
+++ b/nuttx/configs/stm3210e-eval/usbmsc/defconfig
@@ -51,7 +51,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -293,7 +292,6 @@ CONFIG_SDIO_PRI=128
 # CONFIG_ARCH_VECNOTIRQ is not set
 CONFIG_ARCH_DMA=y
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/stm3210e-eval/usbserial/defconfig b/nuttx/configs/stm3210e-eval/usbserial/defconfig
index 0ed98ed..add4d64 100644
--- a/nuttx/configs/stm3210e-eval/usbserial/defconfig
+++ b/nuttx/configs/stm3210e-eval/usbserial/defconfig
@@ -51,7 +51,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -284,7 +283,6 @@ CONFIG_STM32_USART=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/stm3220g-eval/dhcpd/defconfig b/nuttx/configs/stm3220g-eval/dhcpd/defconfig
index a1716d2..60ce450 100644
--- a/nuttx/configs/stm3220g-eval/dhcpd/defconfig
+++ b/nuttx/configs/stm3220g-eval/dhcpd/defconfig
@@ -55,7 +55,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -324,7 +323,6 @@ CONFIG_STM32_PHYSR_FULLDUPLEX=0x0004
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/stm3220g-eval/nettest/defconfig b/nuttx/configs/stm3220g-eval/nettest/defconfig
index cfd2455..276fba3 100644
--- a/nuttx/configs/stm3220g-eval/nettest/defconfig
+++ b/nuttx/configs/stm3220g-eval/nettest/defconfig
@@ -55,7 +55,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -324,7 +323,6 @@ CONFIG_STM32_PHYSR_FULLDUPLEX=0x0004
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/stm3220g-eval/nsh/defconfig b/nuttx/configs/stm3220g-eval/nsh/defconfig
index 477eb72..0ba9afa 100644
--- a/nuttx/configs/stm3220g-eval/nsh/defconfig
+++ b/nuttx/configs/stm3220g-eval/nsh/defconfig
@@ -51,7 +51,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -326,7 +325,6 @@ CONFIG_STM32_PHYSR_FULLDUPLEX=0x0004
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/stm3220g-eval/nsh2/defconfig b/nuttx/configs/stm3220g-eval/nsh2/defconfig
index f38b775..540fef7 100644
--- a/nuttx/configs/stm3220g-eval/nsh2/defconfig
+++ b/nuttx/configs/stm3220g-eval/nsh2/defconfig
@@ -55,7 +55,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -334,7 +333,6 @@ CONFIG_STM32_PHYSR_FULLDUPLEX=0x0004
 # CONFIG_ARCH_VECNOTIRQ is not set
 CONFIG_ARCH_DMA=y
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/stm3220g-eval/nxwm/defconfig b/nuttx/configs/stm3220g-eval/nxwm/defconfig
index c528eff..0e1c566 100644
--- a/nuttx/configs/stm3220g-eval/nxwm/defconfig
+++ b/nuttx/configs/stm3220g-eval/nxwm/defconfig
@@ -55,7 +55,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -335,7 +334,6 @@ CONFIG_STM32_PHYSR_FULLDUPLEX=0x0004
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/stm3220g-eval/src/up_usb.c b/nuttx/configs/stm3220g-eval/src/up_usb.c
index b83d8e5..a9c1688 100644
--- a/nuttx/configs/stm3220g-eval/src/up_usb.c
+++ b/nuttx/configs/stm3220g-eval/src/up_usb.c
@@ -193,7 +193,7 @@ int stm32_usbhost_initialize(void)
 
       uvdbg("Start usbhost_waiter\n");
 
-      pid = TASK_CREATE("usbhost", CONFIG_USBHOST_DEFPRIO,
+      pid = task_create("usbhost", CONFIG_USBHOST_DEFPRIO,
                         CONFIG_USBHOST_STACKSIZE,
                         (main_t)usbhost_waiter, (FAR char * const *)NULL);
       return pid < 0 ? -ENOEXEC : OK;
diff --git a/nuttx/configs/stm3220g-eval/telnetd/defconfig b/nuttx/configs/stm3220g-eval/telnetd/defconfig
index e724620..ebf7dc9 100644
--- a/nuttx/configs/stm3220g-eval/telnetd/defconfig
+++ b/nuttx/configs/stm3220g-eval/telnetd/defconfig
@@ -55,7 +55,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -324,7 +323,6 @@ CONFIG_STM32_PHYSR_FULLDUPLEX=0x0004
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/stm3240g-eval/dhcpd/defconfig b/nuttx/configs/stm3240g-eval/dhcpd/defconfig
index 53b1453..5c14b38 100644
--- a/nuttx/configs/stm3240g-eval/dhcpd/defconfig
+++ b/nuttx/configs/stm3240g-eval/dhcpd/defconfig
@@ -55,7 +55,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -326,7 +325,6 @@ CONFIG_STM32_PHYSR_FULLDUPLEX=0x0004
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/stm3240g-eval/discover/defconfig b/nuttx/configs/stm3240g-eval/discover/defconfig
index 7a45457..a6c0a03 100644
--- a/nuttx/configs/stm3240g-eval/discover/defconfig
+++ b/nuttx/configs/stm3240g-eval/discover/defconfig
@@ -75,7 +75,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -354,7 +353,6 @@ CONFIG_STM32_PHYSR_FULLDUPLEX=0x0004
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/stm3240g-eval/knxwm/defconfig b/nuttx/configs/stm3240g-eval/knxwm/defconfig
index c99267e..0ac4f2c 100644
--- a/nuttx/configs/stm3240g-eval/knxwm/defconfig
+++ b/nuttx/configs/stm3240g-eval/knxwm/defconfig
@@ -62,7 +62,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -369,7 +368,6 @@ CONFIG_STM32_I2CTIMEOTICKS=500
 CONFIG_ARCH_HAVE_IRQPRIO=y
 # CONFIG_ARCH_L2CACHE is not set
 # CONFIG_ARCH_HAVE_COHERENT_DCACHE is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_HAVE_ADDRENV is not set
 # CONFIG_ARCH_NEED_ADDRENV_MAPPING is not set
 CONFIG_ARCH_HAVE_VFORK=y
diff --git a/nuttx/configs/stm3240g-eval/nettest/defconfig b/nuttx/configs/stm3240g-eval/nettest/defconfig
index 8336385..ec6600c 100644
--- a/nuttx/configs/stm3240g-eval/nettest/defconfig
+++ b/nuttx/configs/stm3240g-eval/nettest/defconfig
@@ -55,7 +55,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -326,7 +325,6 @@ CONFIG_STM32_PHYSR_FULLDUPLEX=0x0004
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/stm3240g-eval/nsh/defconfig b/nuttx/configs/stm3240g-eval/nsh/defconfig
index cdfcf2c..3d1938e 100644
--- a/nuttx/configs/stm3240g-eval/nsh/defconfig
+++ b/nuttx/configs/stm3240g-eval/nsh/defconfig
@@ -55,7 +55,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -336,7 +335,6 @@ CONFIG_STM32_PHYSR_FULLDUPLEX=0x0004
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/stm3240g-eval/nsh2/defconfig b/nuttx/configs/stm3240g-eval/nsh2/defconfig
index 31747d9..8182544 100644
--- a/nuttx/configs/stm3240g-eval/nsh2/defconfig
+++ b/nuttx/configs/stm3240g-eval/nsh2/defconfig
@@ -55,7 +55,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -336,7 +335,6 @@ CONFIG_STM32_PHYSR_FULLDUPLEX=0x0004
 # CONFIG_ARCH_VECNOTIRQ is not set
 CONFIG_ARCH_DMA=y
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/stm3240g-eval/nxconsole/defconfig b/nuttx/configs/stm3240g-eval/nxconsole/defconfig
index f61de30..3947c68 100644
--- a/nuttx/configs/stm3240g-eval/nxconsole/defconfig
+++ b/nuttx/configs/stm3240g-eval/nxconsole/defconfig
@@ -55,7 +55,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -337,7 +336,6 @@ CONFIG_STM32_PHYSR_FULLDUPLEX=0x0004
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/stm3240g-eval/nxwm/defconfig b/nuttx/configs/stm3240g-eval/nxwm/defconfig
index a78e7d6..fc4c553 100644
--- a/nuttx/configs/stm3240g-eval/nxwm/defconfig
+++ b/nuttx/configs/stm3240g-eval/nxwm/defconfig
@@ -55,7 +55,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -337,7 +336,6 @@ CONFIG_STM32_PHYSR_FULLDUPLEX=0x0004
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/stm3240g-eval/src/up_boot.c b/nuttx/configs/stm3240g-eval/src/up_boot.c
index eff7a36..c1ebe3e 100644
--- a/nuttx/configs/stm3240g-eval/src/up_boot.c
+++ b/nuttx/configs/stm3240g-eval/src/up_boot.c
@@ -264,7 +264,7 @@ void board_initialize(void)
 
   /* Start the board initialization kernel thread */
 
-  server = KERNEL_THREAD("Board Init", CONFIG_STM3240G_BOARDINIT_PRIO,
+  server = kernel_thread("Board Init", CONFIG_STM3240G_BOARDINIT_PRIO,
                          CONFIG_STM3240G_BOARDINIT_STACK, board_initthread,
                          NULL);
   ASSERT(server > 0);
diff --git a/nuttx/configs/stm3240g-eval/src/up_usb.c b/nuttx/configs/stm3240g-eval/src/up_usb.c
index 102054d..b5e9883 100644
--- a/nuttx/configs/stm3240g-eval/src/up_usb.c
+++ b/nuttx/configs/stm3240g-eval/src/up_usb.c
@@ -193,7 +193,7 @@ int stm32_usbhost_initialize(void)
 
       uvdbg("Start usbhost_waiter\n");
 
-      pid = TASK_CREATE("usbhost", CONFIG_USBHOST_DEFPRIO,
+      pid = task_create("usbhost", CONFIG_USBHOST_DEFPRIO,
                         CONFIG_USBHOST_STACKSIZE,
                         (main_t)usbhost_waiter, (FAR char * const *)NULL);
       return pid < 0 ? -ENOEXEC : OK;
diff --git a/nuttx/configs/stm3240g-eval/telnetd/defconfig b/nuttx/configs/stm3240g-eval/telnetd/defconfig
index 2a7298e..f35ae87 100644
--- a/nuttx/configs/stm3240g-eval/telnetd/defconfig
+++ b/nuttx/configs/stm3240g-eval/telnetd/defconfig
@@ -55,7 +55,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -326,7 +325,6 @@ CONFIG_STM32_PHYSR_FULLDUPLEX=0x0004
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/stm3240g-eval/webserver/defconfig b/nuttx/configs/stm3240g-eval/webserver/defconfig
index e93f04e..13beb23 100644
--- a/nuttx/configs/stm3240g-eval/webserver/defconfig
+++ b/nuttx/configs/stm3240g-eval/webserver/defconfig
@@ -51,7 +51,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -328,7 +327,6 @@ CONFIG_STM32_PHYSR_FULLDUPLEX=0x0004
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/stm3240g-eval/xmlrpc/defconfig b/nuttx/configs/stm3240g-eval/xmlrpc/defconfig
index 65dcb25..0543772 100644
--- a/nuttx/configs/stm3240g-eval/xmlrpc/defconfig
+++ b/nuttx/configs/stm3240g-eval/xmlrpc/defconfig
@@ -75,7 +75,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -354,7 +353,6 @@ CONFIG_STM32_PHYSR_FULLDUPLEX=0x0004
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/stm32_tiny/nsh/defconfig b/nuttx/configs/stm32_tiny/nsh/defconfig
index f38b494..4337dbd 100644
--- a/nuttx/configs/stm32_tiny/nsh/defconfig
+++ b/nuttx/configs/stm32_tiny/nsh/defconfig
@@ -44,7 +44,6 @@ CONFIG_RAW_BINARY=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -256,7 +255,6 @@ CONFIG_STM32_USART=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 CONFIG_ARCH_STACKDUMP=y
diff --git a/nuttx/configs/stm32_tiny/usbnsh/defconfig b/nuttx/configs/stm32_tiny/usbnsh/defconfig
index a1e226e..bc3cff1 100644
--- a/nuttx/configs/stm32_tiny/usbnsh/defconfig
+++ b/nuttx/configs/stm32_tiny/usbnsh/defconfig
@@ -44,7 +44,6 @@ CONFIG_RAW_BINARY=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -220,7 +219,6 @@ CONFIG_STM32_USART=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 CONFIG_ARCH_STACKDUMP=y
diff --git a/nuttx/configs/stm32f100rc_generic/nsh/defconfig b/nuttx/configs/stm32f100rc_generic/nsh/defconfig
index ea16e41..d3319de 100644
--- a/nuttx/configs/stm32f100rc_generic/nsh/defconfig
+++ b/nuttx/configs/stm32f100rc_generic/nsh/defconfig
@@ -40,7 +40,6 @@ CONFIG_RAW_BINARY=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -281,7 +280,6 @@ CONFIG_PREALLOC_TIMERS=4
 #
 # Stack and heap information
 #
-# CONFIG_CUSTOM_STACK is not set
 CONFIG_IDLETHREAD_STACKSIZE=1024
 CONFIG_USERMAIN_STACKSIZE=2048
 CONFIG_PTHREAD_STACK_MIN=256
diff --git a/nuttx/configs/stm32f3discovery/nsh/defconfig b/nuttx/configs/stm32f3discovery/nsh/defconfig
index c9f2de4..20d9cad 100644
--- a/nuttx/configs/stm32f3discovery/nsh/defconfig
+++ b/nuttx/configs/stm32f3discovery/nsh/defconfig
@@ -48,7 +48,6 @@ CONFIG_ARCH_HAVE_STACKCHECK=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -266,7 +265,6 @@ CONFIG_STM32_USART=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 CONFIG_ARCH_STACKDUMP=y
diff --git a/nuttx/configs/stm32f3discovery/usbnsh/defconfig b/nuttx/configs/stm32f3discovery/usbnsh/defconfig
index 215b0dd..0a1c365 100644
--- a/nuttx/configs/stm32f3discovery/usbnsh/defconfig
+++ b/nuttx/configs/stm32f3discovery/usbnsh/defconfig
@@ -47,7 +47,6 @@ CONFIG_RAW_BINARY=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -262,7 +261,6 @@ CONFIG_STM32_USART=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 CONFIG_ARCH_STACKDUMP=y
diff --git a/nuttx/configs/stm32f429i-disco/extflash/defconfig b/nuttx/configs/stm32f429i-disco/extflash/defconfig
index 166fd46..2b86b20 100644
--- a/nuttx/configs/stm32f429i-disco/extflash/defconfig
+++ b/nuttx/configs/stm32f429i-disco/extflash/defconfig
@@ -74,7 +74,6 @@ CONFIG_DEBUG_NOOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -338,7 +337,6 @@ CONFIG_STM32_USART=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/stm32f429i-disco/nsh/defconfig b/nuttx/configs/stm32f429i-disco/nsh/defconfig
index 500460b..1b50caa 100644
--- a/nuttx/configs/stm32f429i-disco/nsh/defconfig
+++ b/nuttx/configs/stm32f429i-disco/nsh/defconfig
@@ -74,7 +74,6 @@ CONFIG_DEBUG_NOOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -331,7 +330,6 @@ CONFIG_STM32_USART=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/stm32f429i-disco/src/stm32_usb.c b/nuttx/configs/stm32f429i-disco/src/stm32_usb.c
index 433ceac..6740bd3 100644
--- a/nuttx/configs/stm32f429i-disco/src/stm32_usb.c
+++ b/nuttx/configs/stm32f429i-disco/src/stm32_usb.c
@@ -192,7 +192,7 @@ int stm32_usbhost_initialize(void)
 
       uvdbg("Start usbhost_waiter\n");
 
-      pid = TASK_CREATE("usbhost", CONFIG_USBHOST_DEFPRIO,
+      pid = task_create("usbhost", CONFIG_USBHOST_DEFPRIO,
                         CONFIG_USBHOST_STACKSIZE,
                         (main_t)usbhost_waiter, (FAR char * const *)NULL);
       return pid < 0 ? -ENOEXEC : OK;
diff --git a/nuttx/configs/stm32f429i-disco/usbmsc/defconfig b/nuttx/configs/stm32f429i-disco/usbmsc/defconfig
index 301c4bb..fe1220a 100644
--- a/nuttx/configs/stm32f429i-disco/usbmsc/defconfig
+++ b/nuttx/configs/stm32f429i-disco/usbmsc/defconfig
@@ -75,7 +75,6 @@ CONFIG_DEBUG_NOOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -344,7 +343,6 @@ CONFIG_STM32_USART=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/stm32f429i-disco/usbnsh/defconfig b/nuttx/configs/stm32f429i-disco/usbnsh/defconfig
index bce5df4..21b6ad7 100644
--- a/nuttx/configs/stm32f429i-disco/usbnsh/defconfig
+++ b/nuttx/configs/stm32f429i-disco/usbnsh/defconfig
@@ -75,7 +75,6 @@ CONFIG_DEBUG_NOOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -341,7 +340,6 @@ CONFIG_STM32_USART=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/stm32f4discovery/cxxtest/defconfig b/nuttx/configs/stm32f4discovery/cxxtest/defconfig
index 9154510..2aef3cd 100644
--- a/nuttx/configs/stm32f4discovery/cxxtest/defconfig
+++ b/nuttx/configs/stm32f4discovery/cxxtest/defconfig
@@ -55,7 +55,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -307,7 +306,6 @@ CONFIG_STM32_USART=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/stm32f4discovery/elf/defconfig b/nuttx/configs/stm32f4discovery/elf/defconfig
index 3725f36..2bb8c10 100644
--- a/nuttx/configs/stm32f4discovery/elf/defconfig
+++ b/nuttx/configs/stm32f4discovery/elf/defconfig
@@ -55,7 +55,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -307,7 +306,6 @@ CONFIG_STM32_USART=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/stm32f4discovery/kostest/defconfig b/nuttx/configs/stm32f4discovery/kostest/defconfig
index 1e89438..65a97e1 100644
--- a/nuttx/configs/stm32f4discovery/kostest/defconfig
+++ b/nuttx/configs/stm32f4discovery/kostest/defconfig
@@ -62,7 +62,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -356,7 +355,6 @@ CONFIG_STM32_USART=y
 CONFIG_ARCH_HAVE_IRQPRIO=y
 # CONFIG_ARCH_L2CACHE is not set
 # CONFIG_ARCH_HAVE_COHERENT_DCACHE is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_HAVE_ADDRENV is not set
 # CONFIG_ARCH_NEED_ADDRENV_MAPPING is not set
 CONFIG_ARCH_HAVE_VFORK=y
diff --git a/nuttx/configs/stm32f4discovery/nsh/defconfig b/nuttx/configs/stm32f4discovery/nsh/defconfig
index 9fd4224..355586c 100644
--- a/nuttx/configs/stm32f4discovery/nsh/defconfig
+++ b/nuttx/configs/stm32f4discovery/nsh/defconfig
@@ -57,7 +57,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -357,7 +356,6 @@ CONFIG_STM32_USART=y
 CONFIG_ARCH_HAVE_IRQPRIO=y
 # CONFIG_ARCH_L2CACHE is not set
 # CONFIG_ARCH_HAVE_COHERENT_DCACHE is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_HAVE_ADDRENV is not set
 # CONFIG_ARCH_NEED_ADDRENV_MAPPING is not set
 CONFIG_ARCH_HAVE_VFORK=y
diff --git a/nuttx/configs/stm32f4discovery/nxlines/defconfig b/nuttx/configs/stm32f4discovery/nxlines/defconfig
index 606eb6d..340cbc6 100644
--- a/nuttx/configs/stm32f4discovery/nxlines/defconfig
+++ b/nuttx/configs/stm32f4discovery/nxlines/defconfig
@@ -55,7 +55,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -315,7 +314,6 @@ CONFIG_STM32_USART=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/stm32f4discovery/pm/defconfig b/nuttx/configs/stm32f4discovery/pm/defconfig
index b7ac367..1245f15 100644
--- a/nuttx/configs/stm32f4discovery/pm/defconfig
+++ b/nuttx/configs/stm32f4discovery/pm/defconfig
@@ -55,7 +55,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -308,7 +307,6 @@ CONFIG_STM32_USART=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/stm32f4discovery/posix_spawn/defconfig b/nuttx/configs/stm32f4discovery/posix_spawn/defconfig
index 98f2419..281bca0 100644
--- a/nuttx/configs/stm32f4discovery/posix_spawn/defconfig
+++ b/nuttx/configs/stm32f4discovery/posix_spawn/defconfig
@@ -55,7 +55,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -307,7 +306,6 @@ CONFIG_STM32_USART=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/stm32f4discovery/src/stm32_usb.c b/nuttx/configs/stm32f4discovery/src/stm32_usb.c
index 055c1e4..b1b2451 100644
--- a/nuttx/configs/stm32f4discovery/src/stm32_usb.c
+++ b/nuttx/configs/stm32f4discovery/src/stm32_usb.c
@@ -212,7 +212,7 @@ int stm32_usbhost_initialize(void)
 
       uvdbg("Start usbhost_waiter\n");
 
-      pid = TASK_CREATE("usbhost", CONFIG_USBHOST_DEFPRIO,
+      pid = task_create("usbhost", CONFIG_USBHOST_DEFPRIO,
                         CONFIG_USBHOST_STACKSIZE,
                         (main_t)usbhost_waiter, (FAR char * const *)NULL);
       return pid < 0 ? -ENOEXEC : OK;
diff --git a/nuttx/configs/stm32f4discovery/usbnsh/defconfig b/nuttx/configs/stm32f4discovery/usbnsh/defconfig
index 45c9ce6..af19da3 100644
--- a/nuttx/configs/stm32f4discovery/usbnsh/defconfig
+++ b/nuttx/configs/stm32f4discovery/usbnsh/defconfig
@@ -55,7 +55,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -314,7 +313,6 @@ CONFIG_STM32_USART=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/stm32f4discovery/winbuild/defconfig b/nuttx/configs/stm32f4discovery/winbuild/defconfig
index 9f3b106..b51e134 100644
--- a/nuttx/configs/stm32f4discovery/winbuild/defconfig
+++ b/nuttx/configs/stm32f4discovery/winbuild/defconfig
@@ -48,7 +48,6 @@ CONFIG_RAW_BINARY=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -294,7 +293,6 @@ CONFIG_PREALLOC_TIMERS=4
 #
 # Stack and heap information
 #
-# CONFIG_CUSTOM_STACK is not set
 CONFIG_IDLETHREAD_STACKSIZE=1024
 CONFIG_USERMAIN_STACKSIZE=2048
 CONFIG_PTHREAD_STACK_MIN=256
diff --git a/nuttx/configs/stm32ldiscovery/nsh/defconfig b/nuttx/configs/stm32ldiscovery/nsh/defconfig
index 7c486b6..01a3a0b 100644
--- a/nuttx/configs/stm32ldiscovery/nsh/defconfig
+++ b/nuttx/configs/stm32ldiscovery/nsh/defconfig
@@ -48,7 +48,6 @@ CONFIG_RAW_BINARY=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -254,7 +253,6 @@ CONFIG_STM32_USART=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 CONFIG_ARCH_STACKDUMP=y
diff --git a/nuttx/configs/stm32vldiscovery/nsh/defconfig b/nuttx/configs/stm32vldiscovery/nsh/defconfig
index 31d534c..42ccc42 100644
--- a/nuttx/configs/stm32vldiscovery/nsh/defconfig
+++ b/nuttx/configs/stm32vldiscovery/nsh/defconfig
@@ -40,7 +40,6 @@ CONFIG_RAW_BINARY=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -283,7 +282,6 @@ CONFIG_PREALLOC_TIMERS=4
 #
 # Stack and heap information
 #
-# CONFIG_CUSTOM_STACK is not set
 CONFIG_IDLETHREAD_STACKSIZE=1024
 CONFIG_USERMAIN_STACKSIZE=2048
 CONFIG_PTHREAD_STACK_MIN=256
diff --git a/nuttx/configs/sure-pic32mx/nsh/defconfig b/nuttx/configs/sure-pic32mx/nsh/defconfig
index 81a37a4..db5f6d2 100644
--- a/nuttx/configs/sure-pic32mx/nsh/defconfig
+++ b/nuttx/configs/sure-pic32mx/nsh/defconfig
@@ -47,7 +47,6 @@ CONFIG_INTELHEX_BINARY=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -241,7 +240,6 @@ CONFIG_PIC32MX_FMIIEN=1
 CONFIG_ARCH_VECNOTIRQ=y
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 CONFIG_ARCH_STACKDUMP=y
diff --git a/nuttx/configs/sure-pic32mx/src/pic32mx_nsh.c b/nuttx/configs/sure-pic32mx/src/pic32mx_nsh.c
index 4399459..30820b6 100644
--- a/nuttx/configs/sure-pic32mx/src/pic32mx_nsh.c
+++ b/nuttx/configs/sure-pic32mx/src/pic32mx_nsh.c
@@ -307,14 +307,9 @@ static int nsh_usbhostinitialize(void)
 
       message("nsh_usbhostinitialize: Start nsh_waiter\n");
 
-#ifndef CONFIG_CUSTOM_STACK
       pid = task_create("usbhost", CONFIG_USBHOST_DEFPRIO,
                         CONFIG_USBHOST_STACKSIZE,
                         (main_t)nsh_waiter, (FAR char * const *)NULL);
-#else
-      pid = task_create("usbhost", CONFIG_USBHOST_DEFPRIO,
-                        (main_t)nsh_waiter, (FAR char * const *)NULL);
-#endif
       return pid < 0 ? -ENOEXEC : OK;
     }
   return -ENODEV;
diff --git a/nuttx/configs/sure-pic32mx/usbnsh/defconfig b/nuttx/configs/sure-pic32mx/usbnsh/defconfig
index 06263a3..5718ca5 100644
--- a/nuttx/configs/sure-pic32mx/usbnsh/defconfig
+++ b/nuttx/configs/sure-pic32mx/usbnsh/defconfig
@@ -47,7 +47,6 @@ CONFIG_INTELHEX_BINARY=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -242,7 +241,6 @@ CONFIG_PIC32MX_FMIIEN=1
 CONFIG_ARCH_VECNOTIRQ=y
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 CONFIG_ARCH_STACKDUMP=y
diff --git a/nuttx/configs/teensy/hello/defconfig b/nuttx/configs/teensy/hello/defconfig
index 6a12472..b7093f1 100644
--- a/nuttx/configs/teensy/hello/defconfig
+++ b/nuttx/configs/teensy/hello/defconfig
@@ -54,7 +54,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 CONFIG_ARCH_AVR=y
 # CONFIG_ARCH_HC is not set
@@ -104,7 +103,6 @@ CONFIG_ARCH_NOINTC=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 # CONFIG_ARCH_HAVE_VFORK is not set
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/teensy/nsh/defconfig b/nuttx/configs/teensy/nsh/defconfig
index d436140..5bca1bb 100644
--- a/nuttx/configs/teensy/nsh/defconfig
+++ b/nuttx/configs/teensy/nsh/defconfig
@@ -54,7 +54,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 CONFIG_ARCH_AVR=y
 # CONFIG_ARCH_HC is not set
@@ -104,7 +103,6 @@ CONFIG_ARCH_NOINTC=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 # CONFIG_ARCH_HAVE_VFORK is not set
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/teensy/usbmsc/defconfig b/nuttx/configs/teensy/usbmsc/defconfig
index 4e3f47d..16392c1 100644
--- a/nuttx/configs/teensy/usbmsc/defconfig
+++ b/nuttx/configs/teensy/usbmsc/defconfig
@@ -54,7 +54,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 CONFIG_ARCH_AVR=y
 # CONFIG_ARCH_HC is not set
@@ -104,7 +103,6 @@ CONFIG_ARCH_NOINTC=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 # CONFIG_ARCH_HAVE_VFORK is not set
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/tm4c123g-launchpad/nsh/defconfig b/nuttx/configs/tm4c123g-launchpad/nsh/defconfig
index 2ffe56e..9e69bb6 100644
--- a/nuttx/configs/tm4c123g-launchpad/nsh/defconfig
+++ b/nuttx/configs/tm4c123g-launchpad/nsh/defconfig
@@ -51,7 +51,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -168,7 +167,6 @@ CONFIG_SSI_TXLIMIT=4
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/twr-k60n512/nsh/defconfig b/nuttx/configs/twr-k60n512/nsh/defconfig
index 3018bb4..fa3709b 100644
--- a/nuttx/configs/twr-k60n512/nsh/defconfig
+++ b/nuttx/configs/twr-k60n512/nsh/defconfig
@@ -43,7 +43,6 @@ CONFIG_INTELHEX_BINARY=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -174,7 +173,6 @@ CONFIG_KINETIS_UART3=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 CONFIG_ARCH_STACKDUMP=y
diff --git a/nuttx/configs/ubw32/nsh/defconfig b/nuttx/configs/ubw32/nsh/defconfig
index 245ded6..e4e2662 100644
--- a/nuttx/configs/ubw32/nsh/defconfig
+++ b/nuttx/configs/ubw32/nsh/defconfig
@@ -54,7 +54,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -254,7 +253,6 @@ CONFIG_PIC32MX_FMIIEN=1
 CONFIG_ARCH_VECNOTIRQ=y
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/us7032evb1/nsh/defconfig b/nuttx/configs/us7032evb1/nsh/defconfig
index 1790a4c..749af12 100644
--- a/nuttx/configs/us7032evb1/nsh/defconfig
+++ b/nuttx/configs/us7032evb1/nsh/defconfig
@@ -49,7 +49,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -96,7 +95,6 @@ CONFIG_ARCH_NOINTC=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 # CONFIG_ARCH_HAVE_VFORK is not set
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/us7032evb1/ostest/defconfig b/nuttx/configs/us7032evb1/ostest/defconfig
index 045089b..161ec91 100644
--- a/nuttx/configs/us7032evb1/ostest/defconfig
+++ b/nuttx/configs/us7032evb1/ostest/defconfig
@@ -49,7 +49,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -96,7 +95,6 @@ CONFIG_ARCH_NOINTC=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_HAVE_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 # CONFIG_ARCH_HAVE_VFORK is not set
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/viewtool-stm32f107/highpri/defconfig b/nuttx/configs/viewtool-stm32f107/highpri/defconfig
index f12ea61..ed6e38e 100644
--- a/nuttx/configs/viewtool-stm32f107/highpri/defconfig
+++ b/nuttx/configs/viewtool-stm32f107/highpri/defconfig
@@ -55,7 +55,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -288,7 +287,6 @@ CONFIG_STM32_USART=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/viewtool-stm32f107/netnsh/defconfig b/nuttx/configs/viewtool-stm32f107/netnsh/defconfig
index 5bbd918..d3e9790 100644
--- a/nuttx/configs/viewtool-stm32f107/netnsh/defconfig
+++ b/nuttx/configs/viewtool-stm32f107/netnsh/defconfig
@@ -56,7 +56,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -349,7 +348,6 @@ CONFIG_STM32_RMII_EXTCLK=y
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
 # CONFIG_ARCH_L2CACHE is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/viewtool-stm32f107/nsh/defconfig b/nuttx/configs/viewtool-stm32f107/nsh/defconfig
index 82bc316..7585fff 100644
--- a/nuttx/configs/viewtool-stm32f107/nsh/defconfig
+++ b/nuttx/configs/viewtool-stm32f107/nsh/defconfig
@@ -56,7 +56,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -326,7 +325,6 @@ CONFIG_STM32_USART=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/vsn/nsh/defconfig b/nuttx/configs/vsn/nsh/defconfig
index 8c51472..f0da5b5 100644
--- a/nuttx/configs/vsn/nsh/defconfig
+++ b/nuttx/configs/vsn/nsh/defconfig
@@ -54,7 +54,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -320,7 +319,6 @@ CONFIG_SDIO_PRI=128
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/xtrs/nsh/defconfig b/nuttx/configs/xtrs/nsh/defconfig
index 07ea7f2..6c1fd8c 100644
--- a/nuttx/configs/xtrs/nsh/defconfig
+++ b/nuttx/configs/xtrs/nsh/defconfig
@@ -49,7 +49,6 @@ CONFIG_WINDOWS_NATIVE=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -166,7 +165,6 @@ CONFIG_PREALLOC_TIMERS=0
 #
 # Stack and heap information
 #
-# CONFIG_CUSTOM_STACK is not set
 CONFIG_IDLETHREAD_STACKSIZE=1024
 CONFIG_USERMAIN_STACKSIZE=1024
 CONFIG_PTHREAD_STACK_MIN=256
diff --git a/nuttx/configs/xtrs/ostest/defconfig b/nuttx/configs/xtrs/ostest/defconfig
index 8367db6..3a25c8f 100644
--- a/nuttx/configs/xtrs/ostest/defconfig
+++ b/nuttx/configs/xtrs/ostest/defconfig
@@ -49,7 +49,6 @@ CONFIG_WINDOWS_NATIVE=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -165,7 +164,6 @@ CONFIG_PREALLOC_TIMERS=0
 #
 # Stack and heap information
 #
-# CONFIG_CUSTOM_STACK is not set
 CONFIG_IDLETHREAD_STACKSIZE=1024
 CONFIG_USERMAIN_STACKSIZE=1024
 CONFIG_PTHREAD_STACK_MIN=256
diff --git a/nuttx/configs/xtrs/pashello/defconfig b/nuttx/configs/xtrs/pashello/defconfig
index b62be77..442f012 100644
--- a/nuttx/configs/xtrs/pashello/defconfig
+++ b/nuttx/configs/xtrs/pashello/defconfig
@@ -49,7 +49,6 @@ CONFIG_WINDOWS_NATIVE=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -166,7 +165,6 @@ CONFIG_PREALLOC_TIMERS=0
 #
 # Stack and heap information
 #
-# CONFIG_CUSTOM_STACK is not set
 CONFIG_IDLETHREAD_STACKSIZE=1024
 CONFIG_USERMAIN_STACKSIZE=1024
 CONFIG_PTHREAD_STACK_MIN=256
diff --git a/nuttx/configs/z16f2800100zcog/nsh/defconfig b/nuttx/configs/z16f2800100zcog/nsh/defconfig
index 7973fd9..472bba3 100644
--- a/nuttx/configs/z16f2800100zcog/nsh/defconfig
+++ b/nuttx/configs/z16f2800100zcog/nsh/defconfig
@@ -75,7 +75,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -120,7 +119,6 @@ CONFIG_Z16F_UART1=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 # CONFIG_ARCH_HAVE_VFORK is not set
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/z16f2800100zcog/ostest/defconfig b/nuttx/configs/z16f2800100zcog/ostest/defconfig
index 38044eb..0ea76ac 100644
--- a/nuttx/configs/z16f2800100zcog/ostest/defconfig
+++ b/nuttx/configs/z16f2800100zcog/ostest/defconfig
@@ -70,7 +70,6 @@ CONFIG_DEBUG=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -110,7 +109,6 @@ CONFIG_Z16F_UART1=y
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 # CONFIG_ARCH_HAVE_VFORK is not set
 # CONFIG_ARCH_IRQPRIO is not set
diff --git a/nuttx/configs/z16f2800100zcog/pashello/defconfig b/nuttx/configs/z16f2800100zcog/pashello/defconfig
index e4205c8..31f8b68 100644
--- a/nuttx/configs/z16f2800100zcog/pashello/defconfig
+++ b/nuttx/configs/z16f2800100zcog/pashello/defconfig
@@ -65,7 +65,6 @@ CONFIG_DEBUG=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -189,7 +188,6 @@ CONFIG_PREALLOC_TIMERS=4
 #
 # Stack and heap information
 #
-# CONFIG_CUSTOM_STACK is not set
 CONFIG_IDLETHREAD_STACKSIZE=4096
 CONFIG_USERMAIN_STACKSIZE=4096
 CONFIG_PTHREAD_STACK_MIN=256
diff --git a/nuttx/configs/z80sim/nsh/defconfig b/nuttx/configs/z80sim/nsh/defconfig
index 404c555..979f163 100644
--- a/nuttx/configs/z80sim/nsh/defconfig
+++ b/nuttx/configs/z80sim/nsh/defconfig
@@ -49,7 +49,6 @@ CONFIG_WINDOWS_NATIVE=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -166,7 +165,6 @@ CONFIG_PREALLOC_TIMERS=0
 #
 # Stack and heap information
 #
-# CONFIG_CUSTOM_STACK is not set
 CONFIG_IDLETHREAD_STACKSIZE=1024
 CONFIG_USERMAIN_STACKSIZE=1024
 CONFIG_PTHREAD_STACK_MIN=256
diff --git a/nuttx/configs/z80sim/ostest/defconfig b/nuttx/configs/z80sim/ostest/defconfig
index 58e8a07..fd62b38 100644
--- a/nuttx/configs/z80sim/ostest/defconfig
+++ b/nuttx/configs/z80sim/ostest/defconfig
@@ -49,7 +49,6 @@ CONFIG_WINDOWS_NATIVE=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -165,7 +164,6 @@ CONFIG_PREALLOC_TIMERS=0
 #
 # Stack and heap information
 #
-# CONFIG_CUSTOM_STACK is not set
 CONFIG_IDLETHREAD_STACKSIZE=1024
 CONFIG_USERMAIN_STACKSIZE=1024
 CONFIG_PTHREAD_STACK_MIN=256
diff --git a/nuttx/configs/z80sim/pashello/defconfig b/nuttx/configs/z80sim/pashello/defconfig
index 1030046..c0ad78c 100644
--- a/nuttx/configs/z80sim/pashello/defconfig
+++ b/nuttx/configs/z80sim/pashello/defconfig
@@ -49,7 +49,6 @@ CONFIG_WINDOWS_NATIVE=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -165,7 +164,6 @@ CONFIG_PREALLOC_TIMERS=0
 #
 # Stack and heap information
 #
-# CONFIG_CUSTOM_STACK is not set
 CONFIG_IDLETHREAD_STACKSIZE=1024
 CONFIG_USERMAIN_STACKSIZE=1024
 CONFIG_PTHREAD_STACK_MIN=256
diff --git a/nuttx/configs/z8encore000zco/ostest/defconfig b/nuttx/configs/z8encore000zco/ostest/defconfig
index 29b9ec6..d08fb76 100644
--- a/nuttx/configs/z8encore000zco/ostest/defconfig
+++ b/nuttx/configs/z8encore000zco/ostest/defconfig
@@ -66,7 +66,6 @@ CONFIG_DEBUG=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -181,7 +180,6 @@ CONFIG_PREALLOC_TIMERS=0
 #
 # Stack and heap information
 #
-# CONFIG_CUSTOM_STACK is not set
 CONFIG_IDLETHREAD_STACKSIZE=256
 CONFIG_USERMAIN_STACKSIZE=256
 CONFIG_PTHREAD_STACK_MIN=128
diff --git a/nuttx/configs/z8f64200100kit/ostest/defconfig b/nuttx/configs/z8f64200100kit/ostest/defconfig
index 3d1df01..6589cdd 100644
--- a/nuttx/configs/z8f64200100kit/ostest/defconfig
+++ b/nuttx/configs/z8f64200100kit/ostest/defconfig
@@ -66,7 +66,6 @@ CONFIG_DEBUG=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 # CONFIG_ARCH_ARM is not set
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -181,7 +180,6 @@ CONFIG_PREALLOC_TIMERS=0
 #
 # Stack and heap information
 #
-# CONFIG_CUSTOM_STACK is not set
 CONFIG_IDLETHREAD_STACKSIZE=256
 CONFIG_USERMAIN_STACKSIZE=256
 CONFIG_PTHREAD_STACK_MIN=128
diff --git a/nuttx/configs/zkit-arm-1769/hello/defconfig b/nuttx/configs/zkit-arm-1769/hello/defconfig
index f3a9a8d..fb5e4fd 100644
--- a/nuttx/configs/zkit-arm-1769/hello/defconfig
+++ b/nuttx/configs/zkit-arm-1769/hello/defconfig
@@ -52,7 +52,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -206,7 +205,6 @@ CONFIG_NET_NRXDESC=18
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/zkit-arm-1769/nsh/defconfig b/nuttx/configs/zkit-arm-1769/nsh/defconfig
index 054ccf5..590cf12 100644
--- a/nuttx/configs/zkit-arm-1769/nsh/defconfig
+++ b/nuttx/configs/zkit-arm-1769/nsh/defconfig
@@ -52,7 +52,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -206,7 +205,6 @@ CONFIG_NET_NRXDESC=7
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/zkit-arm-1769/nxhello/defconfig b/nuttx/configs/zkit-arm-1769/nxhello/defconfig
index 0064261..0be8622 100644
--- a/nuttx/configs/zkit-arm-1769/nxhello/defconfig
+++ b/nuttx/configs/zkit-arm-1769/nxhello/defconfig
@@ -52,7 +52,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -206,7 +205,6 @@ CONFIG_NET_NRXDESC=7
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/zkit-arm-1769/thttpd/defconfig b/nuttx/configs/zkit-arm-1769/thttpd/defconfig
index d4c721f..3ce185f 100644
--- a/nuttx/configs/zkit-arm-1769/thttpd/defconfig
+++ b/nuttx/configs/zkit-arm-1769/thttpd/defconfig
@@ -52,7 +52,6 @@ CONFIG_DEBUG_FULLOPT=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -206,7 +205,6 @@ CONFIG_NET_NRXDESC=18
 # CONFIG_ARCH_VECNOTIRQ is not set
 # CONFIG_ARCH_DMA is not set
 CONFIG_ARCH_HAVE_IRQPRIO=y
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_HAVE_VFORK=y
 # CONFIG_ARCH_HAVE_MMU is not set
diff --git a/nuttx/configs/zp214xpa/nsh/defconfig b/nuttx/configs/zp214xpa/nsh/defconfig
index 57feef3..3b6183f 100644
--- a/nuttx/configs/zp214xpa/nsh/defconfig
+++ b/nuttx/configs/zp214xpa/nsh/defconfig
@@ -43,7 +43,6 @@ CONFIG_RAW_BINARY=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -124,7 +123,6 @@ CONFIG_LPC214X_UART1=y
 # CONFIG_ARCH_NOINTC is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_STACKDUMP=y
 # CONFIG_ENDIAN_BIG is not set
diff --git a/nuttx/configs/zp214xpa/nxlines/defconfig b/nuttx/configs/zp214xpa/nxlines/defconfig
index a024c0c..b96b685 100644
--- a/nuttx/configs/zp214xpa/nxlines/defconfig
+++ b/nuttx/configs/zp214xpa/nxlines/defconfig
@@ -43,7 +43,6 @@ CONFIG_RAW_BINARY=y
 #
 # System Type
 #
-# CONFIG_ARCH_8051 is not set
 CONFIG_ARCH_ARM=y
 # CONFIG_ARCH_AVR is not set
 # CONFIG_ARCH_HC is not set
@@ -124,7 +123,6 @@ CONFIG_LPC214X_UART1=y
 # CONFIG_ARCH_NOINTC is not set
 # CONFIG_ARCH_DMA is not set
 # CONFIG_ARCH_IRQPRIO is not set
-# CONFIG_CUSTOM_STACK is not set
 # CONFIG_ARCH_ADDRENV is not set
 CONFIG_ARCH_STACKDUMP=y
 # CONFIG_ENDIAN_BIG is not set
diff --git a/nuttx/drivers/net/slip.c b/nuttx/drivers/net/slip.c
index b09a797..799a12f 100644
--- a/nuttx/drivers/net/slip.c
+++ b/nuttx/drivers/net/slip.c
@@ -960,13 +960,8 @@ int slip_initialize(int intf, FAR const char *devname)
   argv[0] = buffer;
   argv[1] = NULL;
 
-#ifndef CONFIG_CUSTOM_STACK
   priv->rxpid = task_create("rxslip", CONFIG_SLIP_DEFPRIO,
                           CONFIG_SLIP_STACKSIZE, (main_t)slip_rxtask, argv);
-#else
-  priv->rxpid = task_create("rxslip", CONFIG_SLIP_DEFPRIO,
-                          (main_t)slip_rxtask, argv);
-#endif
   if (priv->rxpid < 0)
     {
       ndbg("ERROR: Failed to start receiver task\n");
@@ -979,13 +974,8 @@ int slip_initialize(int intf, FAR const char *devname)
 
   /* Start the SLIP transmitter task */
 
-#ifndef CONFIG_CUSTOM_STACK
   priv->txpid = task_create("txslip", CONFIG_SLIP_DEFPRIO,
-                          CONFIG_SLIP_STACKSIZE, (main_t)slip_txtask, argv);
-#else
-  priv->txpid = task_create("txslip", CONFIG_SLIP_DEFPRIO,
-                          (main_t)slip_txtask, argv);
-#endif
+                            CONFIG_SLIP_STACKSIZE, (main_t)slip_txtask, argv);
   if (priv->txpid < 0)
     {
       ndbg("ERROR: Failed to start receiver task\n");
diff --git a/nuttx/drivers/usbdev/usbmsc.c b/nuttx/drivers/usbdev/usbmsc.c
index 6bcd33f..05fd8e7 100644
--- a/nuttx/drivers/usbdev/usbmsc.c
+++ b/nuttx/drivers/usbdev/usbmsc.c
@@ -1646,7 +1646,7 @@ int usbmsc_exportluns(FAR void *handle)
   g_usbmsc_handoff = priv;
 
   uvdbg("Starting SCSI worker thread\n");
-  priv->thpid = KERNEL_THREAD("scsid", CONFIG_USBMSC_SCSI_PRIO,
+  priv->thpid = kernel_thread("scsid", CONFIG_USBMSC_SCSI_PRIO,
                               CONFIG_USBMSC_SCSI_STACKSIZE,
                               usbmsc_scsi_main, NULL);
   if (priv->thpid <= 0)
diff --git a/nuttx/drivers/usbhost/usbhost_hidkbd.c b/nuttx/drivers/usbhost/usbhost_hidkbd.c
index 763c315..53cd155 100644
--- a/nuttx/drivers/usbhost/usbhost_hidkbd.c
+++ b/nuttx/drivers/usbhost/usbhost_hidkbd.c
@@ -1577,14 +1577,9 @@ static inline int usbhost_devinit(FAR struct usbhost_state_s *priv)
   usbhost_takesem(&g_exclsem);
   g_priv = priv;
 
-#ifndef CONFIG_CUSTOM_STACK
   priv->pollpid = task_create("kbdpoll", CONFIG_HIDKBD_DEFPRIO,
                               CONFIG_HIDKBD_STACKSIZE,
                               (main_t)usbhost_kbdpoll, (FAR char * const *)NULL);
-#else
-  priv->pollpid = task_create("kbdpoll", CONFIG_HIDKBD_DEFPRIO,
-                              (main_t)usbhost_kbdpoll, (FAR char * const *)NULL);
-#endif
   if (priv->pollpid == ERROR)
     {
       /* Failed to started the poll thread... probably due to memory resources */
diff --git a/nuttx/drivers/usbhost/usbhost_hidmouse.c b/nuttx/drivers/usbhost/usbhost_hidmouse.c
index 5fdf181..d79d94f 100644
--- a/nuttx/drivers/usbhost/usbhost_hidmouse.c
+++ b/nuttx/drivers/usbhost/usbhost_hidmouse.c
@@ -1649,14 +1649,9 @@ static inline int usbhost_devinit(FAR struct usbhost_state_s *priv)
   usbhost_takesem(&g_exclsem);
   g_priv = priv;
 
-#ifndef CONFIG_CUSTOM_STACK
   priv->pollpid = task_create("mouse", CONFIG_HIDMOUSE_DEFPRIO,
                               CONFIG_HIDMOUSE_STACKSIZE,
                               (main_t)usbhost_mouse_poll, (FAR char * const *)NULL);
-#else
-  priv->pollpid = task_create("mouse", CONFIG_HIDMOUSE_DEFPRIO,
-                              (main_t)usbhost_mouse_poll, (FAR char * const *)NULL);
-#endif
   if (priv->pollpid == ERROR)
     {
       /* Failed to started the poll thread... probably due to memory resources */
diff --git a/nuttx/graphics/nxmu/nx_start.c b/nuttx/graphics/nxmu/nx_start.c
index 0be859c..f11d4c5 100644
--- a/nuttx/graphics/nxmu/nx_start.c
+++ b/nuttx/graphics/nxmu/nx_start.c
@@ -188,7 +188,7 @@ int nx_start(void)
   /* Start the server kernel thread */
 
   gvdbg("Starting server task\n");
-  server = KERNEL_THREAD("NX Server", CONFIG_NXSTART_SERVERPRIO,
+  server = kernel_thread("NX Server", CONFIG_NXSTART_SERVERPRIO,
                          CONFIG_NXSTART_SERVERSTACK, nx_server, NULL);
   if (server < 0)
     {
diff --git a/nuttx/include/nuttx/arch.h b/nuttx/include/nuttx/arch.h
index cd49154..724f592 100644
--- a/nuttx/include/nuttx/arch.h
+++ b/nuttx/include/nuttx/arch.h
@@ -239,9 +239,7 @@ void up_initial_state(FAR struct tcb_s *tcb);
  *
  ****************************************************************************/
 
-#ifndef CONFIG_CUSTOM_STACK
 int up_create_stack(FAR struct tcb_s *tcb, size_t stack_size, uint8_t ttype);
-#endif
 
 /****************************************************************************
  * Name: up_use_stack
@@ -272,9 +270,7 @@ int up_create_stack(FAR struct tcb_s *tcb, size_t stack_size, uint8_t ttype);
  *
  ****************************************************************************/
 
-#ifndef CONFIG_CUSTOM_STACK
 int up_use_stack(FAR struct tcb_s *tcb, FAR void *stack, size_t stack_size);
-#endif
 
 /****************************************************************************
  * Name: up_stack_frame
@@ -308,8 +304,7 @@ int up_use_stack(FAR struct tcb_s *tcb, FAR void *stack, size_t stack_size);
  *
  ****************************************************************************/
 
-#if !defined(CONFIG_CUSTOM_STACK) && (defined(CONFIG_BUILD_PROTECTED) || \
-     defined(CONFIG_BUILD_KERNEL))
+#if defined(CONFIG_BUILD_PROTECTED) || defined(CONFIG_BUILD_KERNEL)
 FAR void *up_stack_frame(FAR struct tcb_s *tcb, size_t frame_size);
 #endif
 
@@ -344,9 +339,7 @@ FAR void *up_stack_frame(FAR struct tcb_s *tcb, size_t frame_size);
  *
  ****************************************************************************/
 
-#ifndef CONFIG_CUSTOM_STACK
 void up_release_stack(FAR struct tcb_s *dtcb, uint8_t ttype);
-#endif
 
 /****************************************************************************
  * Name: up_unblock_task
diff --git a/nuttx/include/nuttx/kthread.h b/nuttx/include/nuttx/kthread.h
index 7d84091..01726f6 100644
--- a/nuttx/include/nuttx/kthread.h
+++ b/nuttx/include/nuttx/kthread.h
@@ -48,18 +48,6 @@
  * Pre-Processor Definitions
  ****************************************************************************/
 
-/* One processor family supported by NuttX has a single, fixed hardware stack.
- * That is the 8051 family.  So for that family only, there is a variant form
- * of kernel_thread() that does not take a stack size parameter.  The following
- * helper macro is provided to work around the ugliness of that exception.
- */
-
-#ifndef CONFIG_CUSTOM_STACK
-#  define KERNEL_THREAD(n,p,s,e,a)   kernel_thread(n,p,s,e,a)
-#else
-#  define KERNEL_THREAD(n,p,s,e,a)   kernel_thread(n,p,e,a)
-#endif
-
 /****************************************************************************
  * Public Data
  ****************************************************************************/
@@ -92,13 +80,8 @@ extern "C"
  *
  ********************************************************************************/
 
-#ifndef CONFIG_CUSTOM_STACK
 int kernel_thread(FAR const char *name, int priority, int stack_size,
                   main_t entry, FAR char * const argv[]);
-#else
-int kernel_thread(FAR const char *name, int priority, main_t entry,
-                  FAR char * const argv[]);
-#endif
 
 #undef EXTERN
 #ifdef __cplusplus
diff --git a/nuttx/include/nuttx/sched.h b/nuttx/include/nuttx/sched.h
index 279abea..40442cc 100644
--- a/nuttx/include/nuttx/sched.h
+++ b/nuttx/include/nuttx/sched.h
@@ -482,7 +482,6 @@ struct tcb_s
 
   /* Stack-Related Fields *******************************************************/
 
-#ifndef CONFIG_CUSTOM_STACK
   size_t    adj_stack_size;              /* Stack size after adjustment         */
                                          /* for hardware, processor, etc.       */
                                          /* (for debug purposes only)           */
@@ -490,7 +489,6 @@ struct tcb_s
                                          /* Need to deallocate stack            */
   FAR void *adj_stack_ptr;               /* Adjusted stack_alloc_ptr for HW     */
                                          /* The initial stack pointer value     */
-#endif
 
   /* External Module Support ****************************************************/
 
@@ -560,8 +558,7 @@ struct task_tcb_s
 
   uint8_t  init_priority;                /* Initial priority of the task        */
 
-#if !defined(CONFIG_CUSTOM_STACK) && (defined(CONFIG_BUILD_PROTECTED) || \
-     defined(CONFIG_BUILD_KERNEL))
+#if defined(CONFIG_BUILD_PROTECTED) || defined(CONFIG_BUILD_KERNEL)
   /* In the kernel mode build, the arguments are saved on the task's stack      */
 
   FAR char **argv;                       /* Name+start-up parameters            */
diff --git a/nuttx/include/sched.h b/nuttx/include/sched.h
index bb414b6..96afbed 100644
--- a/nuttx/include/sched.h
+++ b/nuttx/include/sched.h
@@ -63,21 +63,6 @@
 
 #define PTHREAD_KEYS_MAX CONFIG_NPTHREAD_KEYS
 
-/* Non-standard Helper **********************************************************/
-/* One processor family supported by NuttX has a single, fixed hardware stack.
- * That is the 8051 family.  So for that family only, there is a variant form
- * of task_create() that does not take a stack size parameter.  The following
- * helper macros are provided to work around the ugliness of that exception.
- */
-
-#ifndef CONFIG_CUSTOM_STACK
-#  define TASK_INIT(t,n,p,m,s,e,a) task_init(t,n,p,m,s,e,a)
-#  define TASK_CREATE(n,p,s,e,a)   task_create(n,p,s,e,a)
-#else
-#  define TASK_INIT(t,n,p,m,s,e,a) task_init(t,n,p,e,a)
-#  define TASK_CREATE(n,p,s,e,a)   task_create(n,p,e,a)
-#endif
-
 /********************************************************************************
  * Public Type Definitions
  ********************************************************************************/
@@ -109,22 +94,12 @@ extern "C"
 
 /* Task Control Interfaces (non-standard) */
 
-#ifndef CONFIG_CUSTOM_STACK
 int    task_init(FAR struct tcb_s *tcb, const char *name, int priority,
                  FAR uint32_t *stack, uint32_t stack_size, main_t entry,
                  FAR char * const argv[]);
-#else
-int    task_init(FAR struct tcb_s *tcb, const char *name, int priority,
-                 main_t entry, FAR char * const argv[]);
-#endif
 int    task_activate(FAR struct tcb_s *tcb);
-#ifndef CONFIG_CUSTOM_STACK
 int    task_create(FAR const char *name, int priority, int stack_size,
                    main_t entry, FAR char * const argv[]);
-#else
-int    task_create(FAR const char *name, int priority, main_t entry,
-                   FAR char * const argv[]);
-#endif
 int    task_delete(pid_t pid);
 int    task_restart(pid_t pid);
 
diff --git a/nuttx/libc/wqueue/work_usrstart.c b/nuttx/libc/wqueue/work_usrstart.c
index 068c016..00264cb 100644
--- a/nuttx/libc/wqueue/work_usrstart.c
+++ b/nuttx/libc/wqueue/work_usrstart.c
@@ -93,7 +93,7 @@ int work_usrstart(void)
 
   svdbg("Starting user-mode worker thread\n");
 
-  g_usrwork[USRWORK].pid = TASK_CREATE("usrwork",
+  g_usrwork[USRWORK].pid = task_create("usrwork",
                                        CONFIG_SCHED_USRWORKPRIORITY,
                                        CONFIG_SCHED_USRWORKSTACKSIZE,
                                        (main_t)work_usrthread,
diff --git a/nuttx/sched/init/os_bringup.c b/nuttx/sched/init/os_bringup.c
index b084bd1..f85a33e 100644
--- a/nuttx/sched/init/os_bringup.c
+++ b/nuttx/sched/init/os_bringup.c
@@ -182,7 +182,7 @@ static inline void os_pgworker(void)
 
   svdbg("Starting paging thread\n");
 
-  g_pgworker = KERNEL_THREAD("pgfill", CONFIG_PAGING_DEFPRIO,
+  g_pgworker = kernel_thread("pgfill", CONFIG_PAGING_DEFPRIO,
                              CONFIG_PAGING_STACKSIZE,
                              (main_t)pg_worker, (FAR char * const *)NULL);
   DEBUGASSERT(g_pgworker > 0);
@@ -221,7 +221,7 @@ static inline void os_workqueues(void)
   svdbg("Starting kernel worker thread\n");
 #endif
 
-  g_work[HPWORK].pid = KERNEL_THREAD(HPWORKNAME, CONFIG_SCHED_WORKPRIORITY,
+  g_work[HPWORK].pid = kernel_thread(HPWORKNAME, CONFIG_SCHED_WORKPRIORITY,
                                      CONFIG_SCHED_WORKSTACKSIZE,
                                      (main_t)work_hpthread,
                                      (FAR char * const *)NULL);
@@ -235,7 +235,7 @@ static inline void os_workqueues(void)
 
   svdbg("Starting low-priority kernel worker thread\n");
 
-  g_work[LPWORK].pid = KERNEL_THREAD(LPWORKNAME, CONFIG_SCHED_LPWORKPRIORITY,
+  g_work[LPWORK].pid = kernel_thread(LPWORKNAME, CONFIG_SCHED_LPWORKPRIORITY,
                                      CONFIG_SCHED_LPWORKSTACKSIZE,
                                      (main_t)work_lpthread,
                                      (FAR char * const *)NULL);
@@ -288,11 +288,11 @@ static inline void os_init_thread(void)
 
 #ifdef CONFIG_BUILD_PROTECTED
   DEBUGASSERT(USERSPACE->us_entrypoint != NULL);
-  taskid = TASK_CREATE("init", SCHED_PRIORITY_DEFAULT,
+  taskid = task_create("init", SCHED_PRIORITY_DEFAULT,
                        CONFIG_USERMAIN_STACKSIZE, USERSPACE->us_entrypoint,
                        (FAR char * const *)NULL);
 #else
-  taskid = TASK_CREATE("init", SCHED_PRIORITY_DEFAULT,
+  taskid = task_create("init", SCHED_PRIORITY_DEFAULT,
                        CONFIG_USERMAIN_STACKSIZE,
                        (main_t)CONFIG_USER_ENTRYPOINT,
                        (FAR char * const *)NULL);
diff --git a/nuttx/sched/init/os_start.c b/nuttx/sched/init/os_start.c
index 4f6da4e..cf83b93 100644
--- a/nuttx/sched/init/os_start.c
+++ b/nuttx/sched/init/os_start.c
@@ -311,14 +311,13 @@ void os_start(void)
    * and there is no support that yet.
    */
 
-#if defined(CONFIG_CUSTOM_STACK) || (!defined(CONFIG_BUILD_PROTECTED) && \
-   !defined(CONFIG_BUILD_KERNEL))
+#if !defined(CONFIG_BUILD_PROTECTED) && !defined(CONFIG_BUILD_KERNEL)
 #if CONFIG_TASK_NAME_SIZE > 0
   g_idletcb.argv[0] = g_idletcb.cmn.name;
 #else
   g_idletcb.argv[0] = (char*)g_idlename;
 #endif /* CONFIG_TASK_NAME_SIZE */
-#endif /* CONFIG_CUSTOM_STACK || (!CONFIG_BUILD_PROTECTED && !CONFIG_BUILD_KERNEL) */
+#endif /* !CONFIG_BUILD_PROTECTED && !CONFIG_BUILD_KERNEL */
 
   /* Then add the idle task's TCB to the head of the ready to run list */
 
diff --git a/nuttx/sched/sched/sched_releasetcb.c b/nuttx/sched/sched/sched_releasetcb.c
index ecfaf72..724e9e4 100644
--- a/nuttx/sched/sched/sched_releasetcb.c
+++ b/nuttx/sched/sched/sched_releasetcb.c
@@ -111,8 +111,7 @@ static void sched_releasepid(pid_t pid)
 int sched_releasetcb(FAR struct tcb_s *tcb, uint8_t ttype)
 {
   int ret = OK;
-#if defined(CONFIG_CUSTOM_STACK) || (!defined(CONFIG_BUILD_PROTECTED) && \
-   !defined(CONFIG_BUILD_KERNEL))
+#if !defined(CONFIG_BUILD_PROTECTED) && !defined(CONFIG_BUILD_KERNEL)
   int i;
 #endif
 
@@ -146,12 +145,10 @@ int sched_releasetcb(FAR struct tcb_s *tcb, uint8_t ttype)
 
       /* Delete the thread's stack if one has been allocated */
 
-#ifndef CONFIG_CUSTOM_STACK
       if (tcb->stack_alloc_ptr)
         {
           up_release_stack(tcb, ttype);
         }
-#endif
 
       /* Delete the tasks's allocated DSpace region (external modules only) */
 
@@ -169,8 +166,7 @@ int sched_releasetcb(FAR struct tcb_s *tcb, uint8_t ttype)
         }
 #endif
 
-#if defined(CONFIG_CUSTOM_STACK) || (!defined(CONFIG_BUILD_PROTECTED) && \
-   !defined(CONFIG_BUILD_KERNEL))
+#if !defined(CONFIG_BUILD_PROTECTED) && !defined(CONFIG_BUILD_KERNEL)
       /* Release command line arguments that were allocated for task
        * start/re-start.
        *
@@ -190,7 +186,7 @@ int sched_releasetcb(FAR struct tcb_s *tcb, uint8_t ttype)
             }
         }
 
-#endif /* CONFIG_CUSTOM_STACK || (!CONFIG_BUILD_PROTECTED && !CONFIG_BUILD_KERNEL) */
+#endif /* !CONFIG_BUILD_PROTECTED && !CONFIG_BUILD_KERNEL */
 
       /* Release this thread's reference to the address environment */
 
diff --git a/nuttx/sched/task/task_create.c b/nuttx/sched/task/task_create.c
index ca0ed89..4e7d656 100644
--- a/nuttx/sched/task/task_create.c
+++ b/nuttx/sched/task/task_create.c
@@ -100,13 +100,8 @@
  *
  ****************************************************************************/
 
-#ifndef CONFIG_CUSTOM_STACK
 static int thread_create(FAR const char *name, uint8_t ttype, int priority,
                          int stack_size, main_t entry, FAR char * const argv[])
-#else
-static int thread_create(FAR const char *name, uint8_t ttype, int priority,
-                         main_t entry, FAR char * const argv[])
-#endif
 {
   FAR struct task_tcb_s *tcb;
   pid_t pid;
@@ -147,14 +142,12 @@ static int thread_create(FAR const char *name, uint8_t ttype, int priority,
 
   /* Allocate the stack for the TCB */
 
-#ifndef CONFIG_CUSTOM_STACK
   ret = up_create_stack((FAR struct tcb_s *)tcb, stack_size, ttype);
   if (ret < OK)
     {
       errcode = -ret;
       goto errout_with_tcb;
     }
-#endif
 
   /* Initialize the task control block */
 
@@ -245,19 +238,10 @@ errout:
  *
  ****************************************************************************/
 
-#ifndef CONFIG_CUSTOM_STACK
 int task_create(FAR const char *name, int priority,
                 int stack_size, main_t entry, FAR char * const argv[])
-#else
-int task_create(FAR const char *name, int priority,
-                main_t entry, FAR char * const argv[])
-#endif
 {
-#ifndef CONFIG_CUSTOM_STACK
   return thread_create(name, TCB_FLAG_TTYPE_TASK, priority, stack_size, entry, argv);
-#else
-  return thread_create(name, TCB_FLAG_TTYPE_TASK, priority, entry, argv);
-#endif
 }
 
 /****************************************************************************
@@ -276,18 +260,9 @@ int task_create(FAR const char *name, int priority,
  *
  ****************************************************************************/
 
-#ifndef CONFIG_CUSTOM_STACK
 int kernel_thread(FAR const char *name, int priority,
                   int stack_size, main_t entry, FAR char * const argv[])
-#else
-int kernel_thread(FAR const char *name, int priority,
-                  main_t entry, FAR char * const argv[])
-#endif
 {
-#ifndef CONFIG_CUSTOM_STACK
   return thread_create(name, TCB_FLAG_TTYPE_KERNEL, priority, stack_size, entry, argv);
-#else
-  return thread_create(name, TCB_FLAG_TTYPE_KERNEL, priority, entry, argv);
-#endif
 }
 
diff --git a/nuttx/sched/task/task_init.c b/nuttx/sched/task/task_init.c
index f1fa91e..6ad31e7 100644
--- a/nuttx/sched/task/task_init.c
+++ b/nuttx/sched/task/task_init.c
@@ -112,14 +112,9 @@
  *
  ****************************************************************************/
 
-#ifndef CONFIG_CUSTOM_STACK
 int task_init(FAR struct tcb_s *tcb, const char *name, int priority,
               FAR uint32_t *stack, uint32_t stack_size,
               main_t entry, FAR char * const argv[])
-#else
-int task_init(FAR struct tcb_s *tcb, const char *name, int priority,
-              main_t entry, FAR char * const argv[])
-#endif
 {
   FAR struct task_tcb_s *ttcb = (FAR struct task_tcb_s *)tcb;
   int errcode;
@@ -156,9 +151,7 @@ int task_init(FAR struct tcb_s *tcb, const char *name, int priority,
 
   /* Configure the user provided stack region */
 
-#ifndef CONFIG_CUSTOM_STACK
   up_use_stack(tcb, stack, stack_size);
-#endif
 
   /* Initialize the task control block */
 
diff --git a/nuttx/sched/task/task_posixspawn.c b/nuttx/sched/task/task_posixspawn.c
index 5a831b9..87d8680 100644
--- a/nuttx/sched/task/task_posixspawn.c
+++ b/nuttx/sched/task/task_posixspawn.c
@@ -424,7 +424,7 @@ int posix_spawn(FAR pid_t *pid, FAR const char *path,
    * task.
    */
 
-  proxy = TASK_CREATE("posix_spawn_proxy", param.sched_priority,
+  proxy = task_create("posix_spawn_proxy", param.sched_priority,
                       CONFIG_POSIX_SPAWN_PROXY_STACKSIZE,
                       (main_t)posix_spawn_proxy,
                       (FAR char * const *)NULL);
diff --git a/nuttx/sched/task/task_setup.c b/nuttx/sched/task/task_setup.c
index a0eaa9a..9ef1b0d 100644
--- a/nuttx/sched/task/task_setup.c
+++ b/nuttx/sched/task/task_setup.c
@@ -448,8 +448,7 @@ static void task_namesetup(FAR struct task_tcb_s *tcb, FAR const char *name)
  *
  ****************************************************************************/
 
-#if defined(CONFIG_CUSTOM_STACK) || (!defined(CONFIG_BUILD_PROTECTED) && \
-   !defined(CONFIG_BUILD_KERNEL))
+#if !defined(CONFIG_BUILD_PROTECTED) && !defined(CONFIG_BUILD_KERNEL)
 static int task_tcbargsetup(FAR struct task_tcb_s *tcb,
                             FAR char * const argv[])
 {
@@ -489,7 +488,7 @@ static int task_tcbargsetup(FAR struct task_tcb_s *tcb,
 
   return OK;
 }
-#endif /* CONFIG_CUSTOM_STACK || (!CONFIG_BUILD_PROTECTED && !CONFIG_BUILD_KERNEL) */
+#endif /* !CONFIG_BUILD_PROTECTED && !CONFIG_BUILD_KERNEL */
 
 /****************************************************************************
  * Name: task_stackargsetup
@@ -516,8 +515,7 @@ static int task_tcbargsetup(FAR struct task_tcb_s *tcb,
  *
  ****************************************************************************/
 
-#if !defined(CONFIG_CUSTOM_STACK) && (defined(CONFIG_BUILD_PROTECTED) || \
-     defined(CONFIG_BUILD_KERNEL))
+#if defined(CONFIG_BUILD_PROTECTED) || defined(CONFIG_BUILD_KERNEL)
 static int task_stackargsetup(FAR struct task_tcb_s *tcb,
                               FAR char * const argv[])
 {
@@ -619,7 +617,7 @@ static int task_stackargsetup(FAR struct task_tcb_s *tcb,
 
   return OK;
 }
-#endif /* !CONFIG_CUSTOM_STACK && (CONFIG_BUILD_PROTECTED || CONFIG_BUILD_KERNEL) */
+#endif /* CONFIG_BUILD_PROTECTED || CONFIG_BUILD_KERNEL */
 
 /****************************************************************************
  * Public Functions
@@ -744,8 +742,7 @@ int task_argsetup(FAR struct task_tcb_s *tcb, FAR const char *name,
 
   task_namesetup(tcb, name);
 
-#if !defined(CONFIG_CUSTOM_STACK) && (defined(CONFIG_BUILD_PROTECTED) || \
-     defined(CONFIG_BUILD_KERNEL))
+#if defined(CONFIG_BUILD_PROTECTED) || defined(CONFIG_BUILD_KERNEL)
   /*   In the kernel build case, the argv[] array and all strings are copied
    *   to the task's stack.  This is done because the TCB (and kernel allocated
    *   strings) are only accessible in kernel-mode.  Data on the stack, on the
@@ -762,7 +759,7 @@ int task_argsetup(FAR struct task_tcb_s *tcb, FAR const char *name,
 
   ret = task_tcbargsetup(tcb, argv);
 
-#endif /* !CONFIG_CUSTOM_STACK && (CONFIG_BUILD_PROTECTED || CONFIG_BUILD_KERNEL) */
+#endif /* CONFIG_BUILD_PROTECTED || CONFIG_BUILD_KERNEL */
 
   return ret;
 }
diff --git a/nuttx/sched/task/task_spawn.c b/nuttx/sched/task/task_spawn.c
index 2f55612..2b09e63 100644
--- a/nuttx/sched/task/task_spawn.c
+++ b/nuttx/sched/task/task_spawn.c
@@ -149,11 +149,11 @@ static int task_spawn_exec(FAR pid_t *pidp, FAR const char *name,
 
   /* Start the task */
 
-  pid = TASK_CREATE(name, priority, stacksize, entry, argv);
+  pid = task_create(name, priority, stacksize, entry, argv);
   if (pid < 0)
     {
       ret = get_errno();
-      sdbg("ERROR: TASK_CREATE failed: %d\n", ret);
+      sdbg("ERROR: task_create failed: %d\n", ret);
       goto errout;
     }
 
@@ -416,7 +416,7 @@ int task_spawn(FAR pid_t *pid, FAR const char *name, main_t entry,
    * task.
    */
 
-  proxy = TASK_CREATE("task_spawn_proxy", param.sched_priority,
+  proxy = task_create("task_spawn_proxy", param.sched_priority,
                       CONFIG_POSIX_SPAWN_PROXY_STACKSIZE,
                       (main_t)task_spawn_proxy,
                       (FAR char * const*)NULL);
